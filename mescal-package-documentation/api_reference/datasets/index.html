
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://docs.mesqual.io/mescal-package-documentation/api_reference/datasets/">
      
      
        <link rel="prev" href="../study_manager/">
      
      
        <link rel="next" href="../flag/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.19">
    
    
      
        <title>Datasets - MESCAL Suite Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="amber">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#dataset-references" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="MESCAL Suite Documentation" class="md-header__button md-logo" aria-label="MESCAL Suite Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            MESCAL Suite Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Datasets
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/helgeesch/mescal-vanilla-studies/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../study_manager/" class="md-tabs__link">
          
  
  
  MESCAL API Reference

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../mescal-study-01/notebooks/mescal_101_study_manager_and_basic_fetching/" class="md-tabs__link">
          
  
  
  Studies & Examples

        </a>
      </li>
    
  

    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="MESCAL Suite Documentation" class="md-nav__button md-logo" aria-label="MESCAL Suite Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    MESCAL Suite Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/helgeesch/mescal-vanilla-studies/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    MESCAL API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            MESCAL API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" checked>
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Core
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Core
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study_manager/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    StudyManager
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Datasets
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Datasets
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#mescal.datasets.dataset" class="md-nav__link">
    <span class="md-ellipsis">
      dataset
    </span>
  </a>
  
    <nav class="md-nav" aria-label="dataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mescal.datasets.dataset.Dataset" class="md-nav__link">
    <span class="md-ellipsis">
      Dataset
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Dataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mescal.datasets.dataset.Dataset.accepted_flags" class="md-nav__link">
    <span class="md-ellipsis">
      accepted_flags
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mescal.datasets.dataset.Dataset.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mescal.datasets.dataset.Dataset.add_kpis" class="md-nav__link">
    <span class="md-ellipsis">
      add_kpis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mescal.datasets.dataset.Dataset.add_kpi" class="md-nav__link">
    <span class="md-ellipsis">
      add_kpi
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mescal.datasets.dataset.Dataset.get_accepted_flags_containing_x" class="md-nav__link">
    <span class="md-ellipsis">
      get_accepted_flags_containing_x
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mescal.datasets.dataset.Dataset.flag_is_accepted" class="md-nav__link">
    <span class="md-ellipsis">
      flag_is_accepted
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mescal.datasets.dataset.Dataset.fetch" class="md-nav__link">
    <span class="md-ellipsis">
      fetch
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mescal.datasets.dataset.flag_must_be_accepted" class="md-nav__link">
    <span class="md-ellipsis">
      flag_must_be_accepted
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mescal.datasets.dataset_collection" class="md-nav__link">
    <span class="md-ellipsis">
      dataset_collection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="dataset_collection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mescal.datasets.dataset_collection.DatasetCollection" class="md-nav__link">
    <span class="md-ellipsis">
      DatasetCollection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DatasetCollection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mescal.datasets.dataset_collection.DatasetCollection.fetch_merged" class="md-nav__link">
    <span class="md-ellipsis">
      fetch_merged
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mescal.datasets.dataset_collection.DatasetLinkCollection" class="md-nav__link">
    <span class="md-ellipsis">
      DatasetLinkCollection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DatasetLinkCollection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mescal.datasets.dataset_collection.DatasetLinkCollection.get_dataset_by_type" class="md-nav__link">
    <span class="md-ellipsis">
      get_dataset_by_type
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mescal.datasets.dataset_collection.DatasetMergeCollection" class="md-nav__link">
    <span class="md-ellipsis">
      DatasetMergeCollection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mescal.datasets.dataset_collection.DatasetConcatCollection" class="md-nav__link">
    <span class="md-ellipsis">
      DatasetConcatCollection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mescal.datasets.dataset_comparison" class="md-nav__link">
    <span class="md-ellipsis">
      dataset_comparison
    </span>
  </a>
  
    <nav class="md-nav" aria-label="dataset_comparison">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mescal.datasets.dataset_comparison.DatasetComparison" class="md-nav__link">
    <span class="md-ellipsis">
      DatasetComparison
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DatasetComparison">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mescal.datasets.dataset_comparison.DatasetComparison.fetch" class="md-nav__link">
    <span class="md-ellipsis">
      fetch
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mescal.datasets.platform_dataset" class="md-nav__link">
    <span class="md-ellipsis">
      platform_dataset
    </span>
  </a>
  
    <nav class="md-nav" aria-label="platform_dataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mescal.datasets.platform_dataset.PlatformDataset" class="md-nav__link">
    <span class="md-ellipsis">
      PlatformDataset
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PlatformDataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mescal.datasets.platform_dataset.PlatformDataset.register_interpreter" class="md-nav__link">
    <span class="md-ellipsis">
      register_interpreter
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mescal.datasets.dataset_config" class="md-nav__link">
    <span class="md-ellipsis">
      dataset_config
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_3" >
        
          
          <label class="md-nav__link" for="__nav_2_1_3" id="__nav_2_1_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Flag System
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_3">
            <span class="md-nav__icon md-icon"></span>
            Flag System
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../flag/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Flag
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../flag_index/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FlagIndex
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../units/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Units
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../validation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../visualization/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Visualization Modules
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_2" id="__nav_2_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Visualization Modules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../visualization/time_series_dashboard/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    TimeSeriesDashboard
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../visualization/folium_viz_system/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Folium Viz System
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_2_2" id="__nav_2_2_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_2">
            <span class="md-nav__icon md-icon"></span>
            Folium Viz System
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../visualization/folium_viz_system/areas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Areas
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../visualization/folium_viz_system/circle_marker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Circle Marker
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../visualization/folium_viz_system/text_overlay/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Text Overlay
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../visualization/folium_viz_system/lines/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lines
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../visualization/folium_viz_system/line_text_overlay/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Line Text Overlay
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../visualization/folium_viz_system/arrow_icon/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Arrow Icon
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_2_7" >
        
          
          <label class="md-nav__link" for="__nav_2_2_2_7" id="__nav_2_2_2_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Base
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_2_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_2_7">
            <span class="md-nav__icon md-icon"></span>
            Base
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../visualization/folium_viz_system/system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Abstract System
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../visualization/folium_viz_system/data_item/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Data Item
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../visualization/folium_viz_system/kpi_collection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    KPI Collection Visualizer
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../visualization/folium_legend_system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Folium Legend System
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../visualization/html_table/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    HTML Table
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../visualization/html_dashboard/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    HTML Dashboard
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../energy_data_handling/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Energy Data Handling
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_3" id="__nav_2_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Energy Data Handling
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../energy_data_handling/area_accounting/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Area Accounting
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_3_1" id="__nav_2_3_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_1">
            <span class="md-nav__icon md-icon"></span>
            Area Accounting
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../energy_data_handling/area_accounting/model_gen/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Area / Border Model Generators
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../energy_data_handling/area_accounting/area_variables/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Area Variables
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../energy_data_handling/area_accounting/border_variables/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Border Variables
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../energy_data_handling/model_handling/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Model Membership Handling
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_3_2" id="__nav_2_3_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_2">
            <span class="md-nav__icon md-icon"></span>
            Model Membership Handling
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../energy_data_handling/model_handling/property_enricher/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Property Enricher
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../energy_data_handling/model_handling/pairs_appender/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pairs Appender
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../energy_data_handling/variable_utils/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Variable Utils
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_3_3" id="__nav_2_3_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_3">
            <span class="md-nav__icon md-icon"></span>
            Variable Utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../energy_data_handling/variable_utils/in_common_aggs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    In-common Aggregations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../energy_data_handling/variable_utils/direction_aggs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Up-/Down Directional Aggregations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../energy_data_handling/variable_utils/congestion_rent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Congestion Rent
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../energy_data_handling/variable_utils/regional_trade_balance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Regional Trade Balance
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../energy_data_handling/granularity_modules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Granularity Modules
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../energy_data_handling/network_lines_data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Network Lines Data
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../energy_data_handling/time_series_gap_handling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Time Series Gap Handling
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Utils
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../utils/pandas_utils/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    pandas_utils
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_4_1" id="__nav_2_4_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4_1">
            <span class="md-nav__icon md-icon"></span>
            pandas_utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/pandas_utils/flatten_df/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Flatten DF
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/pandas_utils/pend_props/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pend Properties
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/pandas_utils/filter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Filter by Model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/pandas_utils/xs_df/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    xs DF
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/pandas_utils/sort_multiindex/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sort MultiIndex
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/pandas_utils/merge_multi_index_levels/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Merge MultiIndex Levels
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/pandas_utils/set_new_column/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Set New Column in MultiIndex
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/pandas_utils/combine_dfs.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Combine DFs
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../utils/plotly_utils/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    plotly_utils
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_4_2" id="__nav_2_4_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4_2">
            <span class="md-nav__icon md-icon"></span>
            plotly_utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/plotly_utils/plotly_theme/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PlotlyTheme
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/plotly_utils/figure_utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    figure_utils
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/plotly_utils/px_category_utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    px_category_utils
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Studies & Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Studies & Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Intro to MESCAL
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            Intro to MESCAL
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../mescal-study-01/notebooks/mescal_101_study_manager_and_basic_fetching/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MESCAL 101: StudyManager and Dataset Fundamentals
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../mescal-study-01/notebooks/mescal_102_mastering_data_fetching/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MESCAL 102: Advanced Data Fetching Techniques
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../mescal-study-01/notebooks/mescal_103_scenario_attributes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MESCAL 103: Scenario Attributes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../mescal-study-01/notebooks/mescal_301_time_series_dashboard/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MESCAL 301: Time Series Dashboard
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../mescal-study-01/notebooks/mescal_302_segmented_colormap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MESCAL 302: Segmented Colormap
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../mescal-study-01/notebooks/mescal_303_folium_model_df_map/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MESCAL 401: Folium Model Data Visualization - Areas, Points, and Lines
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../mescal-study-01/notebooks/mescal_304_folium_area_kpi_map/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MESCAL 402: Folium KPI Visualization System
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../mescal-study-01/notebooks/mescal_304_simple_area_kpi_map/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MESCAL 303: Interactive Geospatial with Folium
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../mescal-study-01/notebooks/mescal_307_country_plotter_util/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MESCAL 307: Country Plotter Utility Module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../mescal-study-01/notebooks/mescal_308_html_dashboards/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MESCAL 305: HTML Dashboard Utility
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#mescal.datasets.dataset" class="md-nav__link">
    <span class="md-ellipsis">
      dataset
    </span>
  </a>
  
    <nav class="md-nav" aria-label="dataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mescal.datasets.dataset.Dataset" class="md-nav__link">
    <span class="md-ellipsis">
      Dataset
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Dataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mescal.datasets.dataset.Dataset.accepted_flags" class="md-nav__link">
    <span class="md-ellipsis">
      accepted_flags
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mescal.datasets.dataset.Dataset.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mescal.datasets.dataset.Dataset.add_kpis" class="md-nav__link">
    <span class="md-ellipsis">
      add_kpis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mescal.datasets.dataset.Dataset.add_kpi" class="md-nav__link">
    <span class="md-ellipsis">
      add_kpi
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mescal.datasets.dataset.Dataset.get_accepted_flags_containing_x" class="md-nav__link">
    <span class="md-ellipsis">
      get_accepted_flags_containing_x
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mescal.datasets.dataset.Dataset.flag_is_accepted" class="md-nav__link">
    <span class="md-ellipsis">
      flag_is_accepted
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mescal.datasets.dataset.Dataset.fetch" class="md-nav__link">
    <span class="md-ellipsis">
      fetch
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mescal.datasets.dataset.flag_must_be_accepted" class="md-nav__link">
    <span class="md-ellipsis">
      flag_must_be_accepted
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mescal.datasets.dataset_collection" class="md-nav__link">
    <span class="md-ellipsis">
      dataset_collection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="dataset_collection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mescal.datasets.dataset_collection.DatasetCollection" class="md-nav__link">
    <span class="md-ellipsis">
      DatasetCollection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DatasetCollection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mescal.datasets.dataset_collection.DatasetCollection.fetch_merged" class="md-nav__link">
    <span class="md-ellipsis">
      fetch_merged
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mescal.datasets.dataset_collection.DatasetLinkCollection" class="md-nav__link">
    <span class="md-ellipsis">
      DatasetLinkCollection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DatasetLinkCollection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mescal.datasets.dataset_collection.DatasetLinkCollection.get_dataset_by_type" class="md-nav__link">
    <span class="md-ellipsis">
      get_dataset_by_type
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mescal.datasets.dataset_collection.DatasetMergeCollection" class="md-nav__link">
    <span class="md-ellipsis">
      DatasetMergeCollection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mescal.datasets.dataset_collection.DatasetConcatCollection" class="md-nav__link">
    <span class="md-ellipsis">
      DatasetConcatCollection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mescal.datasets.dataset_comparison" class="md-nav__link">
    <span class="md-ellipsis">
      dataset_comparison
    </span>
  </a>
  
    <nav class="md-nav" aria-label="dataset_comparison">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mescal.datasets.dataset_comparison.DatasetComparison" class="md-nav__link">
    <span class="md-ellipsis">
      DatasetComparison
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DatasetComparison">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mescal.datasets.dataset_comparison.DatasetComparison.fetch" class="md-nav__link">
    <span class="md-ellipsis">
      fetch
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mescal.datasets.platform_dataset" class="md-nav__link">
    <span class="md-ellipsis">
      platform_dataset
    </span>
  </a>
  
    <nav class="md-nav" aria-label="platform_dataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mescal.datasets.platform_dataset.PlatformDataset" class="md-nav__link">
    <span class="md-ellipsis">
      PlatformDataset
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PlatformDataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mescal.datasets.platform_dataset.PlatformDataset.register_interpreter" class="md-nav__link">
    <span class="md-ellipsis">
      register_interpreter
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mescal.datasets.dataset_config" class="md-nav__link">
    <span class="md-ellipsis">
      dataset_config
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="dataset-references">Dataset References<a class="headerlink" href="#dataset-references" title="Permanent link">&para;</a></h1>


<div class="doc doc-object doc-module">



<h2 id="mescal.datasets.dataset" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">dataset</span>


<a href="#mescal.datasets.dataset" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="mescal.datasets.dataset.Dataset" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">Dataset</span>


<a href="#mescal.datasets.dataset.Dataset" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.Generic">Generic</span>[<span title="mescal.typevars.DatasetConfigType">DatasetConfigType</span>, <span title="mescal.typevars.FlagType">FlagType</span>, <span title="mescal.typevars.FlagIndexType">FlagIndexType</span>]</code>, <code><span title="abc.ABC">ABC</span></code></p>


        <p>Abstract base class for all datasets in the MESCAL framework.</p>
<p>The Dataset class provides the fundamental interface for data access and manipulation
in MESCAL. It implements the core principle "Everything is a Dataset" where individual
scenarios, collections of scenarios, and scenario comparisons all share the same
unified interface.</p>


<details class="key-features" open>
  <summary>Key Features</summary>
  <ul>
<li>Unified <code>.fetch(flag)</code> interface for data access</li>
<li>Attribute management for scenario metadata</li>
<li>KPI calculation integration</li>
<li>Database caching support</li>
<li>Dot notation fetching via <code>dotfetch</code> property</li>
<li>Type-safe generic implementation</li>
</ul>
</details>

<p>
      <span class="doc-section-title">
        Class Type Parameters:
      </span>
    </p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Bound or Constraints</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>DatasetConfigType</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration class for dataset behavior</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>FlagType</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type used for data flag identification (typically str)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>FlagIndexType</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag index implementation for flag mapping</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="mescal.datasets.dataset.Dataset.name">name</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Human-readable identifier for the dataset</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mescal.datasets.dataset.Dataset.kpi_collection">kpi_collection</span></code></td>
            <td>
                  <code><span title="mescal.kpis.kpi_collection.KPICollection">KPICollection</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Collection of KPIs associated with this dataset</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mescal.datasets.dataset.Dataset.dotfetch">dotfetch</span></code></td>
            <td>
                  <code><span title="mescal.datasets.dataset._DotNotationFetcher">_DotNotationFetcher</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Enables dot notation data access</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Example:</p>
<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; # Basic usage pattern
&gt;&gt;&gt; data = dataset.fetch(&#39;buses_t.marginal_price&#39;)
&gt;&gt;&gt; flags = dataset.accepted_flags
&gt;&gt;&gt; if dataset.flag_is_accepted(&#39;generators_t.p&#39;):
...     gen_data = dataset.fetch(&#39;generators_t.p&#39;)
</code></pre></div>








              <details class="quote">
                <summary>Source code in <code>submodules/mescal/mescal/datasets/dataset.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Dataset</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">DatasetConfigType</span><span class="p">,</span> <span class="n">FlagType</span><span class="p">,</span> <span class="n">FlagIndexType</span><span class="p">],</span> <span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract base class for all datasets in the MESCAL framework.</span>

<span class="sd">    The Dataset class provides the fundamental interface for data access and manipulation</span>
<span class="sd">    in MESCAL. It implements the core principle &quot;Everything is a Dataset&quot; where individual</span>
<span class="sd">    scenarios, collections of scenarios, and scenario comparisons all share the same</span>
<span class="sd">    unified interface.</span>

<span class="sd">    Key Features:</span>
<span class="sd">        - Unified `.fetch(flag)` interface for data access</span>
<span class="sd">        - Attribute management for scenario metadata</span>
<span class="sd">        - KPI calculation integration</span>
<span class="sd">        - Database caching support</span>
<span class="sd">        - Dot notation fetching via `dotfetch` property</span>
<span class="sd">        - Type-safe generic implementation</span>

<span class="sd">    Type Parameters:</span>
<span class="sd">        DatasetConfigType: Configuration class for dataset behavior</span>
<span class="sd">        FlagType: Type used for data flag identification (typically str)</span>
<span class="sd">        FlagIndexType: Flag index implementation for flag mapping</span>

<span class="sd">    Attributes:</span>
<span class="sd">        name (str): Human-readable identifier for the dataset</span>
<span class="sd">        kpi_collection (KPICollection): Collection of KPIs associated with this dataset</span>
<span class="sd">        dotfetch (_DotNotationFetcher): Enables dot notation data access</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; # Basic usage pattern</span>
<span class="sd">        &gt;&gt;&gt; data = dataset.fetch(&#39;buses_t.marginal_price&#39;)</span>
<span class="sd">        &gt;&gt;&gt; flags = dataset.accepted_flags</span>
<span class="sd">        &gt;&gt;&gt; if dataset.flag_is_accepted(&#39;generators_t.p&#39;):</span>
<span class="sd">        ...     gen_data = dataset.fetch(&#39;generators_t.p&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">parent_dataset</span><span class="p">:</span> <span class="n">Dataset</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">flag_index</span><span class="p">:</span> <span class="n">FlagIndexType</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">attributes</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">database</span><span class="p">:</span> <span class="n">Database</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">config</span><span class="p">:</span> <span class="n">DatasetConfigType</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize a new Dataset instance.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: Human-readable identifier. If None, auto-generates from class name</span>
<span class="sd">            parent_dataset: Optional parent dataset for hierarchical relationships</span>
<span class="sd">            flag_index: Index for mapping and validating data flags</span>
<span class="sd">            attributes: Dictionary of metadata attributes for the dataset</span>
<span class="sd">            database: Optional database for caching expensive computations</span>
<span class="sd">            config: Configuration object controlling dataset behavior</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="ow">or</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flag_index</span> <span class="o">=</span> <span class="n">flag_index</span> <span class="ow">or</span> <span class="n">EmptyFlagIndex</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parent_dataset</span> <span class="o">=</span> <span class="n">parent_dataset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">attributes</span> <span class="ow">or</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_database</span> <span class="o">=</span> <span class="n">database</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_config</span> <span class="o">=</span> <span class="n">config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dotfetch</span> <span class="o">=</span> <span class="n">_DotNotationFetcher</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">mescal.kpis.kpi_collection</span><span class="w"> </span><span class="kn">import</span> <span class="n">KPICollection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kpi_collection</span><span class="p">:</span> <span class="n">KPICollection</span> <span class="o">=</span> <span class="n">KPICollection</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">flag_index</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FlagIndexType</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_flag_index</span><span class="p">,</span> <span class="n">EmptyFlagIndex</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Dataset </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: &quot;</span>
                <span class="s2">&quot;You&#39;re trying to use functionality of the FlagIndex but didn&#39;t define one. &quot;</span>
                <span class="s2">&quot;The current FlagIndex in use is empty. &quot;</span>
                <span class="s2">&quot;Make sure to set a flag_index in case you want to use full functionality of the flag_index.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flag_index</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">database</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Database</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_database</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_kpis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kpis</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">KPI</span> <span class="o">|</span> <span class="n">KPIFactory</span> <span class="o">|</span> <span class="n">Type</span><span class="p">[</span><span class="n">KPI</span><span class="p">]]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add multiple KPIs to this dataset&#39;s KPI collection.</span>

<span class="sd">        Args:</span>
<span class="sd">            kpis: Iterable of KPI instances, factories, or classes to add</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">kpi</span> <span class="ow">in</span> <span class="n">kpis</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_kpi</span><span class="p">(</span><span class="n">kpi</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_kpi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kpi</span><span class="p">:</span> <span class="n">KPI</span> <span class="o">|</span> <span class="n">KPIFactory</span> <span class="o">|</span> <span class="n">Type</span><span class="p">[</span><span class="n">KPI</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a single KPI to this dataset&#39;s KPI collection.</span>

<span class="sd">        Automatically handles different KPI input types by converting factories</span>
<span class="sd">        and classes to KPI instances.</span>

<span class="sd">        Args:</span>
<span class="sd">            kpi: KPI instance, factory, or class to add</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">mescal.kpis.kpi_base</span><span class="w"> </span><span class="kn">import</span> <span class="n">KPI</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">mescal.kpis.kpis_from_aggregations</span><span class="w"> </span><span class="kn">import</span> <span class="n">KPIFactory</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kpi</span><span class="p">,</span> <span class="n">KPIFactory</span><span class="p">):</span>
            <span class="n">kpi</span> <span class="o">=</span> <span class="n">kpi</span><span class="o">.</span><span class="n">get_kpi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kpi</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">kpi</span><span class="p">,</span> <span class="n">KPI</span><span class="p">):</span>
            <span class="n">kpi</span> <span class="o">=</span> <span class="n">kpi</span><span class="o">.</span><span class="n">from_factory</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kpi_collection</span><span class="o">.</span><span class="n">add_kpi</span><span class="p">(</span><span class="n">kpi</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">clear_kpi_collection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">mescal.kpis</span><span class="w"> </span><span class="kn">import</span> <span class="n">KPICollection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kpi_collection</span> <span class="o">=</span> <span class="n">KPICollection</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_attributes_series</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
        <span class="n">att_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">att_series</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Attribute keys must be of type str. Your key </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1"> is of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;Attribute values must be of type (bool, int, flaot, str). &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;Your value for </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1">) is of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s1">.&#39;</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">parent_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;DatasetLinkCollection&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_dataset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Parent dataset called without / before assignment.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_dataset</span>

    <span class="nd">@parent_dataset</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">parent_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent_dataset</span><span class="p">:</span> <span class="s1">&#39;DatasetLinkCollection&#39;</span><span class="p">):</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">mescal.datasets.dataset_collection</span><span class="w"> </span><span class="kn">import</span> <span class="n">DatasetLinkCollection</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parent_dataset</span><span class="p">,</span> <span class="n">DatasetLinkCollection</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Parent parent_dataset must be of type </span><span class="si">{</span><span class="n">DatasetLinkCollection</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parent_dataset</span> <span class="o">=</span> <span class="n">parent_dataset</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">accepted_flags</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="n">FlagType</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set of all flags accepted by this dataset.</span>

<span class="sd">        This abstract property must be implemented by all concrete dataset classes</span>
<span class="sd">        to define which data flags can be fetched from the dataset.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Set of flags that can be used with the fetch() method</span>

<span class="sd">        Example:</span>

<span class="sd">            &gt;&gt;&gt; print(dataset.accepted_flags)</span>
<span class="sd">                {&#39;buses&#39;, &#39;buses_t.marginal_price&#39;, &#39;generators&#39;, &#39;generators_t.p&#39;, ...}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_accepted_flags_containing_x</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">match_case</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="n">FlagType</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find all accepted flags containing a specific substring.</span>

<span class="sd">        Useful for discovering related data flags or filtering flags by category.</span>

<span class="sd">        Args:</span>
<span class="sd">            x: Substring to search for in flag names</span>
<span class="sd">            match_case: If True, performs case-sensitive search. Default is False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Set of accepted flags containing the substring</span>

<span class="sd">        Example:</span>

<span class="sd">            &gt;&gt;&gt; ds = PyPSADataset()</span>
<span class="sd">            &gt;&gt;&gt; ds.get_accepted_flags_containing_x(&#39;generators&#39;)</span>
<span class="sd">                {&#39;generators&#39;, &#39;generators_t.p&#39;, &#39;generators_t.efficiency&#39;, ...}</span>
<span class="sd">            &gt;&gt;&gt; ds.get_accepted_flags_containing_x(&#39;BUSES&#39;, match_case=True)</span>
<span class="sd">                set()  # Empty because case doesn&#39;t match</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">match_case</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">accepted_flags</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)}</span>
        <span class="n">x_lower</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">accepted_flags</span> <span class="k">if</span> <span class="n">x_lower</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">flag_is_accepted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag</span><span class="p">:</span> <span class="n">FlagType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Boolean check whether a flag is accepted by the Dataset.</span>

<span class="sd">        This method can be optionally overridden in any child-class</span>
<span class="sd">        in case you want to follow logic instead of the explicit set of accepted_flags.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">flag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">accepted_flags</span>

    <span class="nd">@flag_must_be_accepted</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">required_flags_for_flag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag</span><span class="p">:</span> <span class="n">FlagType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="n">FlagType</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_required_flags_for_flag</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_required_flags_for_flag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag</span><span class="p">:</span> <span class="n">FlagType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="n">FlagType</span><span class="p">]:</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">()</span>

    <span class="nd">@flag_must_be_accepted</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag</span><span class="p">:</span> <span class="n">FlagType</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="n">DatasetConfigType</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetch data associated with a specific flag.</span>

<span class="sd">        This is the primary method for data access in MESCAL datasets. It provides</span>
<span class="sd">        a unified interface for retrieving data regardless of the underlying source</span>
<span class="sd">        or dataset type. The method includes automatic caching, post-processing,</span>
<span class="sd">        and configuration management.</span>

<span class="sd">        Args:</span>
<span class="sd">            flag: Data identifier flag (must be in accepted_flags)</span>
<span class="sd">            config: Optional configuration to override dataset defaults.</span>
<span class="sd">                   Can be a dict or DatasetConfig instance.</span>
<span class="sd">            **kwargs: Additional keyword arguments passed to the underlying</span>
<span class="sd">                     data fetching implementation</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataFrame or Series containing the requested data</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the flag is not accepted by this dataset</span>

<span class="sd">        Examples:</span>

<span class="sd">            &gt;&gt;&gt; # Basic usage</span>
<span class="sd">            &gt;&gt;&gt; prices = dataset.fetch(&#39;buses_t.marginal_price&#39;)</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # With custom configuration</span>
<span class="sd">            &gt;&gt;&gt; prices = dataset.fetch(&#39;buses_t.marginal_price&#39;, config={&#39;use_database&#39;: False})</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">effective_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_config</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="n">use_database</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_database</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">effective_config</span><span class="o">.</span><span class="n">use_database</span>

        <span class="k">if</span> <span class="n">use_database</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_database</span><span class="o">.</span><span class="n">key_is_up_to_date</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">effective_config</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_database</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">effective_config</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">raw_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="n">effective_config</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">processed_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post_process_data</span><span class="p">(</span><span class="n">raw_data</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="n">effective_config</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">use_database</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_database</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">effective_config</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">processed_data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">processed_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_post_process_data</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
            <span class="n">flag</span><span class="p">:</span> <span class="n">FlagType</span><span class="p">,</span>
            <span class="n">config</span><span class="p">:</span> <span class="n">DatasetConfigType</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">remove_duplicate_indices</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;For some reason your data-set </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> returns an object with duplicate indices for flag </span><span class="si">{</span><span class="n">flag</span><span class="si">}</span><span class="s1">.</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="sa">f</span><span class="s1">&#39;We manually remove duplicate indices. Please make sure your data importer / converter is set up &#39;</span>
                <span class="sa">f</span><span class="s1">&#39;appropriately and that your raw data does not contain duplicate indices. </span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="sa">f</span><span class="s1">&#39;We will keep the first element of every duplicated index.&#39;</span>
            <span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()]</span>
        <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">auto_sort_datetime_index</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_prepare_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="n">DatasetConfigType</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DatasetConfigType</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance_config</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">temp_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config_type</span><span class="p">()()</span>
            <span class="n">temp_config</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance_config</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">temp_config</span><span class="p">)</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">mescal.datasets.dataset_config</span><span class="w"> </span><span class="kn">import</span> <span class="n">DatasetConfig</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">DatasetConfig</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance_config</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Config must be dict or </span><span class="si">{</span><span class="n">DatasetConfig</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">, got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag</span><span class="p">:</span> <span class="n">FlagType</span><span class="p">,</span> <span class="n">effective_config</span><span class="p">:</span> <span class="n">DatasetConfigType</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fetch_multiple_flags_and_concat</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">flags</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">FlagType</span><span class="p">],</span>
            <span class="n">concat_axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">concat_level_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;variable&#39;</span><span class="p">,</span>
            <span class="n">concat_level_at_top</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="n">DatasetConfigType</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
        <span class="n">dfs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">flag</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">flag</span> <span class="ow">in</span> <span class="n">flags</span>
        <span class="p">}</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
            <span class="n">dfs</span><span class="p">,</span>
            <span class="n">axis</span><span class="o">=</span><span class="n">concat_axis</span><span class="p">,</span>
            <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="n">concat_level_name</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">concat_level_at_top</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">concat_axis</span><span class="p">]</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">reorder_levels</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ax</span><span class="o">.</span><span class="n">nlevels</span><span class="p">))</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">df</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">concat_axis</span><span class="p">]</span> <span class="o">=</span> <span class="n">ax</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fetch_filter_groupby_agg</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">flag</span><span class="p">:</span> <span class="n">FlagType</span><span class="p">,</span>
            <span class="n">model_filter_query</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">prop_groupby</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">prop_groupby_agg</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="n">DatasetConfigType</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">model_flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_index</span><span class="o">.</span><span class="n">get_linked_model_flag</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">model_flag</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;FlagIndex could not successfully map flag </span><span class="si">{</span><span class="n">flag</span><span class="si">}</span><span class="s1"> to a model flag.&#39;</span><span class="p">)</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">mescal.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">pandas_utils</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">model_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">model_flag</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">model_filter_query</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">pandas_utils</span><span class="o">.</span><span class="n">filter_by_model_query</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">model_df</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="n">model_filter_query</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">prop_groupby</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prop_groupby</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">prop_groupby</span> <span class="o">=</span> <span class="p">[</span><span class="n">prop_groupby</span><span class="p">]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">pandas_utils</span><span class="o">.</span><span class="n">prepend_model_prop_levels</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">model_df</span><span class="p">,</span> <span class="o">*</span><span class="n">prop_groupby</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">prop_groupby</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">prop_groupby_agg</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">prop_groupby_agg</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">prop_groupby_agg</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;You provided a prop_groupby_agg operation, but didn&#39;t provide prop_groupby. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;No aggregation performed.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_flag_type</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Type</span><span class="p">[</span><span class="n">FlagType</span><span class="p">]:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">mescal.flag.flag</span><span class="w"> </span><span class="kn">import</span> <span class="n">FlagTypeProtocol</span>
        <span class="k">return</span> <span class="n">FlagTypeProtocol</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_flag_index_type</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Type</span><span class="p">[</span><span class="n">FlagIndexType</span><span class="p">]:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">mescal.flag.flag_index</span><span class="w"> </span><span class="kn">import</span> <span class="n">FlagIndex</span>
        <span class="k">return</span> <span class="n">FlagIndex</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_config_type</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Type</span><span class="p">[</span><span class="n">DatasetConfigType</span><span class="p">]:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">mescal.datasets.dataset_config</span><span class="w"> </span><span class="kn">import</span> <span class="n">DatasetConfig</span>
        <span class="k">return</span> <span class="n">DatasetConfig</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">instance_config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DatasetConfigType</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">mescal.datasets.dataset_config</span><span class="w"> </span><span class="kn">import</span> <span class="n">DatasetConfigManager</span>
        <span class="k">return</span> <span class="n">DatasetConfigManager</span><span class="o">.</span><span class="n">get_effective_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_instance_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">DatasetConfigType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_config</span> <span class="o">=</span> <span class="n">config</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_instance_config_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_class_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">DatasetConfigType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">mescal.datasets.dataset_config</span><span class="w"> </span><span class="kn">import</span> <span class="n">DatasetConfigManager</span>
        <span class="n">DatasetConfigManager</span><span class="o">.</span><span class="n">set_class_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_class_name_lower_snake</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">to_lower_snake</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="mescal.datasets.dataset.Dataset.accepted_flags" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">accepted_flags</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#mescal.datasets.dataset.Dataset.accepted_flags" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">accepted_flags</span><span class="p">:</span> <span class="n"><span title="set">set</span></span><span class="p">[</span><span class="n"><span title="mescal.typevars.FlagType">FlagType</span></span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Set of all flags accepted by this dataset.</p>
<p>This abstract property must be implemented by all concrete dataset classes
to define which data flags can be fetched from the dataset.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="set">set</span>[<span title="mescal.typevars.FlagType">FlagType</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Set of flags that can be used with the fetch() method</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Example:</p>
<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; print(dataset.accepted_flags)
    {&#39;buses&#39;, &#39;buses_t.marginal_price&#39;, &#39;generators&#39;, &#39;generators_t.p&#39;, ...}
</code></pre></div>

    </div>

</div>




<div class="doc doc-object doc-function">


<h4 id="mescal.datasets.dataset.Dataset.__init__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__init__</span>


<a href="#mescal.datasets.dataset.Dataset.__init__" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">parent_dataset</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Dataset (mescal.datasets.dataset.Dataset)" href="#mescal.datasets.dataset.Dataset">Dataset</a></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">flag_index</span><span class="p">:</span> <span class="n"><span title="mescal.typevars.FlagIndexType">FlagIndexType</span></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">attributes</span><span class="p">:</span> <span class="n"><span title="dict">dict</span></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n"><span title="mescal.databases.database.Database">Database</span></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n"><span title="mescal.typevars.DatasetConfigType">DatasetConfigType</span></span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Initialize a new Dataset instance.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Human-readable identifier. If None, auto-generates from class name</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>parent_dataset</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="            Dataset (mescal.datasets.dataset.Dataset)" href="#mescal.datasets.dataset.Dataset">Dataset</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional parent dataset for hierarchical relationships</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>flag_index</code>
            </td>
            <td>
                  <code><span title="mescal.typevars.FlagIndexType">FlagIndexType</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Index for mapping and validating data flags</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>attributes</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of metadata attributes for the dataset</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>database</code>
            </td>
            <td>
                  <code><span title="mescal.databases.database.Database">Database</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional database for caching expensive computations</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>config</code>
            </td>
            <td>
                  <code><span title="mescal.typevars.DatasetConfigType">DatasetConfigType</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration object controlling dataset behavior</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>submodules/mescal/mescal/datasets/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">parent_dataset</span><span class="p">:</span> <span class="n">Dataset</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">flag_index</span><span class="p">:</span> <span class="n">FlagIndexType</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">attributes</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">database</span><span class="p">:</span> <span class="n">Database</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">config</span><span class="p">:</span> <span class="n">DatasetConfigType</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize a new Dataset instance.</span>

<span class="sd">    Args:</span>
<span class="sd">        name: Human-readable identifier. If None, auto-generates from class name</span>
<span class="sd">        parent_dataset: Optional parent dataset for hierarchical relationships</span>
<span class="sd">        flag_index: Index for mapping and validating data flags</span>
<span class="sd">        attributes: Dictionary of metadata attributes for the dataset</span>
<span class="sd">        database: Optional database for caching expensive computations</span>
<span class="sd">        config: Configuration object controlling dataset behavior</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="ow">or</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_flag_index</span> <span class="o">=</span> <span class="n">flag_index</span> <span class="ow">or</span> <span class="n">EmptyFlagIndex</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_parent_dataset</span> <span class="o">=</span> <span class="n">parent_dataset</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">attributes</span> <span class="ow">or</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_database</span> <span class="o">=</span> <span class="n">database</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_config</span> <span class="o">=</span> <span class="n">config</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dotfetch</span> <span class="o">=</span> <span class="n">_DotNotationFetcher</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">mescal.kpis.kpi_collection</span><span class="w"> </span><span class="kn">import</span> <span class="n">KPICollection</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kpi_collection</span><span class="p">:</span> <span class="n">KPICollection</span> <span class="o">=</span> <span class="n">KPICollection</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="mescal.datasets.dataset.Dataset.add_kpis" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">add_kpis</span>


<a href="#mescal.datasets.dataset.Dataset.add_kpis" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">add_kpis</span><span class="p">(</span><span class="n">kpis</span><span class="p">:</span> <span class="n"><span title="typing.Iterable">Iterable</span></span><span class="p">[</span><span class="n"><span title="mescal.kpis.kpi_base.KPI">KPI</span></span> <span class="o">|</span> <span class="n"><span title="mescal.kpis.kpi_base.KPIFactory">KPIFactory</span></span> <span class="o">|</span> <span class="n"><span title="typing.Type">Type</span></span><span class="p">[</span><span class="n"><span title="mescal.kpis.kpi_base.KPI">KPI</span></span><span class="p">]])</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Add multiple KPIs to this dataset's KPI collection.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>kpis</code>
            </td>
            <td>
                  <code><span title="typing.Iterable">Iterable</span>[<span title="mescal.kpis.kpi_base.KPI">KPI</span> | <span title="mescal.kpis.kpi_base.KPIFactory">KPIFactory</span> | <span title="typing.Type">Type</span>[<span title="mescal.kpis.kpi_base.KPI">KPI</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Iterable of KPI instances, factories, or classes to add</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>submodules/mescal/mescal/datasets/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_kpis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kpis</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">KPI</span> <span class="o">|</span> <span class="n">KPIFactory</span> <span class="o">|</span> <span class="n">Type</span><span class="p">[</span><span class="n">KPI</span><span class="p">]]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add multiple KPIs to this dataset&#39;s KPI collection.</span>

<span class="sd">    Args:</span>
<span class="sd">        kpis: Iterable of KPI instances, factories, or classes to add</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">kpi</span> <span class="ow">in</span> <span class="n">kpis</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_kpi</span><span class="p">(</span><span class="n">kpi</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="mescal.datasets.dataset.Dataset.add_kpi" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">add_kpi</span>


<a href="#mescal.datasets.dataset.Dataset.add_kpi" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">add_kpi</span><span class="p">(</span><span class="n">kpi</span><span class="p">:</span> <span class="n"><span title="mescal.kpis.kpi_base.KPI">KPI</span></span> <span class="o">|</span> <span class="n"><span title="mescal.kpis.kpi_base.KPIFactory">KPIFactory</span></span> <span class="o">|</span> <span class="n"><span title="typing.Type">Type</span></span><span class="p">[</span><span class="n"><span title="mescal.kpis.kpi_base.KPI">KPI</span></span><span class="p">])</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Add a single KPI to this dataset's KPI collection.</p>
<p>Automatically handles different KPI input types by converting factories
and classes to KPI instances.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>kpi</code>
            </td>
            <td>
                  <code><span title="mescal.kpis.kpi_base.KPI">KPI</span> | <span title="mescal.kpis.kpi_base.KPIFactory">KPIFactory</span> | <span title="typing.Type">Type</span>[<span title="mescal.kpis.kpi_base.KPI">KPI</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>KPI instance, factory, or class to add</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>submodules/mescal/mescal/datasets/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_kpi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kpi</span><span class="p">:</span> <span class="n">KPI</span> <span class="o">|</span> <span class="n">KPIFactory</span> <span class="o">|</span> <span class="n">Type</span><span class="p">[</span><span class="n">KPI</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add a single KPI to this dataset&#39;s KPI collection.</span>

<span class="sd">    Automatically handles different KPI input types by converting factories</span>
<span class="sd">    and classes to KPI instances.</span>

<span class="sd">    Args:</span>
<span class="sd">        kpi: KPI instance, factory, or class to add</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">mescal.kpis.kpi_base</span><span class="w"> </span><span class="kn">import</span> <span class="n">KPI</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">mescal.kpis.kpis_from_aggregations</span><span class="w"> </span><span class="kn">import</span> <span class="n">KPIFactory</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kpi</span><span class="p">,</span> <span class="n">KPIFactory</span><span class="p">):</span>
        <span class="n">kpi</span> <span class="o">=</span> <span class="n">kpi</span><span class="o">.</span><span class="n">get_kpi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kpi</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">kpi</span><span class="p">,</span> <span class="n">KPI</span><span class="p">):</span>
        <span class="n">kpi</span> <span class="o">=</span> <span class="n">kpi</span><span class="o">.</span><span class="n">from_factory</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kpi_collection</span><span class="o">.</span><span class="n">add_kpi</span><span class="p">(</span><span class="n">kpi</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="mescal.datasets.dataset.Dataset.get_accepted_flags_containing_x" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_accepted_flags_containing_x</span>


<a href="#mescal.datasets.dataset.Dataset.get_accepted_flags_containing_x" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_accepted_flags_containing_x</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n">match_case</span><span class="p">:</span> <span class="n"><span title="bool">bool</span></span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="set">set</span></span><span class="p">[</span><span class="n"><span title="mescal.typevars.FlagType">FlagType</span></span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Find all accepted flags containing a specific substring.</p>
<p>Useful for discovering related data flags or filtering flags by category.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Substring to search for in flag names</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>match_case</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, performs case-sensitive search. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="set">set</span>[<span title="mescal.typevars.FlagType">FlagType</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Set of accepted flags containing the substring</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Example:</p>
<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; ds = PyPSADataset()
&gt;&gt;&gt; ds.get_accepted_flags_containing_x(&#39;generators&#39;)
    {&#39;generators&#39;, &#39;generators_t.p&#39;, &#39;generators_t.efficiency&#39;, ...}
&gt;&gt;&gt; ds.get_accepted_flags_containing_x(&#39;BUSES&#39;, match_case=True)
    set()  # Empty because case doesn&#39;t match
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>submodules/mescal/mescal/datasets/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_accepted_flags_containing_x</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">match_case</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="n">FlagType</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find all accepted flags containing a specific substring.</span>

<span class="sd">    Useful for discovering related data flags or filtering flags by category.</span>

<span class="sd">    Args:</span>
<span class="sd">        x: Substring to search for in flag names</span>
<span class="sd">        match_case: If True, performs case-sensitive search. Default is False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Set of accepted flags containing the substring</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; ds = PyPSADataset()</span>
<span class="sd">        &gt;&gt;&gt; ds.get_accepted_flags_containing_x(&#39;generators&#39;)</span>
<span class="sd">            {&#39;generators&#39;, &#39;generators_t.p&#39;, &#39;generators_t.efficiency&#39;, ...}</span>
<span class="sd">        &gt;&gt;&gt; ds.get_accepted_flags_containing_x(&#39;BUSES&#39;, match_case=True)</span>
<span class="sd">            set()  # Empty because case doesn&#39;t match</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">match_case</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">accepted_flags</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)}</span>
    <span class="n">x_lower</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">accepted_flags</span> <span class="k">if</span> <span class="n">x_lower</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="mescal.datasets.dataset.Dataset.flag_is_accepted" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">flag_is_accepted</span>


<a href="#mescal.datasets.dataset.Dataset.flag_is_accepted" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">flag_is_accepted</span><span class="p">(</span><span class="n">flag</span><span class="p">:</span> <span class="n"><span title="mescal.typevars.FlagType">FlagType</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="bool">bool</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Boolean check whether a flag is accepted by the Dataset.</p>
<p>This method can be optionally overridden in any child-class
in case you want to follow logic instead of the explicit set of accepted_flags.</p>


            <details class="quote">
              <summary>Source code in <code>submodules/mescal/mescal/datasets/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">flag_is_accepted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag</span><span class="p">:</span> <span class="n">FlagType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Boolean check whether a flag is accepted by the Dataset.</span>

<span class="sd">    This method can be optionally overridden in any child-class</span>
<span class="sd">    in case you want to follow logic instead of the explicit set of accepted_flags.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">flag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">accepted_flags</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="mescal.datasets.dataset.Dataset.fetch" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">fetch</span>


<a href="#mescal.datasets.dataset.Dataset.fetch" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">fetch</span><span class="p">(</span><span class="n">flag</span><span class="p">:</span> <span class="n"><span title="mescal.typevars.FlagType">FlagType</span></span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n"><span title="dict">dict</span></span> <span class="o">|</span> <span class="n"><span title="mescal.typevars.DatasetConfigType">DatasetConfigType</span></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="pandas.Series">Series</span></span> <span class="o">|</span> <span class="n"><span title="pandas.DataFrame">DataFrame</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fetch data associated with a specific flag.</p>
<p>This is the primary method for data access in MESCAL datasets. It provides
a unified interface for retrieving data regardless of the underlying source
or dataset type. The method includes automatic caching, post-processing,
and configuration management.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>flag</code>
            </td>
            <td>
                  <code><span title="mescal.typevars.FlagType">FlagType</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Data identifier flag (must be in accepted_flags)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>config</code>
            </td>
            <td>
                  <code><span title="dict">dict</span> | <span title="mescal.typevars.DatasetConfigType">DatasetConfigType</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional configuration to override dataset defaults.
   Can be a dict or DatasetConfig instance.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments passed to the underlying
     data fetching implementation</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.Series">Series</span> | <span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame or Series containing the requested data</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the flag is not accepted by this dataset</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Examples:</p>
<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; # Basic usage
&gt;&gt;&gt; prices = dataset.fetch(&#39;buses_t.marginal_price&#39;)
&gt;&gt;&gt;
&gt;&gt;&gt; # With custom configuration
&gt;&gt;&gt; prices = dataset.fetch(&#39;buses_t.marginal_price&#39;, config={&#39;use_database&#39;: False})
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>submodules/mescal/mescal/datasets/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@flag_must_be_accepted</span>
<span class="k">def</span><span class="w"> </span><span class="nf">fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag</span><span class="p">:</span> <span class="n">FlagType</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="n">DatasetConfigType</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fetch data associated with a specific flag.</span>

<span class="sd">    This is the primary method for data access in MESCAL datasets. It provides</span>
<span class="sd">    a unified interface for retrieving data regardless of the underlying source</span>
<span class="sd">    or dataset type. The method includes automatic caching, post-processing,</span>
<span class="sd">    and configuration management.</span>

<span class="sd">    Args:</span>
<span class="sd">        flag: Data identifier flag (must be in accepted_flags)</span>
<span class="sd">        config: Optional configuration to override dataset defaults.</span>
<span class="sd">               Can be a dict or DatasetConfig instance.</span>
<span class="sd">        **kwargs: Additional keyword arguments passed to the underlying</span>
<span class="sd">                 data fetching implementation</span>

<span class="sd">    Returns:</span>
<span class="sd">        DataFrame or Series containing the requested data</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the flag is not accepted by this dataset</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; # Basic usage</span>
<span class="sd">        &gt;&gt;&gt; prices = dataset.fetch(&#39;buses_t.marginal_price&#39;)</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # With custom configuration</span>
<span class="sd">        &gt;&gt;&gt; prices = dataset.fetch(&#39;buses_t.marginal_price&#39;, config={&#39;use_database&#39;: False})</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">effective_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_config</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    <span class="n">use_database</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_database</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">effective_config</span><span class="o">.</span><span class="n">use_database</span>

    <span class="k">if</span> <span class="n">use_database</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_database</span><span class="o">.</span><span class="n">key_is_up_to_date</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">effective_config</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_database</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">effective_config</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">raw_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="n">effective_config</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">processed_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post_process_data</span><span class="p">(</span><span class="n">raw_data</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="n">effective_config</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">use_database</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_database</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">effective_config</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">processed_data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">processed_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="mescal.datasets.dataset.flag_must_be_accepted" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">flag_must_be_accepted</span>


<a href="#mescal.datasets.dataset.flag_must_be_accepted" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">flag_must_be_accepted</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Decorator that validates flag acceptance before method execution.</p>
<p>Ensures that only accepted flags are processed by dataset methods,
providing clear error messages for invalid flag usage.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>method</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The method to decorate</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Decorated method that validates flag acceptance</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the flag is not accepted by the dataset</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>submodules/mescal/mescal/datasets/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">flag_must_be_accepted</span><span class="p">(</span><span class="n">method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Decorator that validates flag acceptance before method execution.</span>

<span class="sd">    Ensures that only accepted flags are processed by dataset methods,</span>
<span class="sd">    providing clear error messages for invalid flag usage.</span>

<span class="sd">    Args:</span>
<span class="sd">        method: The method to decorate</span>

<span class="sd">    Returns:</span>
<span class="sd">        Decorated method that validates flag acceptance</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the flag is not accepted by the dataset</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">raise_if_flag_not_accepted</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">flag</span><span class="p">:</span> <span class="n">FlagType</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">DatasetConfigType</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_is_accepted</span><span class="p">(</span><span class="n">flag</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Flag </span><span class="si">{</span><span class="n">flag</span><span class="si">}</span><span class="s1"> not accepted by Dataset &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot; of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">raise_if_flag_not_accepted</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="mescal.datasets.dataset_collection" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">dataset_collection</span>


<a href="#mescal.datasets.dataset_collection" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="mescal.datasets.dataset_collection.DatasetCollection" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">DatasetCollection</span>


<a href="#mescal.datasets.dataset_collection.DatasetCollection" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.Generic">Generic</span>[<span title="mescal.typevars.DatasetType">DatasetType</span>, <span title="mescal.typevars.DatasetConfigType">DatasetConfigType</span>, <span title="mescal.typevars.FlagType">FlagType</span>, <span title="mescal.typevars.FlagIndexType">FlagIndexType</span>]</code>, <code><a class="autorefs autorefs-internal" title="            Dataset (mescal.datasets.dataset.Dataset)" href="#mescal.datasets.dataset.Dataset">Dataset</a>[<span title="mescal.typevars.DatasetConfigType">DatasetConfigType</span>, <span title="mescal.typevars.FlagType">FlagType</span>, <span title="mescal.typevars.FlagIndexType">FlagIndexType</span>]</code>, <code><span title="abc.ABC">ABC</span></code></p>


        <p>Abstract base class for collections of datasets.</p>
<p>DatasetCollection extends the Dataset interface to handle multiple child datasets
while maintaining the same unified API. This enables complex hierarchical structures
where collections themselves can be treated as datasets.</p>


<details class="key-features" open>
  <summary>Key Features</summary>
  <ul>
<li>Inherits all Dataset functionality</li>
<li>Manages collections of child datasets</li>
<li>Provides iteration and access methods</li>
<li>Aggregates accepted flags from all children</li>
<li>Supports KPI operations across all sub-datasets</li>
</ul>
</details>

<p>
      <span class="doc-section-title">
        Class Type Parameters:
      </span>
    </p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Bound or Constraints</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>DatasetType</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of datasets that can be collected</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>DatasetConfigType</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration class for dataset behavior</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>FlagType</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type used for data flag identification</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>FlagIndexType</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag index implementation for flag mapping</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="mescal.datasets.dataset_collection.DatasetCollection.datasets">datasets</span></code></td>
            <td>
                  <code><span title="list">list</span>[<span title="mescal.typevars.DatasetType">DatasetType</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of child datasets in this collection</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>This class follows the "Everything is a Dataset" principle, allowing
collections to be used anywhere a Dataset is expected.</p>
</details>







              <details class="quote">
                <summary>Source code in <code>submodules/mescal/mescal/datasets/dataset_collection.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DatasetCollection</span><span class="p">(</span>
    <span class="n">Generic</span><span class="p">[</span><span class="n">DatasetType</span><span class="p">,</span> <span class="n">DatasetConfigType</span><span class="p">,</span> <span class="n">FlagType</span><span class="p">,</span> <span class="n">FlagIndexType</span><span class="p">],</span>
    <span class="n">Dataset</span><span class="p">[</span><span class="n">DatasetConfigType</span><span class="p">,</span> <span class="n">FlagType</span><span class="p">,</span> <span class="n">FlagIndexType</span><span class="p">],</span>
    <span class="n">ABC</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract base class for collections of datasets.</span>

<span class="sd">    DatasetCollection extends the Dataset interface to handle multiple child datasets</span>
<span class="sd">    while maintaining the same unified API. This enables complex hierarchical structures</span>
<span class="sd">    where collections themselves can be treated as datasets.</span>

<span class="sd">    Key Features:</span>
<span class="sd">        - Inherits all Dataset functionality</span>
<span class="sd">        - Manages collections of child datasets</span>
<span class="sd">        - Provides iteration and access methods</span>
<span class="sd">        - Aggregates accepted flags from all children</span>
<span class="sd">        - Supports KPI operations across all sub-datasets</span>

<span class="sd">    Type Parameters:</span>
<span class="sd">        DatasetType: Type of datasets that can be collected</span>
<span class="sd">        DatasetConfigType: Configuration class for dataset behavior</span>
<span class="sd">        FlagType: Type used for data flag identification</span>
<span class="sd">        FlagIndexType: Flag index implementation for flag mapping</span>

<span class="sd">    Attributes:</span>
<span class="sd">        datasets (list[DatasetType]): List of child datasets in this collection</span>

<span class="sd">    Note:</span>
<span class="sd">        This class follows the &quot;Everything is a Dataset&quot; principle, allowing</span>
<span class="sd">        collections to be used anywhere a Dataset is expected.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">datasets</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">DatasetType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">parent_dataset</span><span class="p">:</span> <span class="n">Dataset</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">flag_index</span><span class="p">:</span> <span class="n">FlagIndex</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">attributes</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">database</span><span class="p">:</span> <span class="n">Database</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">config</span><span class="p">:</span> <span class="n">DatasetConfigType</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">parent_dataset</span><span class="o">=</span><span class="n">parent_dataset</span><span class="p">,</span>
            <span class="n">flag_index</span><span class="o">=</span><span class="n">flag_index</span><span class="p">,</span>
            <span class="n">attributes</span><span class="o">=</span><span class="n">attributes</span><span class="p">,</span>
            <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">,</span>
            <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">DatasetType</span><span class="p">]</span> <span class="o">=</span> <span class="n">datasets</span> <span class="k">if</span> <span class="n">datasets</span> <span class="k">else</span> <span class="p">[]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">dataset_iterator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">DatasetType</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">ds</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">flag_index</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FlagIndex</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">mescal.flag.flag_index</span><span class="w"> </span><span class="kn">import</span> <span class="n">EmptyFlagIndex</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_flag_index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_flag_index</span><span class="p">,</span> <span class="n">EmptyFlagIndex</span><span class="p">):</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">mescal.utils.check_all_same</span><span class="w"> </span><span class="kn">import</span> <span class="n">all_same_object</span>
            <span class="k">if</span> <span class="n">all_same_object</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">flag_index</span> <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dataset</span><span class="p">()</span><span class="o">.</span><span class="n">flag_index</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flag_index</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="n">child_dataset_atts</span> <span class="o">=</span> <span class="p">[</span><span class="n">ds</span><span class="o">.</span><span class="n">attributes</span> <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">]</span>
        <span class="n">attributes_that_all_childs_have_in_common</span> <span class="o">=</span> <span class="n">get_intersection_of_dicts</span><span class="p">(</span><span class="n">child_dataset_atts</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="o">**</span><span class="n">attributes_that_all_childs_have_in_common</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span><span class="o">.</span><span class="n">copy</span><span class="p">()}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_merged_kpi_collection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;KPICollection&#39;</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">mescal.kpis.kpi_collection</span><span class="w"> </span><span class="kn">import</span> <span class="n">KPICollection</span>
        <span class="n">all_kpis</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">kpi</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">kpi_collection</span><span class="p">:</span>
                <span class="n">all_kpis</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">kpi</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">deep</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">DatasetCollection</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">kpi</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">get_merged_kpi_collection</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="n">deep</span><span class="p">):</span>
                    <span class="n">all_kpis</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">kpi</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">KPICollection</span><span class="p">(</span><span class="n">all_kpis</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_kpis_to_all_sub_datasets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kpis</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">KPIFactory</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">kpi</span> <span class="ow">in</span> <span class="n">kpis</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_kpi_to_all_sub_datasets</span><span class="p">(</span><span class="n">kpi</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_kpi_to_all_sub_datasets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kpi</span><span class="p">:</span> <span class="n">KPIFactory</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">:</span>
            <span class="n">ds</span><span class="o">.</span><span class="n">add_kpi</span><span class="p">(</span><span class="n">kpi</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">clear_kpi_collection_for_all_sub_datasets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">:</span>
            <span class="n">ds</span><span class="o">.</span><span class="n">clear_kpi_collection</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">deep</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">DatasetCollection</span><span class="p">):</span>
                <span class="n">ds</span><span class="o">.</span><span class="n">clear_kpi_collection_for_all_sub_datasets</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="n">deep</span><span class="p">)</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_fetch</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">flag</span><span class="p">:</span> <span class="n">FlagType</span><span class="p">,</span>
            <span class="n">effective_config</span><span class="p">:</span> <span class="n">DatasetConfigType</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">flag_is_accepted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag</span><span class="p">:</span> <span class="n">FlagType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">flag_is_accepted</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span> <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">accepted_flags</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="n">FlagType</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">nested_union</span><span class="p">([</span><span class="n">ds</span><span class="o">.</span><span class="n">accepted_flags</span> <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_required_flags_for_flag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag</span><span class="p">:</span> <span class="n">FlagType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="n">FlagType</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">nested_union</span><span class="p">([</span><span class="n">ds</span><span class="o">.</span><span class="n">accepted_flags</span> <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DatasetType</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No datasets available&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ds</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ds</span>

        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dataset with name &#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_datasets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datasets</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">DatasetType</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">datasets</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_dataset</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">DatasetType</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_child_dataset_type</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Can only add data sets of type </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_child_dataset_type</span><span class="p">()</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">existing</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">existing</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">dataset</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Dataset </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;dataset </span><span class="si">{</span><span class="n">dataset</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> already in this collection. Replacing it.&quot;</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataset</span>
                <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_child_dataset_type</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">type</span><span class="p">[</span><span class="n">DatasetType</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">Dataset</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fetch_merged</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">flag</span><span class="p">:</span> <span class="n">FlagType</span><span class="p">,</span>
            <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="n">DatasetConfigType</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">keep_first</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fetch method that merges dataframes from all child datasets, similar to DatasetMergeCollection.&quot;&quot;&quot;</span>
        <span class="n">temp_merge_collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_merged_dataset_collection</span><span class="p">(</span><span class="n">keep_first</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">temp_merge_collection</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_merged_dataset_collection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keep_first</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;DatasetMergeCollection&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">DatasetMergeCollection</span><span class="p">(</span>
            <span class="n">datasets</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> merged&quot;</span><span class="p">,</span>
            <span class="n">keep_first</span><span class="o">=</span><span class="n">keep_first</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="mescal.datasets.dataset_collection.DatasetCollection.fetch_merged" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">fetch_merged</span>


<a href="#mescal.datasets.dataset_collection.DatasetCollection.fetch_merged" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">fetch_merged</span><span class="p">(</span><span class="n">flag</span><span class="p">:</span> <span class="n"><span title="mescal.typevars.FlagType">FlagType</span></span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n"><span title="dict">dict</span></span> <span class="o">|</span> <span class="n"><span title="mescal.typevars.DatasetConfigType">DatasetConfigType</span></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">keep_first</span><span class="p">:</span> <span class="n"><span title="bool">bool</span></span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="pandas.Series">Series</span></span> <span class="o">|</span> <span class="n"><span title="pandas.DataFrame">DataFrame</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fetch method that merges dataframes from all child datasets, similar to DatasetMergeCollection.</p>


            <details class="quote">
              <summary>Source code in <code>submodules/mescal/mescal/datasets/dataset_collection.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fetch_merged</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">flag</span><span class="p">:</span> <span class="n">FlagType</span><span class="p">,</span>
        <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="n">DatasetConfigType</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">keep_first</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch method that merges dataframes from all child datasets, similar to DatasetMergeCollection.&quot;&quot;&quot;</span>
    <span class="n">temp_merge_collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_merged_dataset_collection</span><span class="p">(</span><span class="n">keep_first</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">temp_merge_collection</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="mescal.datasets.dataset_collection.DatasetLinkCollection" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">DatasetLinkCollection</span>


<a href="#mescal.datasets.dataset_collection.DatasetLinkCollection" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.Generic">Generic</span>[<span title="mescal.typevars.DatasetType">DatasetType</span>, <span title="mescal.typevars.DatasetConfigType">DatasetConfigType</span>, <span title="mescal.typevars.FlagType">FlagType</span>, <span title="mescal.typevars.FlagIndexType">FlagIndexType</span>]</code>, <code><a class="autorefs autorefs-internal" title="            DatasetCollection (mescal.datasets.dataset_collection.DatasetCollection)" href="#mescal.datasets.dataset_collection.DatasetCollection">DatasetCollection</a>[<span title="mescal.typevars.DatasetType">DatasetType</span>, <span title="mescal.typevars.DatasetConfigType">DatasetConfigType</span>, <span title="mescal.typevars.FlagType">FlagType</span>, <span title="mescal.typevars.FlagIndexType">FlagIndexType</span>]</code></p>


        <p>Links multiple datasets to provide unified data access with automatic routing.</p>
<p>DatasetLinkCollection acts as a unified interface to multiple child datasets,
automatically routing data requests to the appropriate child dataset that 
accepts the requested flag. This is the foundation for platform datasets
that combine multiple data interpreters.</p>


<details class="key-features" open>
  <summary>Key Features</summary>
  <ul>
<li>Automatic flag routing to appropriate child dataset</li>
<li>Bidirectional parent-child relationships</li>
<li>First-match-wins routing strategy</li>
<li>Overlap detection and warnings</li>
<li>Maintains all Dataset interface compatibility</li>
</ul>
</details>

<details class="routing-logic" open>
  <summary>Routing Logic</summary>
  <p>When fetch() is called, iterates through child datasets in order and
returns data from the first dataset that accepts the flag.</p>
</details>        <p>Example:</p>
<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; # Platform dataset with multiple interpreters
&gt;&gt;&gt; link_collection = DatasetLinkCollection([
...     ModelInterpreter(network),
...     TimeSeriesInterpreter(network),
...     ObjectiveInterpreter(network)
... ])
&gt;&gt;&gt; # Automatically routes to appropriate interpreter
&gt;&gt;&gt; buses = link_collection.fetch(&#39;buses&#39;)  # -&gt; ModelInterpreter
&gt;&gt;&gt; prices = link_collection.fetch(&#39;buses_t.marginal_price&#39;)  # -&gt; TimeSeriesInterpreter
</code></pre></div>


<details class="warning" open>
  <summary>Warning</summary>
  <p>If multiple child datasets accept the same flag, only the first one
will be used. The constructor logs warnings for such overlaps.</p>
</details>







              <details class="quote">
                <summary>Source code in <code>submodules/mescal/mescal/datasets/dataset_collection.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DatasetLinkCollection</span><span class="p">(</span>
    <span class="n">Generic</span><span class="p">[</span><span class="n">DatasetType</span><span class="p">,</span> <span class="n">DatasetConfigType</span><span class="p">,</span> <span class="n">FlagType</span><span class="p">,</span> <span class="n">FlagIndexType</span><span class="p">],</span>
    <span class="n">DatasetCollection</span><span class="p">[</span><span class="n">DatasetType</span><span class="p">,</span> <span class="n">DatasetConfigType</span><span class="p">,</span> <span class="n">FlagType</span><span class="p">,</span> <span class="n">FlagIndexType</span><span class="p">]</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Links multiple datasets to provide unified data access with automatic routing.</span>

<span class="sd">    DatasetLinkCollection acts as a unified interface to multiple child datasets,</span>
<span class="sd">    automatically routing data requests to the appropriate child dataset that </span>
<span class="sd">    accepts the requested flag. This is the foundation for platform datasets</span>
<span class="sd">    that combine multiple data interpreters.</span>

<span class="sd">    Key Features:</span>
<span class="sd">        - Automatic flag routing to appropriate child dataset</span>
<span class="sd">        - Bidirectional parent-child relationships</span>
<span class="sd">        - First-match-wins routing strategy</span>
<span class="sd">        - Overlap detection and warnings</span>
<span class="sd">        - Maintains all Dataset interface compatibility</span>

<span class="sd">    Routing Logic:</span>
<span class="sd">        When fetch() is called, iterates through child datasets in order and</span>
<span class="sd">        returns data from the first dataset that accepts the flag.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; # Platform dataset with multiple interpreters</span>
<span class="sd">        &gt;&gt;&gt; link_collection = DatasetLinkCollection([</span>
<span class="sd">        ...     ModelInterpreter(network),</span>
<span class="sd">        ...     TimeSeriesInterpreter(network),</span>
<span class="sd">        ...     ObjectiveInterpreter(network)</span>
<span class="sd">        ... ])</span>
<span class="sd">        &gt;&gt;&gt; # Automatically routes to appropriate interpreter</span>
<span class="sd">        &gt;&gt;&gt; buses = link_collection.fetch(&#39;buses&#39;)  # -&gt; ModelInterpreter</span>
<span class="sd">        &gt;&gt;&gt; prices = link_collection.fetch(&#39;buses_t.marginal_price&#39;)  # -&gt; TimeSeriesInterpreter</span>

<span class="sd">    Warning:</span>
<span class="sd">        If multiple child datasets accept the same flag, only the first one</span>
<span class="sd">        will be used. The constructor logs warnings for such overlaps.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">datasets</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">DatasetType</span><span class="p">],</span>
            <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">parent_dataset</span><span class="p">:</span> <span class="n">Dataset</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">flag_index</span><span class="p">:</span> <span class="n">FlagIndex</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">attributes</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">database</span><span class="p">:</span> <span class="n">Database</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">config</span><span class="p">:</span> <span class="n">DatasetConfigType</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">datasets</span><span class="o">=</span><span class="n">datasets</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">parent_dataset</span><span class="o">=</span><span class="n">parent_dataset</span><span class="p">,</span>
            <span class="n">flag_index</span><span class="o">=</span><span class="n">flag_index</span><span class="p">,</span>
            <span class="n">attributes</span><span class="o">=</span><span class="n">attributes</span><span class="p">,</span>
            <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">,</span>
            <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_warn_if_flags_overlap</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag</span><span class="p">:</span> <span class="n">FlagType</span><span class="p">,</span> <span class="n">effective_config</span><span class="p">:</span> <span class="n">DatasetConfigType</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ds</span><span class="o">.</span><span class="n">flag_is_accepted</span><span class="p">(</span><span class="n">flag</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">ds</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="n">effective_config</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Key &#39;</span><span class="si">{</span><span class="n">flag</span><span class="si">}</span><span class="s2">&#39; not recognized by any of the linked Datasets.&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_warn_if_flags_overlap</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">Counter</span>

        <span class="n">accepted_flags</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">:</span>
            <span class="n">accepted_flags</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">accepted_flags</span><span class="p">)</span>

        <span class="n">counts</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">accepted_flags</span><span class="p">)</span>
        <span class="n">duplicates</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">counts</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">}</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">duplicates</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Dataset </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;The following keys have multiple Dataset sources: </span><span class="si">{</span><span class="n">duplicates</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">. </span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Only the first one will be used! This might lead to unexpected behavior. </span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;A potential reason could be the use of an inappropriate DatasetCollection Type.&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_dataset_by_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds_type</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">Dataset</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">DatasetType</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns instance of child dataset that matches the ds_type.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">ds_type</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">ds</span>
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;No Dataset of type </span><span class="si">{</span><span class="n">ds_type</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> found in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="mescal.datasets.dataset_collection.DatasetLinkCollection.get_dataset_by_type" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_dataset_by_type</span>


<a href="#mescal.datasets.dataset_collection.DatasetLinkCollection.get_dataset_by_type" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_dataset_by_type</span><span class="p">(</span><span class="n">ds_type</span><span class="p">:</span> <span class="n"><span title="type">type</span></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Dataset (mescal.datasets.dataset.Dataset)" href="#mescal.datasets.dataset.Dataset">Dataset</a></span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n"><span title="mescal.typevars.DatasetType">DatasetType</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Returns instance of child dataset that matches the ds_type.</p>


            <details class="quote">
              <summary>Source code in <code>submodules/mescal/mescal/datasets/dataset_collection.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_dataset_by_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds_type</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">Dataset</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">DatasetType</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns instance of child dataset that matches the ds_type.&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">ds_type</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">ds</span>
    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;No Dataset of type </span><span class="si">{</span><span class="n">ds_type</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> found in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="mescal.datasets.dataset_collection.DatasetMergeCollection" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">DatasetMergeCollection</span>


<a href="#mescal.datasets.dataset_collection.DatasetMergeCollection" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.Generic">Generic</span>[<span title="mescal.typevars.DatasetType">DatasetType</span>, <span title="mescal.typevars.DatasetConfigType">DatasetConfigType</span>, <span title="mescal.typevars.FlagType">FlagType</span>, <span title="mescal.typevars.FlagIndexType">FlagIndexType</span>]</code>, <code><a class="autorefs autorefs-internal" title="            DatasetCollection (mescal.datasets.dataset_collection.DatasetCollection)" href="#mescal.datasets.dataset_collection.DatasetCollection">DatasetCollection</a>[<span title="mescal.typevars.DatasetType">DatasetType</span>, <span title="mescal.typevars.DatasetConfigType">DatasetConfigType</span>, <span title="mescal.typevars.FlagType">FlagType</span>, <span title="mescal.typevars.FlagIndexType">FlagIndexType</span>]</code></p>


        <p>Fetch method will merge fragmented Datasets for same flag, e.g.:
    - fragmented simulation runs, e.g. CW1, CW2, CW3, CWn.
    - fragmented data sources, e.g. mapping from Excel file with model from simulation platform.</p>








              <details class="quote">
                <summary>Source code in <code>submodules/mescal/mescal/datasets/dataset_collection.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DatasetMergeCollection</span><span class="p">(</span>
    <span class="n">Generic</span><span class="p">[</span><span class="n">DatasetType</span><span class="p">,</span> <span class="n">DatasetConfigType</span><span class="p">,</span> <span class="n">FlagType</span><span class="p">,</span> <span class="n">FlagIndexType</span><span class="p">],</span>
    <span class="n">DatasetCollection</span><span class="p">[</span><span class="n">DatasetType</span><span class="p">,</span> <span class="n">DatasetConfigType</span><span class="p">,</span> <span class="n">FlagType</span><span class="p">,</span> <span class="n">FlagIndexType</span><span class="p">]</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fetch method will merge fragmented Datasets for same flag, e.g.:</span>
<span class="sd">        - fragmented simulation runs, e.g. CW1, CW2, CW3, CWn.</span>
<span class="sd">        - fragmented data sources, e.g. mapping from Excel file with model from simulation platform.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">datasets</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">DatasetType</span><span class="p">],</span>
            <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">parent_dataset</span><span class="p">:</span> <span class="n">Dataset</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">flag_index</span><span class="p">:</span> <span class="n">FlagIndex</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">attributes</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">database</span><span class="p">:</span> <span class="n">Database</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">config</span><span class="p">:</span> <span class="n">DatasetConfigType</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">keep_first</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">datasets</span><span class="o">=</span><span class="n">datasets</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">parent_dataset</span><span class="o">=</span><span class="n">parent_dataset</span><span class="p">,</span>
            <span class="n">flag_index</span><span class="o">=</span><span class="n">flag_index</span><span class="p">,</span>
            <span class="n">attributes</span><span class="o">=</span><span class="n">attributes</span><span class="p">,</span>
            <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">,</span>
            <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keep_first</span> <span class="o">=</span> <span class="n">keep_first</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag</span><span class="p">:</span> <span class="n">FlagType</span><span class="p">,</span> <span class="n">effective_config</span><span class="p">:</span> <span class="n">DatasetConfigType</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">data_frames</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ds</span><span class="o">.</span><span class="n">flag_is_accepted</span><span class="p">(</span><span class="n">flag</span><span class="p">):</span>
                <span class="n">data_frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="n">effective_config</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">data_frames</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Flag &#39;</span><span class="si">{</span><span class="n">flag</span><span class="si">}</span><span class="s2">&#39; not recognized by any of the datasets.&quot;</span><span class="p">)</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">mescal.utils.pandas_utils.combine_df</span><span class="w"> </span><span class="kn">import</span> <span class="n">combine_dfs</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">combine_dfs</span><span class="p">(</span><span class="n">data_frames</span><span class="p">,</span> <span class="n">keep_first</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">keep_first</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="mescal.datasets.dataset_collection.DatasetConcatCollection" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">DatasetConcatCollection</span>


<a href="#mescal.datasets.dataset_collection.DatasetConcatCollection" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.Generic">Generic</span>[<span title="mescal.typevars.DatasetType">DatasetType</span>, <span title="mescal.typevars.DatasetConfigType">DatasetConfigType</span>, <span title="mescal.typevars.FlagType">FlagType</span>, <span title="mescal.typevars.FlagIndexType">FlagIndexType</span>]</code>, <code><a class="autorefs autorefs-internal" title="            DatasetCollection (mescal.datasets.dataset_collection.DatasetCollection)" href="#mescal.datasets.dataset_collection.DatasetCollection">DatasetCollection</a>[<span title="mescal.typevars.DatasetType">DatasetType</span>, <span title="mescal.typevars.DatasetConfigType">DatasetConfigType</span>, <span title="mescal.typevars.FlagType">FlagType</span>, <span title="mescal.typevars.FlagIndexType">FlagIndexType</span>]</code></p>


        <p>Concatenates data from multiple datasets with MultiIndex structure.</p>
<p>DatasetConcatCollection is fundamental to MESCAL's multi-scenario analysis
capabilities. It fetches the same flag from multiple child datasets and
concatenates the results into a single DataFrame/Series with an additional
index level identifying the source dataset.</p>


<details class="key-features" open>
  <summary>Key Features</summary>
  <ul>
<li>Automatic MultiIndex creation with dataset names</li>
<li>Configurable concatenation axis and level positioning  </li>
<li>Preserves all dimensional relationships</li>
<li>Supports scenario and comparison collections</li>
<li>Enables unified analysis across multiple datasets</li>
</ul>
</details>

<details class="multiindex-structure" open>
  <summary>MultiIndex Structure</summary>
  <p>The resulting data structure includes an additional index level
(typically named 'dataset') that identifies the source dataset
for each data point.</p>
</details>        <p>Example:</p>
<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; # Collection of scenario datasets
&gt;&gt;&gt; scenarios = DatasetConcatCollection([
...     PyPSADataset(base_network, name=&#39;base&#39;),
...     PyPSADataset(high_res_network, name=&#39;high_res&#39;),
...     PyPSADataset(low_gas_network, name=&#39;low_gas&#39;)
... ])
&gt;&gt;&gt; 
&gt;&gt;&gt; # Fetch creates MultiIndex DataFrame
&gt;&gt;&gt; prices = scenarios.fetch(&#39;buses_t.marginal_price&#39;)
&gt;&gt;&gt; print(prices.columns.names)
    [&#39;dataset&#39;, &#39;Bus&#39;]  # Original Bus index + dataset level
&gt;&gt;&gt; 
&gt;&gt;&gt; # Access specific scenario data
&gt;&gt;&gt; base_prices = prices[&#39;base&#39;]
&gt;&gt;&gt; 
&gt;&gt;&gt; # Analyze across scenarios
&gt;&gt;&gt; mean_prices = prices.mean()  # Mean across all scenarios
</code></pre></div>








              <details class="quote">
                <summary>Source code in <code>submodules/mescal/mescal/datasets/dataset_collection.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DatasetConcatCollection</span><span class="p">(</span>
    <span class="n">Generic</span><span class="p">[</span><span class="n">DatasetType</span><span class="p">,</span> <span class="n">DatasetConfigType</span><span class="p">,</span> <span class="n">FlagType</span><span class="p">,</span> <span class="n">FlagIndexType</span><span class="p">],</span>
    <span class="n">DatasetCollection</span><span class="p">[</span><span class="n">DatasetType</span><span class="p">,</span> <span class="n">DatasetConfigType</span><span class="p">,</span> <span class="n">FlagType</span><span class="p">,</span> <span class="n">FlagIndexType</span><span class="p">]</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Concatenates data from multiple datasets with MultiIndex structure.</span>

<span class="sd">    DatasetConcatCollection is fundamental to MESCAL&#39;s multi-scenario analysis</span>
<span class="sd">    capabilities. It fetches the same flag from multiple child datasets and</span>
<span class="sd">    concatenates the results into a single DataFrame/Series with an additional</span>
<span class="sd">    index level identifying the source dataset.</span>

<span class="sd">    Key Features:</span>
<span class="sd">        - Automatic MultiIndex creation with dataset names</span>
<span class="sd">        - Configurable concatenation axis and level positioning  </span>
<span class="sd">        - Preserves all dimensional relationships</span>
<span class="sd">        - Supports scenario and comparison collections</span>
<span class="sd">        - Enables unified analysis across multiple datasets</span>

<span class="sd">    MultiIndex Structure:</span>
<span class="sd">        The resulting data structure includes an additional index level</span>
<span class="sd">        (typically named &#39;dataset&#39;) that identifies the source dataset</span>
<span class="sd">        for each data point.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; # Collection of scenario datasets</span>
<span class="sd">        &gt;&gt;&gt; scenarios = DatasetConcatCollection([</span>
<span class="sd">        ...     PyPSADataset(base_network, name=&#39;base&#39;),</span>
<span class="sd">        ...     PyPSADataset(high_res_network, name=&#39;high_res&#39;),</span>
<span class="sd">        ...     PyPSADataset(low_gas_network, name=&#39;low_gas&#39;)</span>
<span class="sd">        ... ])</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # Fetch creates MultiIndex DataFrame</span>
<span class="sd">        &gt;&gt;&gt; prices = scenarios.fetch(&#39;buses_t.marginal_price&#39;)</span>
<span class="sd">        &gt;&gt;&gt; print(prices.columns.names)</span>
<span class="sd">            [&#39;dataset&#39;, &#39;Bus&#39;]  # Original Bus index + dataset level</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # Access specific scenario data</span>
<span class="sd">        &gt;&gt;&gt; base_prices = prices[&#39;base&#39;]</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # Analyze across scenarios</span>
<span class="sd">        &gt;&gt;&gt; mean_prices = prices.mean()  # Mean across all scenarios</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">DEFAULT_CONCAT_LEVEL_NAME</span> <span class="o">=</span> <span class="s1">&#39;dataset&#39;</span>
    <span class="n">DEFAULT_ATT_LEVEL_NAME</span> <span class="o">=</span> <span class="s1">&#39;attribute&#39;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">datasets</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">DatasetType</span><span class="p">],</span>
            <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">parent_dataset</span><span class="p">:</span> <span class="n">Dataset</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">flag_index</span><span class="p">:</span> <span class="n">FlagIndex</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">attributes</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">database</span><span class="p">:</span> <span class="n">Database</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">config</span><span class="p">:</span> <span class="n">DatasetConfigType</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">default_concat_axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">concat_top</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">concat_level_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">datasets</span><span class="o">=</span><span class="n">datasets</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">parent_dataset</span><span class="o">=</span><span class="n">parent_dataset</span><span class="p">,</span>
            <span class="n">flag_index</span><span class="o">=</span><span class="n">flag_index</span><span class="p">,</span>
            <span class="n">attributes</span><span class="o">=</span><span class="n">attributes</span><span class="p">,</span>
            <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">,</span>
            <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">datasets</span><span class="o">=</span><span class="n">datasets</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_concat_axis</span> <span class="o">=</span> <span class="n">default_concat_axis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">concat_top</span> <span class="o">=</span> <span class="n">concat_top</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">concat_level_name</span> <span class="o">=</span> <span class="n">concat_level_name</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_CONCAT_LEVEL_NAME</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_attributes_concat_df</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">DatasetConcatCollection</span><span class="p">)</span> <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">):</span>
            <span class="n">use_att_df_instead_of_series</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">use_att_df_instead_of_series</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">atts_per_dataset</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">:</span>
            <span class="n">atts</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">get_attributes_concat_df</span><span class="p">()</span><span class="o">.</span><span class="n">T</span> <span class="k">if</span> <span class="n">use_att_df_instead_of_series</span> <span class="k">else</span> <span class="n">ds</span><span class="o">.</span><span class="n">get_attributes_series</span><span class="p">()</span>
            <span class="n">atts_per_dataset</span><span class="p">[</span><span class="n">ds</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">atts</span>

        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
            <span class="n">atts_per_dataset</span><span class="p">,</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">concat_level_name</span><span class="p">]</span>
        <span class="p">)</span><span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_ATT_LEVEL_NAME</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_fetch</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">flag</span><span class="p">:</span> <span class="n">FlagType</span><span class="p">,</span>
            <span class="n">effective_config</span><span class="p">:</span> <span class="n">DatasetConfigType</span><span class="p">,</span>
            <span class="n">concat_axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">concat_axis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">concat_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_concat_axis</span>

        <span class="n">dfs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ds</span><span class="o">.</span><span class="n">flag_is_accepted</span><span class="p">(</span><span class="n">flag</span><span class="p">):</span>
                <span class="n">dfs</span><span class="p">[</span><span class="n">ds</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="n">effective_config</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">dfs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Flag &#39;</span><span class="si">{</span><span class="n">flag</span><span class="si">}</span><span class="s2">&#39; not recognized by any of the datasets in </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

        <span class="n">df0</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dfs</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">df0</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span> <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dfs</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Axes lengths do not match between dfs.&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df0</span><span class="o">.</span><span class="n">axes</span><span class="p">)):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">df0</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dfs</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Axes names do not match between dfs.&#39;</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dfs</span><span class="p">,</span> <span class="n">join</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">concat_axis</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">concat_level_name</span><span class="p">])</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">concat_top</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">concat_axis</span><span class="p">]</span>
            <span class="n">df</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">concat_axis</span><span class="p">]</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">reorder_levels</span><span class="p">([</span><span class="n">ax</span><span class="o">.</span><span class="n">nlevels</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">nlevels</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="mescal.datasets.dataset_comparison" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">dataset_comparison</span>


<a href="#mescal.datasets.dataset_comparison" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="mescal.datasets.dataset_comparison.DatasetComparison" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">DatasetComparison</span>


<a href="#mescal.datasets.dataset_comparison.DatasetComparison" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.Generic">Generic</span>[<span title="mescal.typevars.DatasetType">DatasetType</span>, <span title="mescal.typevars.DatasetConfigType">DatasetConfigType</span>, <span title="mescal.typevars.FlagType">FlagType</span>, <span title="mescal.typevars.FlagIndexType">FlagIndexType</span>]</code>, <code><a class="autorefs autorefs-internal" title="            DatasetCollection (mescal.datasets.dataset_collection.DatasetCollection)" href="#mescal.datasets.dataset_collection.DatasetCollection">DatasetCollection</a>[<span title="mescal.typevars.DatasetType">DatasetType</span>, <span title="mescal.typevars.DatasetConfigType">DatasetConfigType</span>, <span title="mescal.typevars.FlagType">FlagType</span>, <span title="mescal.typevars.FlagIndexType">FlagIndexType</span>]</code></p>


        <p>Computes and provides access to differences between two datasets.</p>
<p>DatasetComparison is a core component of MESCAL's scenario comparison capabilities.
It automatically calculates deltas, ratios, or side-by-side comparisons between
a variation dataset and a reference dataset, enabling systematic analysis of
scenario differences.</p>


<details class="key-features" open>
  <summary>Key Features</summary>
  <ul>
<li>Automatic delta computation between datasets</li>
<li>Multiple comparison types (DELTA, VARIATION, BOTH)</li>
<li>Handles numeric and non-numeric data appropriately</li>
<li>Preserves data structure and index relationships</li>
<li>Configurable unchanged value handling</li>
<li>Inherits full Dataset interface</li>
</ul>
</details>

<details class="comparison-types" open>
  <summary>Comparison Types</summary>
  <ul>
<li>DELTA: Variation - Reference (default)</li>
<li>VARIATION: Returns variation data with optional NaN for unchanged values</li>
<li>BOTH: Side-by-side variation and reference data</li>
</ul>
</details>

<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="mescal.datasets.dataset_comparison.DatasetComparison.variation_dataset">variation_dataset</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dataset representing the scenario being compared</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mescal.datasets.dataset_comparison.DatasetComparison.reference_dataset">reference_dataset</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dataset representing the baseline for comparison</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Example:</p>
<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; # Compare high renewable scenario to base case
&gt;&gt;&gt; comparison = DatasetComparison(
...     variation_dataset=high_res_dataset,
...     reference_dataset=base_dataset
... )
&gt;&gt;&gt; 
&gt;&gt;&gt; # Get price differences
&gt;&gt;&gt; price_deltas = comparison.fetch(&#39;buses_t.marginal_price&#39;)
&gt;&gt;&gt; 
&gt;&gt;&gt; # Get both datasets side-by-side (often used to show model changes)
&gt;&gt;&gt; price_both = comparison.fetch(&#39;buses&#39;, comparison_type=ComparisonTypeEnum.BOTH)
&gt;&gt;&gt; 
&gt;&gt;&gt; # Highlight only changes (often used to show model changes)
&gt;&gt;&gt; price_changes = comparison.fetch(&#39;buses&#39;, replace_unchanged_values_by_nan=True)
</code></pre></div>








              <details class="quote">
                <summary>Source code in <code>submodules/mescal/mescal/datasets/dataset_comparison.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DatasetComparison</span><span class="p">(</span>
    <span class="n">Generic</span><span class="p">[</span><span class="n">DatasetType</span><span class="p">,</span> <span class="n">DatasetConfigType</span><span class="p">,</span> <span class="n">FlagType</span><span class="p">,</span> <span class="n">FlagIndexType</span><span class="p">],</span>
    <span class="n">DatasetCollection</span><span class="p">[</span><span class="n">DatasetType</span><span class="p">,</span> <span class="n">DatasetConfigType</span><span class="p">,</span> <span class="n">FlagType</span><span class="p">,</span> <span class="n">FlagIndexType</span><span class="p">]</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes and provides access to differences between two datasets.</span>

<span class="sd">    DatasetComparison is a core component of MESCAL&#39;s scenario comparison capabilities.</span>
<span class="sd">    It automatically calculates deltas, ratios, or side-by-side comparisons between</span>
<span class="sd">    a variation dataset and a reference dataset, enabling systematic analysis of</span>
<span class="sd">    scenario differences.</span>

<span class="sd">    Key Features:</span>
<span class="sd">        - Automatic delta computation between datasets</span>
<span class="sd">        - Multiple comparison types (DELTA, VARIATION, BOTH)</span>
<span class="sd">        - Handles numeric and non-numeric data appropriately</span>
<span class="sd">        - Preserves data structure and index relationships</span>
<span class="sd">        - Configurable unchanged value handling</span>
<span class="sd">        - Inherits full Dataset interface</span>

<span class="sd">    Comparison Types:</span>
<span class="sd">        - DELTA: Variation - Reference (default)</span>
<span class="sd">        - VARIATION: Returns variation data with optional NaN for unchanged values</span>
<span class="sd">        - BOTH: Side-by-side variation and reference data</span>

<span class="sd">    Attributes:</span>
<span class="sd">        variation_dataset: The dataset representing the scenario being compared</span>
<span class="sd">        reference_dataset: The dataset representing the baseline for comparison</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; # Compare high renewable scenario to base case</span>
<span class="sd">        &gt;&gt;&gt; comparison = DatasetComparison(</span>
<span class="sd">        ...     variation_dataset=high_res_dataset,</span>
<span class="sd">        ...     reference_dataset=base_dataset</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # Get price differences</span>
<span class="sd">        &gt;&gt;&gt; price_deltas = comparison.fetch(&#39;buses_t.marginal_price&#39;)</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # Get both datasets side-by-side (often used to show model changes)</span>
<span class="sd">        &gt;&gt;&gt; price_both = comparison.fetch(&#39;buses&#39;, comparison_type=ComparisonTypeEnum.BOTH)</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # Highlight only changes (often used to show model changes)</span>
<span class="sd">        &gt;&gt;&gt; price_changes = comparison.fetch(&#39;buses&#39;, replace_unchanged_values_by_nan=True)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">COMPARISON_ATTRIBUTES_SOURCE</span> <span class="o">=</span> <span class="n">ComparisonAttributesSourceEnum</span><span class="o">.</span><span class="n">USE_VARIATION_ATTS</span>
    <span class="n">COMPARISON_NAME_JOIN</span> <span class="o">=</span> <span class="s1">&#39; vs &#39;</span>
    <span class="n">VARIATION_DS_ATT_KEY</span> <span class="o">=</span> <span class="s1">&#39;variation_dataset&#39;</span>
    <span class="n">REFERENCE_DS_ATT_KEY</span> <span class="o">=</span> <span class="s1">&#39;reference_dataset&#39;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">variation_dataset</span><span class="p">:</span> <span class="n">Dataset</span><span class="p">,</span>
            <span class="n">reference_dataset</span><span class="p">:</span> <span class="n">Dataset</span><span class="p">,</span>
            <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">attributes</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">config</span><span class="p">:</span> <span class="n">DatasetConfigType</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_auto_generated_name</span><span class="p">(</span><span class="n">variation_dataset</span><span class="p">,</span> <span class="n">reference_dataset</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="p">[</span><span class="n">reference_dataset</span><span class="p">,</span> <span class="n">variation_dataset</span><span class="p">],</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">attributes</span><span class="o">=</span><span class="n">attributes</span><span class="p">,</span>
            <span class="n">config</span><span class="o">=</span><span class="n">config</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">variation_dataset</span> <span class="o">=</span> <span class="n">variation_dataset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reference_dataset</span> <span class="o">=</span> <span class="n">reference_dataset</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_auto_generated_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variation_dataset</span><span class="p">:</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">reference_dataset</span><span class="p">:</span> <span class="n">Dataset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">variation_dataset</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">COMPARISON_NAME_JOIN</span> <span class="o">+</span> <span class="n">reference_dataset</span><span class="o">.</span><span class="n">name</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">match</span> <span class="bp">self</span><span class="o">.</span><span class="n">COMPARISON_ATTRIBUTES_SOURCE</span><span class="p">:</span>
            <span class="k">case</span> <span class="n">ComparisonAttributesSourceEnum</span><span class="o">.</span><span class="n">USE_VARIATION_ATTS</span><span class="p">:</span>
                <span class="n">atts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variation_dataset</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">case</span> <span class="n">ComparisonAttributesSourceEnum</span><span class="o">.</span><span class="n">USE_REFERENCE_ATTS</span><span class="p">:</span>
                <span class="n">atts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference_dataset</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
                <span class="n">atts</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">attributes</span>
        <span class="n">atts</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">VARIATION_DS_ATT_KEY</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variation_dataset</span><span class="o">.</span><span class="n">name</span>
        <span class="n">atts</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">REFERENCE_DS_ATT_KEY</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference_dataset</span><span class="o">.</span><span class="n">name</span>
        <span class="k">return</span> <span class="n">atts</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fetch</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">flag</span><span class="p">:</span> <span class="n">FlagType</span><span class="p">,</span>
            <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="n">DatasetConfigType</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">comparison_type</span><span class="p">:</span> <span class="n">ComparisonTypeEnum</span> <span class="o">=</span> <span class="n">ComparisonTypeEnum</span><span class="o">.</span><span class="n">DELTA</span><span class="p">,</span>
            <span class="n">replace_unchanged_values_by_nan</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">fill_value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetch comparison data between variation and reference datasets.</span>

<span class="sd">        Extends the base Dataset.fetch() method with comparison-specific parameters</span>
<span class="sd">        for controlling how the comparison is computed and formatted.</span>

<span class="sd">        Args:</span>
<span class="sd">            flag: Data identifier flag to fetch from both datasets</span>
<span class="sd">            config: Optional configuration overrides</span>
<span class="sd">            comparison_type: How to compare the datasets:</span>
<span class="sd">                - DELTA: variation - reference (default)</span>
<span class="sd">                - VARIATION: variation data only, optionally with NaN for unchanged</span>
<span class="sd">                - BOTH: concatenated variation and reference data</span>
<span class="sd">            replace_unchanged_values_by_nan: If True, replaces values that are</span>
<span class="sd">                identical between datasets with NaN (useful for highlighting changes)</span>
<span class="sd">            fill_value: Value to use for missing data in subtraction operations</span>
<span class="sd">            **kwargs: Additional arguments passed to child dataset fetch methods</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataFrame or Series with comparison results</span>

<span class="sd">        Example:</span>

<span class="sd">            &gt;&gt;&gt; # Basic delta comparison</span>
<span class="sd">            &gt;&gt;&gt; deltas = comparison.fetch(&#39;buses_t.marginal_price&#39;)</span>
<span class="sd">            &gt;&gt;&gt; </span>
<span class="sd">            &gt;&gt;&gt; # Highlight only changed values</span>
<span class="sd">            &gt;&gt;&gt; changes_only = comparison.fetch(</span>
<span class="sd">            ...     &#39;buses_t.marginal_price&#39;,</span>
<span class="sd">            ...     replace_unchanged_values_by_nan=True</span>
<span class="sd">            ... )</span>
<span class="sd">            &gt;&gt;&gt; </span>
<span class="sd">            &gt;&gt;&gt; # Side-by-side comparison</span>
<span class="sd">            &gt;&gt;&gt; both = comparison.fetch(</span>
<span class="sd">            ...     &#39;buses_t.marginal_price&#39;,</span>
<span class="sd">            ...     comparison_type=ComparisonTypeEnum.BOTH</span>
<span class="sd">            ... )</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span>
            <span class="n">flag</span><span class="o">=</span><span class="n">flag</span><span class="p">,</span>
            <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
            <span class="n">comparison_type</span><span class="o">=</span><span class="n">comparison_type</span><span class="p">,</span>
            <span class="n">replace_unchanged_values_by_nan</span><span class="o">=</span><span class="n">replace_unchanged_values_by_nan</span><span class="p">,</span>
            <span class="n">fill_value</span><span class="o">=</span><span class="n">fill_value</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_fetch</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">flag</span><span class="p">:</span> <span class="n">FlagType</span><span class="p">,</span>
            <span class="n">effective_config</span><span class="p">:</span> <span class="n">DatasetConfigType</span><span class="p">,</span>
            <span class="n">comparison_type</span><span class="p">:</span> <span class="n">ComparisonTypeEnum</span> <span class="o">=</span> <span class="n">ComparisonTypeEnum</span><span class="o">.</span><span class="n">DELTA</span><span class="p">,</span>
            <span class="n">replace_unchanged_values_by_nan</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">fill_value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">df_var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variation_dataset</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="n">effective_config</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">df_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference_dataset</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="n">effective_config</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">match</span> <span class="n">comparison_type</span><span class="p">:</span>
            <span class="k">case</span> <span class="n">ComparisonTypeEnum</span><span class="o">.</span><span class="n">VARIATION</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_variation_comparison</span><span class="p">(</span><span class="n">df_var</span><span class="p">,</span> <span class="n">df_ref</span><span class="p">,</span> <span class="n">replace_unchanged_values_by_nan</span><span class="p">)</span>
            <span class="k">case</span> <span class="n">ComparisonTypeEnum</span><span class="o">.</span><span class="n">BOTH</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_both_comparison</span><span class="p">(</span><span class="n">df_var</span><span class="p">,</span> <span class="n">df_ref</span><span class="p">,</span> <span class="n">replace_unchanged_values_by_nan</span><span class="p">)</span>
            <span class="k">case</span> <span class="n">ComparisonTypeEnum</span><span class="o">.</span><span class="n">DELTA</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_delta_comparison</span><span class="p">(</span><span class="n">df_var</span><span class="p">,</span> <span class="n">df_ref</span><span class="p">,</span> <span class="n">replace_unchanged_values_by_nan</span><span class="p">,</span> <span class="n">fill_value</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported comparison_type: </span><span class="si">{</span><span class="n">comparison_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_values_are_equal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val1</span><span class="p">,</span> <span class="n">val2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">val1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">val2</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">val1</span> <span class="o">==</span> <span class="n">val2</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">val1</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">val2</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_variation_comparison</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">df_var</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
            <span class="n">df_ref</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
            <span class="n">replace_unchanged_values_by_nan</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">df_var</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">replace_unchanged_values_by_nan</span><span class="p">:</span>
            <span class="n">common_indices</span> <span class="o">=</span> <span class="n">df_var</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">df_ref</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="n">common_columns</span> <span class="o">=</span> <span class="n">df_var</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">df_ref</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">common_indices</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">common_columns</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_values_are_equal</span><span class="p">(</span><span class="n">df_var</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col</span><span class="p">],</span> <span class="n">df_ref</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col</span><span class="p">]):</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_both_comparison</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">df_var</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
            <span class="n">df_ref</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
            <span class="n">replace_unchanged_values_by_nan</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">var_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variation_dataset</span><span class="o">.</span><span class="n">name</span>
        <span class="n">ref_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference_dataset</span><span class="o">.</span><span class="n">name</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_var</span><span class="p">,</span> <span class="n">df_ref</span><span class="p">],</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="n">var_name</span><span class="p">,</span> <span class="n">ref_name</span><span class="p">])</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">replace_unchanged_values_by_nan</span><span class="p">:</span>
            <span class="n">common_indices</span> <span class="o">=</span> <span class="n">df_var</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">df_ref</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="n">common_columns</span> <span class="o">=</span> <span class="n">df_var</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">df_ref</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">common_indices</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">common_columns</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_values_are_equal</span><span class="p">(</span><span class="n">df_var</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col</span><span class="p">],</span> <span class="n">df_ref</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col</span><span class="p">]):</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">var_name</span><span class="p">,</span> <span class="n">idx</span><span class="p">),</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">)</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">ref_name</span><span class="p">,</span> <span class="n">idx</span><span class="p">),</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_delta_comparison</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">df_var</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
            <span class="n">df_ref</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
            <span class="n">replace_unchanged_values_by_nan</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
            <span class="n">fill_value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">pd_is_numeric</span><span class="p">(</span><span class="n">df_var</span><span class="p">)</span> <span class="ow">and</span> <span class="n">pd_is_numeric</span><span class="p">(</span><span class="n">df_ref</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">df_var</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">df_ref</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">fill_value</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">replace_unchanged_values_by_nan</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">result</span>

        <span class="n">all_columns</span> <span class="o">=</span> <span class="n">df_var</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">df_ref</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
        <span class="n">all_indices</span> <span class="o">=</span> <span class="n">df_var</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">df_ref</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">all_indices</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">all_columns</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">all_columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df_var</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df_ref</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">var_col</span> <span class="o">=</span> <span class="n">df_var</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
                <span class="n">ref_col</span> <span class="o">=</span> <span class="n">df_ref</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>

                <span class="c1"># Special handling for boolean columns</span>
                <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_bool_dtype</span><span class="p">(</span><span class="n">var_col</span><span class="p">)</span> <span class="ow">and</span> <span class="n">pd</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_bool_dtype</span><span class="p">(</span><span class="n">ref_col</span><span class="p">):</span>
                    <span class="c1"># For booleans, we can mark where they differ</span>
                    <span class="n">common_indices</span> <span class="o">=</span> <span class="n">var_col</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">ref_col</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                    <span class="n">delta</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">all_indices</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">common_indices</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">var_col</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">!=</span> <span class="n">ref_col</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">]:</span>
                            <span class="n">delta</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var_col</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="si">}</span><span class="s2"> (was </span><span class="si">{</span><span class="n">ref_col</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span>
                        <span class="k">elif</span> <span class="ow">not</span> <span class="n">replace_unchanged_values_by_nan</span><span class="p">:</span>
                            <span class="n">delta</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">var_col</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

                    <span class="c1"># Handle indices only in variation</span>
                    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">var_col</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">ref_col</span><span class="o">.</span><span class="n">index</span><span class="p">):</span>
                        <span class="n">delta</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var_col</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="si">}</span><span class="s2"> (new)&quot;</span>

                    <span class="c1"># Handle indices only in reference</span>
                    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">ref_col</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">var_col</span><span class="o">.</span><span class="n">index</span><span class="p">):</span>
                        <span class="n">delta</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;DELETED: </span><span class="si">{</span><span class="n">ref_col</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>

                    <span class="n">result</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">delta</span>

                <span class="k">elif</span> <span class="n">pd</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_numeric_dtype</span><span class="p">(</span><span class="n">var_col</span><span class="p">)</span> <span class="ow">and</span> <span class="n">pd</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_numeric_dtype</span><span class="p">(</span><span class="n">ref_col</span><span class="p">):</span>
                    <span class="n">delta</span> <span class="o">=</span> <span class="n">var_col</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">ref_col</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">fill_value</span><span class="p">)</span>
                    <span class="n">result</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">delta</span>

                    <span class="k">if</span> <span class="n">replace_unchanged_values_by_nan</span><span class="p">:</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">delta</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">common_indices</span> <span class="o">=</span> <span class="n">var_col</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">ref_col</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                    <span class="n">var_only_indices</span> <span class="o">=</span> <span class="n">var_col</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">ref_col</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                    <span class="n">ref_only_indices</span> <span class="o">=</span> <span class="n">ref_col</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">var_col</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">common_indices</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_values_are_equal</span><span class="p">(</span><span class="n">var_col</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">ref_col</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">]):</span>
                            <span class="n">result</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var_col</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="si">}</span><span class="s2"> (was </span><span class="si">{</span><span class="n">ref_col</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span>
                        <span class="k">elif</span> <span class="ow">not</span> <span class="n">replace_unchanged_values_by_nan</span><span class="p">:</span>
                            <span class="n">result</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">var_col</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

                    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">var_only_indices</span><span class="p">:</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var_col</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="si">}</span><span class="s2"> (new)&quot;</span>

                    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">ref_only_indices</span><span class="p">:</span>
                        <span class="n">val</span> <span class="o">=</span> <span class="n">ref_col</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
                            <span class="n">result</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;DELETED: </span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="k">elif</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df_var</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">df_var</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">df_var</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="p">]</span><span class="si">}</span><span class="s2"> (new column)&quot;</span>

            <span class="k">else</span><span class="p">:</span>  <span class="c1"># Column only in reference</span>
                <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">df_ref</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">df_ref</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;REMOVED: </span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="mescal.datasets.dataset_comparison.DatasetComparison.fetch" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">fetch</span>


<a href="#mescal.datasets.dataset_comparison.DatasetComparison.fetch" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">fetch</span><span class="p">(</span><span class="n">flag</span><span class="p">:</span> <span class="n"><span title="mescal.typevars.FlagType">FlagType</span></span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n"><span title="dict">dict</span></span> <span class="o">|</span> <span class="n"><span title="mescal.typevars.DatasetConfigType">DatasetConfigType</span></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">comparison_type</span><span class="p">:</span> <span class="n"><span title="mescal.enums.ComparisonTypeEnum">ComparisonTypeEnum</span></span> <span class="o">=</span> <span class="n"><span title="mescal.enums.ComparisonTypeEnum.DELTA">DELTA</span></span><span class="p">,</span> <span class="n">replace_unchanged_values_by_nan</span><span class="p">:</span> <span class="n"><span title="bool">bool</span></span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">fill_value</span><span class="p">:</span> <span class="n"><span title="float">float</span></span> <span class="o">|</span> <span class="n"><span title="int">int</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="pandas.Series">Series</span></span> <span class="o">|</span> <span class="n"><span title="pandas.DataFrame">DataFrame</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fetch comparison data between variation and reference datasets.</p>
<p>Extends the base Dataset.fetch() method with comparison-specific parameters
for controlling how the comparison is computed and formatted.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>flag</code>
            </td>
            <td>
                  <code><span title="mescal.typevars.FlagType">FlagType</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Data identifier flag to fetch from both datasets</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>config</code>
            </td>
            <td>
                  <code><span title="dict">dict</span> | <span title="mescal.typevars.DatasetConfigType">DatasetConfigType</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional configuration overrides</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>comparison_type</code>
            </td>
            <td>
                  <code><span title="mescal.enums.ComparisonTypeEnum">ComparisonTypeEnum</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How to compare the datasets:
- DELTA: variation - reference (default)
- VARIATION: variation data only, optionally with NaN for unchanged
- BOTH: concatenated variation and reference data</p>
              </div>
            </td>
            <td>
                  <code><span title="mescal.enums.ComparisonTypeEnum.DELTA">DELTA</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>replace_unchanged_values_by_nan</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, replaces values that are
identical between datasets with NaN (useful for highlighting changes)</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fill_value</code>
            </td>
            <td>
                  <code><span title="float">float</span> | <span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Value to use for missing data in subtraction operations</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional arguments passed to child dataset fetch methods</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.Series">Series</span> | <span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame or Series with comparison results</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Example:</p>
<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; # Basic delta comparison
&gt;&gt;&gt; deltas = comparison.fetch(&#39;buses_t.marginal_price&#39;)
&gt;&gt;&gt; 
&gt;&gt;&gt; # Highlight only changed values
&gt;&gt;&gt; changes_only = comparison.fetch(
...     &#39;buses_t.marginal_price&#39;,
...     replace_unchanged_values_by_nan=True
... )
&gt;&gt;&gt; 
&gt;&gt;&gt; # Side-by-side comparison
&gt;&gt;&gt; both = comparison.fetch(
...     &#39;buses_t.marginal_price&#39;,
...     comparison_type=ComparisonTypeEnum.BOTH
... )
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>submodules/mescal/mescal/datasets/dataset_comparison.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fetch</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">flag</span><span class="p">:</span> <span class="n">FlagType</span><span class="p">,</span>
        <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="n">DatasetConfigType</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">comparison_type</span><span class="p">:</span> <span class="n">ComparisonTypeEnum</span> <span class="o">=</span> <span class="n">ComparisonTypeEnum</span><span class="o">.</span><span class="n">DELTA</span><span class="p">,</span>
        <span class="n">replace_unchanged_values_by_nan</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">fill_value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fetch comparison data between variation and reference datasets.</span>

<span class="sd">    Extends the base Dataset.fetch() method with comparison-specific parameters</span>
<span class="sd">    for controlling how the comparison is computed and formatted.</span>

<span class="sd">    Args:</span>
<span class="sd">        flag: Data identifier flag to fetch from both datasets</span>
<span class="sd">        config: Optional configuration overrides</span>
<span class="sd">        comparison_type: How to compare the datasets:</span>
<span class="sd">            - DELTA: variation - reference (default)</span>
<span class="sd">            - VARIATION: variation data only, optionally with NaN for unchanged</span>
<span class="sd">            - BOTH: concatenated variation and reference data</span>
<span class="sd">        replace_unchanged_values_by_nan: If True, replaces values that are</span>
<span class="sd">            identical between datasets with NaN (useful for highlighting changes)</span>
<span class="sd">        fill_value: Value to use for missing data in subtraction operations</span>
<span class="sd">        **kwargs: Additional arguments passed to child dataset fetch methods</span>

<span class="sd">    Returns:</span>
<span class="sd">        DataFrame or Series with comparison results</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; # Basic delta comparison</span>
<span class="sd">        &gt;&gt;&gt; deltas = comparison.fetch(&#39;buses_t.marginal_price&#39;)</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # Highlight only changed values</span>
<span class="sd">        &gt;&gt;&gt; changes_only = comparison.fetch(</span>
<span class="sd">        ...     &#39;buses_t.marginal_price&#39;,</span>
<span class="sd">        ...     replace_unchanged_values_by_nan=True</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # Side-by-side comparison</span>
<span class="sd">        &gt;&gt;&gt; both = comparison.fetch(</span>
<span class="sd">        ...     &#39;buses_t.marginal_price&#39;,</span>
<span class="sd">        ...     comparison_type=ComparisonTypeEnum.BOTH</span>
<span class="sd">        ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span>
        <span class="n">flag</span><span class="o">=</span><span class="n">flag</span><span class="p">,</span>
        <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
        <span class="n">comparison_type</span><span class="o">=</span><span class="n">comparison_type</span><span class="p">,</span>
        <span class="n">replace_unchanged_values_by_nan</span><span class="o">=</span><span class="n">replace_unchanged_values_by_nan</span><span class="p">,</span>
        <span class="n">fill_value</span><span class="o">=</span><span class="n">fill_value</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="mescal.datasets.platform_dataset" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">platform_dataset</span>


<a href="#mescal.datasets.platform_dataset" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="mescal.datasets.platform_dataset.PlatformDataset" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">PlatformDataset</span>


<a href="#mescal.datasets.platform_dataset.PlatformDataset" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.Generic">Generic</span>[<span title="mescal.typevars.DatasetType">DatasetType</span>, <span title="mescal.typevars.DatasetConfigType">DatasetConfigType</span>, <span title="mescal.typevars.FlagType">FlagType</span>, <span title="mescal.typevars.FlagIndexType">FlagIndexType</span>]</code>, <code><a class="autorefs autorefs-internal" title="            DatasetLinkCollection (mescal.datasets.dataset_collection.DatasetLinkCollection)" href="#mescal.datasets.dataset_collection.DatasetLinkCollection">DatasetLinkCollection</a>[<span title="mescal.typevars.DatasetType">DatasetType</span>, <span title="mescal.typevars.DatasetConfigType">DatasetConfigType</span>, <span title="mescal.typevars.FlagType">FlagType</span>, <span title="mescal.typevars.FlagIndexType">FlagIndexType</span>]</code>, <code><span title="abc.ABC">ABC</span></code></p>


        <p>Base class for platform-specific datasets with automatic interpreter management.</p>
<p>PlatformDataset provides the foundation for integrating MESCAL with specific
energy modeling platforms (PyPSA, PLEXOS, etc.). It manages a registry of
data interpreters and automatically instantiates them to handle different
types of platform data.</p>


<details class="key-features" open>
  <summary>Key Features</summary>
  <ul>
<li>Automatic interpreter registration and instantiation</li>
<li>Type-safe interpreter management through generics</li>
<li>Flexible argument passing to interpreter constructors</li>
<li>Support for study-specific interpreter extensions</li>
<li>Unified data access through DatasetLinkCollection routing</li>
</ul>
</details>

<details class="architecture" open>
  <summary>Architecture</summary>
  <ul>
<li>Uses DatasetLinkCollection for automatic flag routing</li>
<li>Manages interpreter registry at class level</li>
<li>Auto-instantiates all registered interpreters on construction</li>
<li>Supports inheritance and interpreter registration on subclasses</li>
</ul>
</details>

<p>
      <span class="doc-section-title">
        Class Type Parameters:
      </span>
    </p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Bound or Constraints</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>DatasetType</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Base type for all interpreters (must be Dataset subclass)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>DatasetConfigType</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration class for dataset behavior</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>FlagType</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type used for data flag identification</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>FlagIndexType</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag index implementation for flag mapping</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<details class="class-attributes" open>
  <summary>Class Attributes</summary>
  <p>_interpreter_registry: List of registered interpreter classes</p>
</details>

<details class="usage-pattern" open>
  <summary>Usage Pattern</summary>
  <ol>
<li>Create platform dataset class inheriting from PlatformDataset</li>
<li>Define get_child_dataset_type() to specify interpreter base class</li>
<li>Create interpreter classes inheriting from the base interpreter</li>
<li>Register interpreters using @PlatformDataset.register_interpreter</li>
<li>Instantiate platform dataset - interpreters are auto-created</li>
</ol>
</details>        <p>Example:</p>
<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; # Define platform dataset
&gt;&gt;&gt; class PyPSADataset(PlatformDataset[PyPSAInterpreter, ...]):
...     @classmethod
...     def get_child_dataset_type(cls):
...         return PyPSAInterpreter
...
&gt;&gt;&gt; # Register core interpreters
&gt;&gt;&gt; @PyPSADataset.register_interpreter
... class PyPSAModelInterpreter(PyPSAInterpreter):
...     @property
...     def accepted_flags(self):
...         return {&#39;buses&#39;, &#39;generators&#39;, &#39;lines&#39;}
...
&gt;&gt;&gt; @PyPSADataset.register_interpreter  
... class PyPSATimeSeriesInterpreter(PyPSAInterpreter):
...     @property
...     def accepted_flags(self):
...         return {&#39;buses_t.marginal_price&#39;, &#39;generators_t.p&#39;}
...
&gt;&gt;&gt; # Register study-specific interpreter
&gt;&gt;&gt; @PyPSADataset.register_interpreter
... class CustomVariableInterpreter(PyPSAInterpreter):
...     @property
...     def accepted_flags(self):
...         return {&#39;custom_metric&#39;}
...
&gt;&gt;&gt; # Use platform dataset
&gt;&gt;&gt; dataset = PyPSADataset(network=my_network)
&gt;&gt;&gt; buses = dataset.fetch(&#39;buses&#39;)  # Routes to ModelInterpreter
&gt;&gt;&gt; prices = dataset.fetch(&#39;buses_t.marginal_price&#39;)  # Routes to TimeSeriesInterpreter
&gt;&gt;&gt; custom = dataset.fetch(&#39;custom_metric&#39;)  # Routes to CustomVariableInterpreter
</code></pre></div>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>Interpreters are registered at class level and shared across instances</li>
<li>Registration order affects routing (last registered = first checked)</li>
<li>All registered interpreters are instantiated for each platform dataset</li>
<li>Constructor arguments are automatically extracted and passed to interpreters</li>
</ul>
</details>







              <details class="quote">
                <summary>Source code in <code>submodules/mescal/mescal/datasets/platform_dataset.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">PlatformDataset</span><span class="p">(</span>
    <span class="n">Generic</span><span class="p">[</span><span class="n">DatasetType</span><span class="p">,</span> <span class="n">DatasetConfigType</span><span class="p">,</span> <span class="n">FlagType</span><span class="p">,</span> <span class="n">FlagIndexType</span><span class="p">],</span>
    <span class="n">DatasetLinkCollection</span><span class="p">[</span><span class="n">DatasetType</span><span class="p">,</span> <span class="n">DatasetConfigType</span><span class="p">,</span> <span class="n">FlagType</span><span class="p">,</span> <span class="n">FlagIndexType</span><span class="p">],</span>
    <span class="n">ABC</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for platform-specific datasets with automatic interpreter management.</span>

<span class="sd">    PlatformDataset provides the foundation for integrating MESCAL with specific</span>
<span class="sd">    energy modeling platforms (PyPSA, PLEXOS, etc.). It manages a registry of</span>
<span class="sd">    data interpreters and automatically instantiates them to handle different</span>
<span class="sd">    types of platform data.</span>

<span class="sd">    Key Features:</span>
<span class="sd">        - Automatic interpreter registration and instantiation</span>
<span class="sd">        - Type-safe interpreter management through generics</span>
<span class="sd">        - Flexible argument passing to interpreter constructors</span>
<span class="sd">        - Support for study-specific interpreter extensions</span>
<span class="sd">        - Unified data access through DatasetLinkCollection routing</span>

<span class="sd">    Architecture:</span>
<span class="sd">        - Uses DatasetLinkCollection for automatic flag routing</span>
<span class="sd">        - Manages interpreter registry at class level</span>
<span class="sd">        - Auto-instantiates all registered interpreters on construction</span>
<span class="sd">        - Supports inheritance and interpreter registration on subclasses</span>

<span class="sd">    Type Parameters:</span>
<span class="sd">        DatasetType: Base type for all interpreters (must be Dataset subclass)</span>
<span class="sd">        DatasetConfigType: Configuration class for dataset behavior</span>
<span class="sd">        FlagType: Type used for data flag identification</span>
<span class="sd">        FlagIndexType: Flag index implementation for flag mapping</span>

<span class="sd">    Class Attributes:</span>
<span class="sd">        _interpreter_registry: List of registered interpreter classes</span>

<span class="sd">    Usage Pattern:</span>
<span class="sd">        1. Create platform dataset class inheriting from PlatformDataset</span>
<span class="sd">        2. Define get_child_dataset_type() to specify interpreter base class</span>
<span class="sd">        3. Create interpreter classes inheriting from the base interpreter</span>
<span class="sd">        4. Register interpreters using @PlatformDataset.register_interpreter</span>
<span class="sd">        5. Instantiate platform dataset - interpreters are auto-created</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; # Define platform dataset</span>
<span class="sd">        &gt;&gt;&gt; class PyPSADataset(PlatformDataset[PyPSAInterpreter, ...]):</span>
<span class="sd">        ...     @classmethod</span>
<span class="sd">        ...     def get_child_dataset_type(cls):</span>
<span class="sd">        ...         return PyPSAInterpreter</span>
<span class="sd">        ...</span>
<span class="sd">        &gt;&gt;&gt; # Register core interpreters</span>
<span class="sd">        &gt;&gt;&gt; @PyPSADataset.register_interpreter</span>
<span class="sd">        ... class PyPSAModelInterpreter(PyPSAInterpreter):</span>
<span class="sd">        ...     @property</span>
<span class="sd">        ...     def accepted_flags(self):</span>
<span class="sd">        ...         return {&#39;buses&#39;, &#39;generators&#39;, &#39;lines&#39;}</span>
<span class="sd">        ...</span>
<span class="sd">        &gt;&gt;&gt; @PyPSADataset.register_interpreter  </span>
<span class="sd">        ... class PyPSATimeSeriesInterpreter(PyPSAInterpreter):</span>
<span class="sd">        ...     @property</span>
<span class="sd">        ...     def accepted_flags(self):</span>
<span class="sd">        ...         return {&#39;buses_t.marginal_price&#39;, &#39;generators_t.p&#39;}</span>
<span class="sd">        ...</span>
<span class="sd">        &gt;&gt;&gt; # Register study-specific interpreter</span>
<span class="sd">        &gt;&gt;&gt; @PyPSADataset.register_interpreter</span>
<span class="sd">        ... class CustomVariableInterpreter(PyPSAInterpreter):</span>
<span class="sd">        ...     @property</span>
<span class="sd">        ...     def accepted_flags(self):</span>
<span class="sd">        ...         return {&#39;custom_metric&#39;}</span>
<span class="sd">        ...</span>
<span class="sd">        &gt;&gt;&gt; # Use platform dataset</span>
<span class="sd">        &gt;&gt;&gt; dataset = PyPSADataset(network=my_network)</span>
<span class="sd">        &gt;&gt;&gt; buses = dataset.fetch(&#39;buses&#39;)  # Routes to ModelInterpreter</span>
<span class="sd">        &gt;&gt;&gt; prices = dataset.fetch(&#39;buses_t.marginal_price&#39;)  # Routes to TimeSeriesInterpreter</span>
<span class="sd">        &gt;&gt;&gt; custom = dataset.fetch(&#39;custom_metric&#39;)  # Routes to CustomVariableInterpreter</span>

<span class="sd">    Notes:</span>
<span class="sd">        - Interpreters are registered at class level and shared across instances</span>
<span class="sd">        - Registration order affects routing (last registered = first checked)</span>
<span class="sd">        - All registered interpreters are instantiated for each platform dataset</span>
<span class="sd">        - Constructor arguments are automatically extracted and passed to interpreters</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_interpreter_registry</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">DatasetType</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">flag_index</span><span class="p">:</span> <span class="n">FlagIndexType</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">attributes</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">database</span><span class="p">:</span> <span class="n">Database</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">config</span><span class="p">:</span> <span class="n">DatasetConfigType</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">datasets</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">flag_index</span><span class="o">=</span><span class="n">flag_index</span><span class="p">,</span>
            <span class="n">attributes</span><span class="o">=</span><span class="n">attributes</span><span class="p">,</span>
            <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">,</span>
            <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">interpreter_args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_interpreter_initialization_args</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">datasets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_registered_interpreters</span><span class="p">(</span><span class="n">interpreter_args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_datasets</span><span class="p">(</span><span class="n">datasets</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">register_interpreter</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">interpreter</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">DatasetType</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Type</span><span class="p">[</span><span class="s1">&#39;DatasetType&#39;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Register a data interpreter class with this platform dataset.</span>

<span class="sd">        This method is typically used as a decorator to register interpreter classes</span>
<span class="sd">        that handle specific types of platform data. Registered interpreters are</span>
<span class="sd">        automatically instantiated when the platform dataset is created.</span>

<span class="sd">        Args:</span>
<span class="sd">            interpreter: Interpreter class that must inherit from get_child_dataset_type()</span>

<span class="sd">        Returns:</span>
<span class="sd">            The interpreter class (unchanged) to support decorator usage</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: If interpreter doesn&#39;t inherit from the required base class</span>

<span class="sd">        Example:</span>

<span class="sd">            &gt;&gt;&gt; @PyPSADataset.register_interpreter</span>
<span class="sd">            ... class CustomInterpreter(PyPSAInterpreter):</span>
<span class="sd">            ...     @property</span>
<span class="sd">            ...     def accepted_flags(self):</span>
<span class="sd">            ...         return {&#39;custom_flag&#39;}</span>
<span class="sd">            ...     </span>
<span class="sd">            ...     def _fetch(self, flag, config, **kwargs):</span>
<span class="sd">            ...         return compute_custom_data()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_validate_interpreter_type</span><span class="p">(</span><span class="n">interpreter</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">interpreter</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_interpreter_registry</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_add_interpreter_to_registry</span><span class="p">(</span><span class="n">interpreter</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">interpreter</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_registered_interpreters</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">DatasetType</span><span class="p">]]:</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_interpreter_registry</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_interpreter_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interpreter_type</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">DatasetType</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">DatasetType</span><span class="p">:</span>
        <span class="n">interpreter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_interpreter_instance</span><span class="p">(</span><span class="n">interpreter_type</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">interpreter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;No interpreter instance found for type </span><span class="si">{</span><span class="n">interpreter_type</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">interpreter</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_flags_by_interpreter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">DatasetType</span><span class="p">],</span> <span class="nb">set</span><span class="p">[</span><span class="n">FlagType</span><span class="p">]]:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="nb">type</span><span class="p">(</span><span class="n">interpreter</span><span class="p">):</span> <span class="n">interpreter</span><span class="o">.</span><span class="n">accepted_flags</span>
            <span class="k">for</span> <span class="n">interpreter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_prepare_interpreter_initialization_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="n">interpreter_signature</span> <span class="o">=</span> <span class="n">InterpreterSignature</span><span class="o">.</span><span class="n">from_interpreter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_child_dataset_type</span><span class="p">())</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="n">arg</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">arg</span><span class="p">,</span> <span class="n">default</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">interpreter_signature</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="n">interpreter_signature</span><span class="o">.</span><span class="n">defaults</span><span class="p">)</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_initialize_registered_interpreters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interpreter_args</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">DatasetType</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">interpreter</span><span class="p">(</span><span class="o">**</span><span class="n">interpreter_args</span><span class="p">,</span> <span class="n">parent_dataset</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">interpreter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interpreter_registry</span>
        <span class="p">]</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_interpreter_type</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">interpreter</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">DatasetType</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">interpreter</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_child_dataset_type</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Interpreter must be subclass of </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">get_child_dataset_type</span><span class="p">()</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_interpreter_not_registered</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">interpreter</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">DatasetType</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">interpreter</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_interpreter_registry</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Interpreter </span><span class="si">{</span><span class="n">interpreter</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> already registered&#39;</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_add_interpreter_to_registry</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">interpreter</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">DatasetType</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_interpreter_registry</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">interpreter</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_find_interpreter_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interpreter_type</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">DatasetType</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">DatasetType</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">interpreter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">interpreter</span><span class="p">,</span> <span class="n">interpreter_type</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">interpreter</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="mescal.datasets.platform_dataset.PlatformDataset.register_interpreter" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">register_interpreter</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#mescal.datasets.platform_dataset.PlatformDataset.register_interpreter" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">register_interpreter</span><span class="p">(</span><span class="n">interpreter</span><span class="p">:</span> <span class="n"><span title="typing.Type">Type</span></span><span class="p">[</span><span class="n"><span title="mescal.typevars.DatasetType">DatasetType</span></span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n"><span title="typing.Type">Type</span></span><span class="p">[</span><span class="s1">&#39;DatasetType&#39;</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Register a data interpreter class with this platform dataset.</p>
<p>This method is typically used as a decorator to register interpreter classes
that handle specific types of platform data. Registered interpreters are
automatically instantiated when the platform dataset is created.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>interpreter</code>
            </td>
            <td>
                  <code><span title="typing.Type">Type</span>[<span title="mescal.typevars.DatasetType">DatasetType</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Interpreter class that must inherit from get_child_dataset_type()</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Type">Type</span>[&#39;DatasetType&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The interpreter class (unchanged) to support decorator usage</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="TypeError">TypeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If interpreter doesn't inherit from the required base class</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Example:</p>
<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; @PyPSADataset.register_interpreter
... class CustomInterpreter(PyPSAInterpreter):
...     @property
...     def accepted_flags(self):
...         return {&#39;custom_flag&#39;}
...     
...     def _fetch(self, flag, config, **kwargs):
...         return compute_custom_data()
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>submodules/mescal/mescal/datasets/platform_dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">register_interpreter</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">interpreter</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">DatasetType</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Type</span><span class="p">[</span><span class="s1">&#39;DatasetType&#39;</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Register a data interpreter class with this platform dataset.</span>

<span class="sd">    This method is typically used as a decorator to register interpreter classes</span>
<span class="sd">    that handle specific types of platform data. Registered interpreters are</span>
<span class="sd">    automatically instantiated when the platform dataset is created.</span>

<span class="sd">    Args:</span>
<span class="sd">        interpreter: Interpreter class that must inherit from get_child_dataset_type()</span>

<span class="sd">    Returns:</span>
<span class="sd">        The interpreter class (unchanged) to support decorator usage</span>

<span class="sd">    Raises:</span>
<span class="sd">        TypeError: If interpreter doesn&#39;t inherit from the required base class</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; @PyPSADataset.register_interpreter</span>
<span class="sd">        ... class CustomInterpreter(PyPSAInterpreter):</span>
<span class="sd">        ...     @property</span>
<span class="sd">        ...     def accepted_flags(self):</span>
<span class="sd">        ...         return {&#39;custom_flag&#39;}</span>
<span class="sd">        ...     </span>
<span class="sd">        ...     def _fetch(self, flag, config, **kwargs):</span>
<span class="sd">        ...         return compute_custom_data()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">cls</span><span class="o">.</span><span class="n">_validate_interpreter_type</span><span class="p">(</span><span class="n">interpreter</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">interpreter</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_interpreter_registry</span><span class="p">:</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_add_interpreter_to_registry</span><span class="p">(</span><span class="n">interpreter</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">interpreter</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="mescal.datasets.dataset_config" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">dataset_config</span>


<a href="#mescal.datasets.dataset_config" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">










  <div class="doc doc-children">












  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "content.tabs.link", "navigation.sections"], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>