
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://docs.mesqual.io/mescal-package-documentation/api_reference/visualization/folium_viz_system/kpi_collection/">
      
      
        <link rel="prev" href="../data_item/">
      
      
        <link rel="next" href="../../folium_legend_system/">
      
      
      <link rel="icon" href="../../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.19">
    
    
      
        <title>KPI Collection Visualizer - MESCAL Suite Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="amber">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#mescal-folium-kpicollection-visualization-system" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../.." title="MESCAL Suite Documentation" class="md-header__button md-logo" aria-label="MESCAL Suite Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            MESCAL Suite Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              KPI Collection Visualizer
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/helgeesch/mescal-vanilla-studies/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../../study_manager/" class="md-tabs__link">
          
  
  
  MESCAL API Reference

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../../mescal-study-01/notebooks/mescal_101_study_manager_and_basic_fetching/" class="md-tabs__link">
          
  
  
  Studies & Examples

        </a>
      </li>
    
  

    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="MESCAL Suite Documentation" class="md-nav__button md-logo" aria-label="MESCAL Suite Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    MESCAL Suite Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/helgeesch/mescal-vanilla-studies/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    MESCAL API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            MESCAL API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Core
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Core
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../study_manager/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    StudyManager
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../datasets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Datasets
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_3" >
        
          
          <label class="md-nav__link" for="__nav_2_1_3" id="__nav_2_1_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Flag System
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_3">
            <span class="md-nav__icon md-icon"></span>
            Flag System
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../flag/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Flag
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../flag_index/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FlagIndex
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../units/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Units
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../validation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Visualization Modules
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_2" id="__nav_2_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Visualization Modules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../time_series_dashboard/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    TimeSeriesDashboard
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_2" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Folium Viz System
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_2_2" id="__nav_2_2_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_2_2">
            <span class="md-nav__icon md-icon"></span>
            Folium Viz System
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../areas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Areas
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../circle_marker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Circle Marker
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../text_overlay/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Text Overlay
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lines/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lines
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../line_text_overlay/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Line Text Overlay
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../arrow_icon/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Arrow Icon
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_2_7" >
        
          
          <label class="md-nav__link" for="__nav_2_2_2_7" id="__nav_2_2_2_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Base
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_2_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_2_7">
            <span class="md-nav__icon md-icon"></span>
            Base
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Abstract System
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../data_item/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Data Item
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    KPI Collection Visualizer
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    KPI Collection Visualizer
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#mescal.visualizations.folium_viz_system.kpi_collection_map_visualizer.KPICollectionMapVisualizer" class="md-nav__link">
    <span class="md-ellipsis">
      KPICollectionMapVisualizer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="KPICollectionMapVisualizer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mescal.visualizations.folium_viz_system.kpi_collection_map_visualizer.KPICollectionMapVisualizer.get_feature_groups" class="md-nav__link">
    <span class="md-ellipsis">
      get_feature_groups
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mescal.visualizations.folium_viz_system.kpi_collection_map_visualizer.KPIGroupingManager" class="md-nav__link">
    <span class="md-ellipsis">
      KPIGroupingManager
    </span>
  </a>
  
    <nav class="md-nav" aria-label="KPIGroupingManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mescal.visualizations.folium_viz_system.kpi_collection_map_visualizer.KPIGroupingManager.get_kpi_groups" class="md-nav__link">
    <span class="md-ellipsis">
      get_kpi_groups
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mescal.visualizations.folium_viz_system.kpi_collection_map_visualizer.KPIGroupingManager.get_feature_group_name" class="md-nav__link">
    <span class="md-ellipsis">
      get_feature_group_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mescal.visualizations.folium_viz_system.kpi_collection_map_visualizer.KPIGroupingManager.get_related_kpi_groups" class="md-nav__link">
    <span class="md-ellipsis">
      get_related_kpi_groups
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../folium_legend_system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Folium Legend System
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../html_table/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    HTML Table
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../html_dashboard/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    HTML Dashboard
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../energy_data_handling/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Energy Data Handling
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_3" id="__nav_2_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Energy Data Handling
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../energy_data_handling/area_accounting/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Area Accounting
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_3_1" id="__nav_2_3_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_1">
            <span class="md-nav__icon md-icon"></span>
            Area Accounting
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../energy_data_handling/area_accounting/model_gen/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Area / Border Model Generators
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../energy_data_handling/area_accounting/area_variables/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Area Variables
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../energy_data_handling/area_accounting/border_variables/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Border Variables
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../energy_data_handling/model_handling/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Model Membership Handling
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_3_2" id="__nav_2_3_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_2">
            <span class="md-nav__icon md-icon"></span>
            Model Membership Handling
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../energy_data_handling/model_handling/property_enricher/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Property Enricher
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../energy_data_handling/model_handling/pairs_appender/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pairs Appender
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../energy_data_handling/variable_utils/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Variable Utils
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_3_3" id="__nav_2_3_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_3">
            <span class="md-nav__icon md-icon"></span>
            Variable Utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../energy_data_handling/variable_utils/in_common_aggs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    In-common Aggregations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../energy_data_handling/variable_utils/direction_aggs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Up-/Down Directional Aggregations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../energy_data_handling/variable_utils/congestion_rent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Congestion Rent
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../energy_data_handling/variable_utils/regional_trade_balance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Regional Trade Balance
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../energy_data_handling/granularity_modules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Granularity Modules
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../energy_data_handling/network_lines_data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Network Lines Data
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../energy_data_handling/time_series_gap_handling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Time Series Gap Handling
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Utils
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../utils/pandas_utils/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    pandas_utils
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_4_1" id="__nav_2_4_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4_1">
            <span class="md-nav__icon md-icon"></span>
            pandas_utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../utils/pandas_utils/flatten_df/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Flatten DF
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../utils/pandas_utils/pend_props/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pend Properties
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../utils/pandas_utils/filter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Filter by Model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../utils/pandas_utils/xs_df/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    xs DF
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../utils/pandas_utils/sort_multiindex/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sort MultiIndex
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../utils/pandas_utils/merge_multi_index_levels/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Merge MultiIndex Levels
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../utils/pandas_utils/set_new_column/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Set New Column in MultiIndex
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../utils/pandas_utils/combine_dfs.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Combine DFs
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../utils/plotly_utils/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    plotly_utils
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_4_2" id="__nav_2_4_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4_2">
            <span class="md-nav__icon md-icon"></span>
            plotly_utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../utils/plotly_utils/plotly_theme/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PlotlyTheme
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../utils/plotly_utils/figure_utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    figure_utils
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../utils/plotly_utils/px_category_utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    px_category_utils
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Studies & Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Studies & Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Intro to MESCAL
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            Intro to MESCAL
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../mescal-study-01/notebooks/mescal_101_study_manager_and_basic_fetching/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MESCAL 101: StudyManager and Dataset Fundamentals
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../mescal-study-01/notebooks/mescal_102_mastering_data_fetching/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MESCAL 102: Advanced Data Fetching Techniques
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../mescal-study-01/notebooks/mescal_103_scenario_attributes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MESCAL 103: Scenario Attributes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../mescal-study-01/notebooks/mescal_301_time_series_dashboard/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MESCAL 301: Time Series Dashboard
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../mescal-study-01/notebooks/mescal_302_segmented_colormap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MESCAL 302: Segmented Colormap
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../mescal-study-01/notebooks/mescal_303_folium_model_df_map/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MESCAL 401: Folium Model Data Visualization - Areas, Points, and Lines
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../mescal-study-01/notebooks/mescal_304_folium_area_kpi_map/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MESCAL 402: Folium KPI Visualization System
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../mescal-study-01/notebooks/mescal_304_simple_area_kpi_map/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MESCAL 303: Interactive Geospatial with Folium
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../mescal-study-01/notebooks/mescal_307_country_plotter_util/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MESCAL 307: Country Plotter Utility Module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../mescal-study-01/notebooks/mescal_308_html_dashboards/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MESCAL 305: HTML Dashboard Utility
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#mescal.visualizations.folium_viz_system.kpi_collection_map_visualizer.KPICollectionMapVisualizer" class="md-nav__link">
    <span class="md-ellipsis">
      KPICollectionMapVisualizer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="KPICollectionMapVisualizer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mescal.visualizations.folium_viz_system.kpi_collection_map_visualizer.KPICollectionMapVisualizer.get_feature_groups" class="md-nav__link">
    <span class="md-ellipsis">
      get_feature_groups
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mescal.visualizations.folium_viz_system.kpi_collection_map_visualizer.KPIGroupingManager" class="md-nav__link">
    <span class="md-ellipsis">
      KPIGroupingManager
    </span>
  </a>
  
    <nav class="md-nav" aria-label="KPIGroupingManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mescal.visualizations.folium_viz_system.kpi_collection_map_visualizer.KPIGroupingManager.get_kpi_groups" class="md-nav__link">
    <span class="md-ellipsis">
      get_kpi_groups
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mescal.visualizations.folium_viz_system.kpi_collection_map_visualizer.KPIGroupingManager.get_feature_group_name" class="md-nav__link">
    <span class="md-ellipsis">
      get_feature_group_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mescal.visualizations.folium_viz_system.kpi_collection_map_visualizer.KPIGroupingManager.get_related_kpi_groups" class="md-nav__link">
    <span class="md-ellipsis">
      get_related_kpi_groups
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="mescal-folium-kpicollection-visualization-system">MESCAL Folium KPICollection Visualization System<a class="headerlink" href="#mescal-folium-kpicollection-visualization-system" title="Permanent link">&para;</a></h1>


<div class="doc doc-object doc-class">



<h2 id="mescal.visualizations.folium_viz_system.kpi_collection_map_visualizer.KPICollectionMapVisualizer" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">KPICollectionMapVisualizer</span>


<a href="#mescal.visualizations.folium_viz_system.kpi_collection_map_visualizer.KPICollectionMapVisualizer" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">


        <p>High-level KPI collection map visualizer for energy system analysis.</p>
<p>Main orchestrator for converting KPI collections into organized folium map
visualizations. Handles KPI grouping, feature group creation, tooltip
enhancement, and progress tracking. Designed to replicate and extend
the functionality of the original KPIToMapVisualizerBase.</p>
<p>Supports multiple generators for complex visualizations (e.g., areas with
text overlays, lines with arrow indicators) and provides sophisticated
KPI organization and related KPI discovery for enhanced user experience.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>generators</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="            FoliumObjectGenerator (mescal.visualizations.folium_viz_system.base_viz_system.FoliumObjectGenerator)" href="../system/#mescal.visualizations.folium_viz_system.base_viz_system.FoliumObjectGenerator">FoliumObjectGenerator</a> | <span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="            FoliumObjectGenerator (mescal.visualizations.folium_viz_system.base_viz_system.FoliumObjectGenerator)" href="../system/#mescal.visualizations.folium_viz_system.base_viz_system.FoliumObjectGenerator">FoliumObjectGenerator</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Single generator or list of generators for visualization</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>study_manager</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="            StudyManager (mescal.study_manager.StudyManager)" href="../../../study_manager/#mescal.study_manager.StudyManager">StudyManager</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>StudyManager for enhanced KPI relationships and tooltips</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>include_related_kpis_in_tooltip</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Add related KPIs to tooltip display</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kpi_grouping_manager</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="            KPIGroupingManager (mescal.visualizations.folium_viz_system.kpi_collection_map_visualizer.KPIGroupingManager)" href="#mescal.visualizations.folium_viz_system.kpi_collection_map_visualizer.KPIGroupingManager">KPIGroupingManager</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Custom grouping manager (optional)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional arguments passed to data items</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <p>Basic area visualization:</p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">visualizer</span> <span class="o">=</span> <span class="n">KPICollectionMapVisualizer</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">generators</span><span class="o">=</span><span class="p">[</span>
<span class="gp">... </span>        <span class="n">AreaGenerator</span><span class="p">(</span>
<span class="gp">... </span>            <span class="n">AreaFeatureResolver</span><span class="p">(</span>
<span class="gp">... </span>                <span class="n">fill_color</span><span class="o">=</span><span class="n">PropertyMapper</span><span class="o">.</span><span class="n">from_kpi_value</span><span class="p">(</span><span class="n">color_scale</span><span class="p">),</span>
<span class="gp">... </span>                <span class="n">tooltip</span><span class="o">=</span><span class="kc">True</span>
<span class="gp">... </span>            <span class="p">)</span>
<span class="gp">... </span>        <span class="p">)</span>
<span class="gp">... </span>    <span class="p">],</span>
<span class="gp">... </span>    <span class="n">study_manager</span><span class="o">=</span><span class="n">study</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">feature_groups</span> <span class="o">=</span> <span class="n">visualizer</span><span class="o">.</span><span class="n">get_feature_groups</span><span class="p">(</span><span class="n">price_kpis</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">fg</span> <span class="ow">in</span> <span class="n">feature_groups</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">fg</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="nb">map</span><span class="p">)</span>
</code></pre></div>
    <p>Complex multi-layer visualization:</p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">visualizer</span> <span class="o">=</span> <span class="n">KPICollectionMapVisualizer</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">generators</span><span class="o">=</span><span class="p">[</span>
<span class="gp">... </span>        <span class="n">AreaGenerator</span><span class="p">(</span><span class="n">AreaFeatureResolver</span><span class="p">(</span><span class="o">...</span><span class="p">)),</span>
<span class="gp">... </span>        <span class="n">TextOverlayGenerator</span><span class="p">(</span><span class="n">TextOverlayFeatureResolver</span><span class="p">(</span><span class="o">...</span><span class="p">))</span>
<span class="gp">... </span>    <span class="p">],</span>
<span class="gp">... </span>    <span class="n">include_related_kpis_in_tooltip</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">study_manager</span><span class="o">=</span><span class="n">study</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">visualizer</span><span class="o">.</span><span class="n">generate_and_add_feature_groups_to_map</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">kpi_collection</span><span class="p">,</span> <span class="n">folium_map</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="s1">&#39;first&#39;</span>
<span class="gp">... </span><span class="p">)</span>
</code></pre></div>
    <p>Flow visualization with arrows:</p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">visualizer</span> <span class="o">=</span> <span class="n">KPICollectionMapVisualizer</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">generators</span><span class="o">=</span><span class="p">[</span>
<span class="gp">... </span>        <span class="n">ArrowIconGenerator</span><span class="p">(</span><span class="n">ArrowIconFeatureResolver</span><span class="p">(</span><span class="o">...</span><span class="p">)),</span>
<span class="gp">... </span>        <span class="n">TextOverlayGenerator</span><span class="p">(</span><span class="n">TextOverlayFeatureResolver</span><span class="p">(</span><span class="o">...</span><span class="p">))</span>
<span class="gp">... </span>    <span class="p">]</span>
<span class="gp">... </span><span class="p">)</span>
</code></pre></div>








              <details class="quote">
                <summary>Source code in <code>submodules/mescal/mescal/visualizations/folium_viz_system/kpi_collection_map_visualizer.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">KPICollectionMapVisualizer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    High-level KPI collection map visualizer for energy system analysis.</span>

<span class="sd">    Main orchestrator for converting KPI collections into organized folium map</span>
<span class="sd">    visualizations. Handles KPI grouping, feature group creation, tooltip</span>
<span class="sd">    enhancement, and progress tracking. Designed to replicate and extend</span>
<span class="sd">    the functionality of the original KPIToMapVisualizerBase.</span>

<span class="sd">    Supports multiple generators for complex visualizations (e.g., areas with</span>
<span class="sd">    text overlays, lines with arrow indicators) and provides sophisticated</span>
<span class="sd">    KPI organization and related KPI discovery for enhanced user experience.</span>

<span class="sd">    Args:</span>
<span class="sd">        generators: Single generator or list of generators for visualization</span>
<span class="sd">        study_manager: StudyManager for enhanced KPI relationships and tooltips</span>
<span class="sd">        include_related_kpis_in_tooltip: Add related KPIs to tooltip display</span>
<span class="sd">        kpi_grouping_manager: Custom grouping manager (optional)</span>
<span class="sd">        **kwargs: Additional arguments passed to data items</span>

<span class="sd">    Examples:</span>
<span class="sd">        Basic area visualization:</span>
<span class="sd">        &gt;&gt;&gt; visualizer = KPICollectionMapVisualizer(</span>
<span class="sd">        ...     generators=[</span>
<span class="sd">        ...         AreaGenerator(</span>
<span class="sd">        ...             AreaFeatureResolver(</span>
<span class="sd">        ...                 fill_color=PropertyMapper.from_kpi_value(color_scale),</span>
<span class="sd">        ...                 tooltip=True</span>
<span class="sd">        ...             )</span>
<span class="sd">        ...         )</span>
<span class="sd">        ...     ],</span>
<span class="sd">        ...     study_manager=study</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; feature_groups = visualizer.get_feature_groups(price_kpis)</span>
<span class="sd">        &gt;&gt;&gt; for fg in feature_groups:</span>
<span class="sd">        ...     fg.add_to(map)</span>

<span class="sd">        Complex multi-layer visualization:</span>
<span class="sd">        &gt;&gt;&gt; visualizer = KPICollectionMapVisualizer(</span>
<span class="sd">        ...     generators=[</span>
<span class="sd">        ...         AreaGenerator(AreaFeatureResolver(...)),</span>
<span class="sd">        ...         TextOverlayGenerator(TextOverlayFeatureResolver(...))</span>
<span class="sd">        ...     ],</span>
<span class="sd">        ...     include_related_kpis_in_tooltip=True,</span>
<span class="sd">        ...     study_manager=study</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; visualizer.generate_and_add_feature_groups_to_map(</span>
<span class="sd">        ...     kpi_collection, folium_map, show=&#39;first&#39;</span>
<span class="sd">        ... )</span>

<span class="sd">        Flow visualization with arrows:</span>
<span class="sd">        &gt;&gt;&gt; visualizer = KPICollectionMapVisualizer(</span>
<span class="sd">        ...     generators=[</span>
<span class="sd">        ...         ArrowIconGenerator(ArrowIconFeatureResolver(...)),</span>
<span class="sd">        ...         TextOverlayGenerator(TextOverlayFeatureResolver(...))</span>
<span class="sd">        ...     ]</span>
<span class="sd">        ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">generators</span><span class="p">:</span> <span class="n">FoliumObjectGenerator</span> <span class="o">|</span> <span class="n">List</span><span class="p">[</span><span class="n">FoliumObjectGenerator</span><span class="p">],</span>
            <span class="n">study_manager</span><span class="p">:</span> <span class="s1">&#39;StudyManager&#39;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">include_related_kpis_in_tooltip</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">kpi_grouping_manager</span><span class="p">:</span> <span class="n">KPIGroupingManager</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generators</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">FoliumObjectGenerator</span><span class="p">]</span> <span class="o">=</span> <span class="n">generators</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">generators</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">generators</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">study_manager</span> <span class="o">=</span> <span class="n">study_manager</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">include_related_kpis_in_tooltip</span> <span class="o">=</span> <span class="n">include_related_kpis_in_tooltip</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">grouping_manager</span> <span class="o">=</span> <span class="n">kpi_grouping_manager</span> <span class="ow">or</span> <span class="n">KPIGroupingManager</span><span class="p">()</span>

        <span class="c1"># Enhanced tooltip if needed</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_related_kpis_in_tooltip</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">generators</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">tooltip_generator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_enhanced_tooltip_generator</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_and_add_feature_groups_to_map</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">kpi_collection</span><span class="p">:</span> <span class="n">KPICollection</span><span class="p">,</span>
            <span class="n">folium_map</span><span class="p">:</span> <span class="n">folium</span><span class="o">.</span><span class="n">Map</span><span class="p">,</span>
            <span class="n">show</span><span class="p">:</span> <span class="n">SHOW_OPTIONS</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span>
            <span class="n">overlay</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">folium</span><span class="o">.</span><span class="n">FeatureGroup</span><span class="p">]:</span>
        <span class="n">fgs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_feature_groups</span><span class="p">(</span><span class="n">kpi_collection</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">,</span> <span class="n">overlay</span><span class="o">=</span><span class="n">overlay</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">fg</span> <span class="ow">in</span> <span class="n">fgs</span><span class="p">:</span>
            <span class="n">folium_map</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">fg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fgs</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_feature_groups</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">kpi_collection</span><span class="p">:</span> <span class="n">KPICollection</span><span class="p">,</span>
            <span class="n">show</span><span class="p">:</span> <span class="n">SHOW_OPTIONS</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span>
            <span class="n">overlay</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">folium</span><span class="o">.</span><span class="n">FeatureGroup</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create feature groups for KPI collection with organized grouping.</span>

<span class="sd">        Main method that processes KPI collection through grouping, creates</span>
<span class="sd">        folium FeatureGroups, and applies all configured generators to create</span>
<span class="sd">        a complete map visualization.</span>

<span class="sd">        Args:</span>
<span class="sd">            kpi_collection: Collection of KPIs to visualize</span>
<span class="sd">            show: Which feature groups to show initially (&#39;first&#39;, &#39;last&#39;, &#39;none&#39;)</span>
<span class="sd">            overlay: Whether feature groups should be overlay controls</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of folium FeatureGroup objects ready to add to map</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create feature groups for KPI collection, replicating original functionality.&quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">tqdm</span><span class="w"> </span><span class="kn">import</span> <span class="n">tqdm</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">mescal.utils.logging</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_logger</span>

        <span class="n">logger</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="n">feature_groups</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">pbar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">kpi_collection</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="n">kpi_collection</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">pbar</span><span class="p">:</span>
            <span class="n">kpi_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grouping_manager</span><span class="o">.</span><span class="n">get_kpi_groups</span><span class="p">(</span><span class="n">kpi_collection</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">kpi_group</span> <span class="ow">in</span> <span class="n">kpi_groups</span><span class="p">:</span>
                <span class="n">group_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grouping_manager</span><span class="o">.</span><span class="n">get_feature_group_name</span><span class="p">(</span><span class="n">kpi_group</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">show</span> <span class="o">==</span> <span class="s1">&#39;first&#39;</span><span class="p">:</span>
                    <span class="n">show_fg</span> <span class="o">=</span> <span class="n">kpi_group</span> <span class="o">==</span> <span class="n">kpi_groups</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">show</span> <span class="o">==</span> <span class="s1">&#39;last&#39;</span><span class="p">:</span>
                    <span class="n">show_fg</span> <span class="o">=</span> <span class="n">kpi_group</span> <span class="o">==</span> <span class="n">kpi_groups</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">show_fg</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="n">fg</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">FeatureGroup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">group_name</span><span class="p">,</span> <span class="n">overlay</span><span class="o">=</span><span class="n">overlay</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">show_fg</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">kpi</span> <span class="ow">in</span> <span class="n">kpi_group</span><span class="p">:</span>
                    <span class="n">data_item</span> <span class="o">=</span> <span class="n">KPIDataItem</span><span class="p">(</span><span class="n">kpi</span><span class="p">,</span> <span class="n">kpi_collection</span><span class="p">,</span> <span class="n">study_manager</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">study_manager</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">generator</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">generators</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_related_kpis_in_tooltip</span><span class="p">:</span>
                            <span class="n">_tmp</span> <span class="o">=</span> <span class="n">generator</span><span class="o">.</span><span class="n">feature_resolver</span><span class="o">.</span><span class="n">property_mappers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tooltip&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                            <span class="n">generator</span><span class="o">.</span><span class="n">feature_resolver</span><span class="o">.</span><span class="n">property_mappers</span><span class="p">[</span><span class="s1">&#39;tooltip&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_enhanced_tooltip_generator</span><span class="p">()</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">generator</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">data_item</span><span class="p">,</span> <span class="n">fg</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                                <span class="sa">f</span><span class="s1">&#39;Exception while trying to add KPI </span><span class="si">{</span><span class="n">kpi</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> to FeatureGroup </span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span>
                            <span class="p">)</span>
                        <span class="k">finally</span><span class="p">:</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_related_kpis_in_tooltip</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">_tmp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                    <span class="n">generator</span><span class="o">.</span><span class="n">feature_resolver</span><span class="o">.</span><span class="n">property_mappers</span><span class="p">[</span><span class="s1">&#39;tooltip&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_tmp</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">generator</span><span class="o">.</span><span class="n">feature_resolver</span><span class="o">.</span><span class="n">property_mappers</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;tooltip&#39;</span><span class="p">)</span>
                    <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

                <span class="n">feature_groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fg</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">feature_groups</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_create_enhanced_tooltip_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PropertyMapper</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create tooltip generator that includes related KPIs.&quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">generate_tooltip</span><span class="p">(</span><span class="n">data_item</span><span class="p">:</span> <span class="n">KPIDataItem</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>

            <span class="n">kpi</span> <span class="o">=</span> <span class="n">data_item</span><span class="o">.</span><span class="n">kpi</span>
            <span class="n">kpi_name</span> <span class="o">=</span> <span class="n">kpi</span><span class="o">.</span><span class="n">get_kpi_name_with_dataset_name</span><span class="p">()</span>

            <span class="kn">from</span><span class="w"> </span><span class="nn">mescal.units</span><span class="w"> </span><span class="kn">import</span> <span class="n">Units</span>
            <span class="n">kpi_quantity</span> <span class="o">=</span> <span class="n">Units</span><span class="o">.</span><span class="n">get_quantity_in_pretty_unit</span><span class="p">(</span><span class="n">kpi</span><span class="o">.</span><span class="n">quantity</span><span class="p">)</span>
            <span class="n">kpi_text</span> <span class="o">=</span> <span class="n">Units</span><span class="o">.</span><span class="n">get_pretty_text_for_quantity</span><span class="p">(</span><span class="n">kpi_quantity</span><span class="p">,</span> <span class="n">thousands_separator</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

            <span class="n">html</span> <span class="o">=</span> <span class="s1">&#39;&lt;table style=&quot;border-collapse: collapse;&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">html</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;  &lt;tr&gt;&lt;td style=&quot;padding: 4px 8px;&quot;&gt;&lt;strong&gt;</span><span class="si">{</span><span class="n">kpi_name</span><span class="si">}</span><span class="s1">&lt;/strong&gt;&lt;/td&gt;&#39;</span> \
                    <span class="sa">f</span><span class="s1">&#39;&lt;td style=&quot;text-align: right; padding: 4px 8px;&quot;&gt;</span><span class="si">{</span><span class="n">kpi_text</span><span class="si">}</span><span class="s1">&lt;/td&gt;&lt;/tr&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_related_kpis_in_tooltip</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">study_manager</span><span class="p">:</span>
                <span class="n">related_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grouping_manager</span><span class="o">.</span><span class="n">get_related_kpi_groups</span><span class="p">(</span>
                    <span class="n">kpi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">study_manager</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">empty</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">related_groups</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">related_groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">group</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                            <span class="k">continue</span>
                        <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;tr&gt;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&lt;/tr&gt;&quot;</span>
                        <span class="n">html</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;  &lt;tr&gt;&lt;th colspan=&quot;2&quot; style=&quot;text-align: left; padding: 8px;&quot;&gt;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&lt;/th&gt;&lt;/tr&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
                        <span class="k">for</span> <span class="n">related_kpi</span> <span class="ow">in</span> <span class="n">group</span><span class="p">:</span>
                            <span class="n">related_kpi_name</span> <span class="o">=</span> <span class="n">related_kpi</span><span class="o">.</span><span class="n">get_kpi_name_with_dataset_name</span><span class="p">()</span>
                            <span class="n">related_kpi_quantity</span> <span class="o">=</span> <span class="n">Units</span><span class="o">.</span><span class="n">get_quantity_in_pretty_unit</span><span class="p">(</span><span class="n">related_kpi</span><span class="o">.</span><span class="n">quantity</span><span class="p">)</span>
                            <span class="n">related_kpi_value_text</span> <span class="o">=</span> <span class="n">Units</span><span class="o">.</span><span class="n">get_pretty_text_for_quantity</span><span class="p">(</span>
                                <span class="n">related_kpi_quantity</span><span class="p">,</span>
                                <span class="n">thousands_separator</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="n">html</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;  &lt;tr&gt;&lt;td style=&quot;padding: 4px 8px;&quot;&gt;</span><span class="si">{</span><span class="n">related_kpi_name</span><span class="si">}</span><span class="s1">&lt;/td&gt;&#39;</span> \
                                    <span class="sa">f</span><span class="s1">&#39;&lt;td style=&quot;text-align: right; padding: 4px 8px;&quot;&gt;</span><span class="si">{</span><span class="n">related_kpi_value_text</span><span class="si">}</span><span class="s1">&lt;/td&gt;&lt;/tr&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>

            <span class="n">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;br&gt;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&lt;/table&gt;&#39;</span>
            <span class="k">return</span> <span class="n">html</span>

        <span class="k">return</span> <span class="n">PropertyMapper</span><span class="p">(</span><span class="n">generate_tooltip</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="mescal.visualizations.folium_viz_system.kpi_collection_map_visualizer.KPICollectionMapVisualizer.get_feature_groups" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_feature_groups</span>


<a href="#mescal.visualizations.folium_viz_system.kpi_collection_map_visualizer.KPICollectionMapVisualizer.get_feature_groups" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_feature_groups</span><span class="p">(</span><span class="n">kpi_collection</span><span class="p">:</span> <span class="n"><span title="mescal.kpis.KPICollection">KPICollection</span></span><span class="p">,</span> <span class="n">show</span><span class="p">:</span> <span class="n"><span title="mescal.visualizations.folium_viz_system.kpi_collection_map_visualizer.SHOW_OPTIONS">SHOW_OPTIONS</span></span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">overlay</span><span class="p">:</span> <span class="n"><span title="bool">bool</span></span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="list">list</span></span><span class="p">[</span><span class="n"><span title="folium.FeatureGroup">FeatureGroup</span></span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Create feature groups for KPI collection with organized grouping.</p>
<p>Main method that processes KPI collection through grouping, creates
folium FeatureGroups, and applies all configured generators to create
a complete map visualization.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>kpi_collection</code>
            </td>
            <td>
                  <code><span title="mescal.kpis.KPICollection">KPICollection</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Collection of KPIs to visualize</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>show</code>
            </td>
            <td>
                  <code><span title="mescal.visualizations.folium_viz_system.kpi_collection_map_visualizer.SHOW_OPTIONS">SHOW_OPTIONS</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Which feature groups to show initially ('first', 'last', 'none')</p>
              </div>
            </td>
            <td>
                  <code>&#39;none&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>overlay</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether feature groups should be overlay controls</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="folium.FeatureGroup">FeatureGroup</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of folium FeatureGroup objects ready to add to map</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>submodules/mescal/mescal/visualizations/folium_viz_system/kpi_collection_map_visualizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_feature_groups</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">kpi_collection</span><span class="p">:</span> <span class="n">KPICollection</span><span class="p">,</span>
        <span class="n">show</span><span class="p">:</span> <span class="n">SHOW_OPTIONS</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span>
        <span class="n">overlay</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">folium</span><span class="o">.</span><span class="n">FeatureGroup</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create feature groups for KPI collection with organized grouping.</span>

<span class="sd">    Main method that processes KPI collection through grouping, creates</span>
<span class="sd">    folium FeatureGroups, and applies all configured generators to create</span>
<span class="sd">    a complete map visualization.</span>

<span class="sd">    Args:</span>
<span class="sd">        kpi_collection: Collection of KPIs to visualize</span>
<span class="sd">        show: Which feature groups to show initially (&#39;first&#39;, &#39;last&#39;, &#39;none&#39;)</span>
<span class="sd">        overlay: Whether feature groups should be overlay controls</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of folium FeatureGroup objects ready to add to map</span>
<span class="sd">    &quot;&quot;&quot;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create feature groups for KPI collection, replicating original functionality.&quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">tqdm</span><span class="w"> </span><span class="kn">import</span> <span class="n">tqdm</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">mescal.utils.logging</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_logger</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">feature_groups</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">pbar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">kpi_collection</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="n">kpi_collection</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">pbar</span><span class="p">:</span>
        <span class="n">kpi_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grouping_manager</span><span class="o">.</span><span class="n">get_kpi_groups</span><span class="p">(</span><span class="n">kpi_collection</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">kpi_group</span> <span class="ow">in</span> <span class="n">kpi_groups</span><span class="p">:</span>
            <span class="n">group_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grouping_manager</span><span class="o">.</span><span class="n">get_feature_group_name</span><span class="p">(</span><span class="n">kpi_group</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">show</span> <span class="o">==</span> <span class="s1">&#39;first&#39;</span><span class="p">:</span>
                <span class="n">show_fg</span> <span class="o">=</span> <span class="n">kpi_group</span> <span class="o">==</span> <span class="n">kpi_groups</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">show</span> <span class="o">==</span> <span class="s1">&#39;last&#39;</span><span class="p">:</span>
                <span class="n">show_fg</span> <span class="o">=</span> <span class="n">kpi_group</span> <span class="o">==</span> <span class="n">kpi_groups</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">show_fg</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="n">fg</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">FeatureGroup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">group_name</span><span class="p">,</span> <span class="n">overlay</span><span class="o">=</span><span class="n">overlay</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">show_fg</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">kpi</span> <span class="ow">in</span> <span class="n">kpi_group</span><span class="p">:</span>
                <span class="n">data_item</span> <span class="o">=</span> <span class="n">KPIDataItem</span><span class="p">(</span><span class="n">kpi</span><span class="p">,</span> <span class="n">kpi_collection</span><span class="p">,</span> <span class="n">study_manager</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">study_manager</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">generator</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">generators</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_related_kpis_in_tooltip</span><span class="p">:</span>
                        <span class="n">_tmp</span> <span class="o">=</span> <span class="n">generator</span><span class="o">.</span><span class="n">feature_resolver</span><span class="o">.</span><span class="n">property_mappers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tooltip&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                        <span class="n">generator</span><span class="o">.</span><span class="n">feature_resolver</span><span class="o">.</span><span class="n">property_mappers</span><span class="p">[</span><span class="s1">&#39;tooltip&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_enhanced_tooltip_generator</span><span class="p">()</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">generator</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">data_item</span><span class="p">,</span> <span class="n">fg</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s1">&#39;Exception while trying to add KPI </span><span class="si">{</span><span class="n">kpi</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> to FeatureGroup </span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span>
                        <span class="p">)</span>
                    <span class="k">finally</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_related_kpis_in_tooltip</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">_tmp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">generator</span><span class="o">.</span><span class="n">feature_resolver</span><span class="o">.</span><span class="n">property_mappers</span><span class="p">[</span><span class="s1">&#39;tooltip&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_tmp</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">generator</span><span class="o">.</span><span class="n">feature_resolver</span><span class="o">.</span><span class="n">property_mappers</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;tooltip&#39;</span><span class="p">)</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

            <span class="n">feature_groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fg</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">feature_groups</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="mescal.visualizations.folium_viz_system.kpi_collection_map_visualizer.KPIGroupingManager" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">KPIGroupingManager</span>


<a href="#mescal.visualizations.folium_viz_system.kpi_collection_map_visualizer.KPIGroupingManager" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">


        <p>Manages sophisticated KPI grouping and organization for map visualization.</p>
<p>Handles the complex logic of grouping KPIs by their attributes, creating
meaningful feature group names, and finding related KPIs for enhanced
tooltips. Supports custom sorting orders and category hierarchies.</p>
<p>The grouping system is designed to create logical visual organization
of energy system KPIs, where related metrics (same flag, different datasets)
are grouped together and presented with consistent naming.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>kpi_attribute_category_orders</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="list">list</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Custom ordering for specific attribute values</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kpi_attribute_keys_to_exclude_from_grouping</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Attributes to ignore during grouping</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kpi_attribute_sort_order</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Order of attributes for group sorting</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <p>Custom grouping configuration:</p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">manager</span> <span class="o">=</span> <span class="n">KPIGroupingManager</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">kpi_attribute_category_orders</span><span class="o">=</span><span class="p">{</span>
<span class="gp">... </span>        <span class="s1">&#39;dataset&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;reference&#39;</span><span class="p">,</span> <span class="s1">&#39;scenario_1&#39;</span><span class="p">,</span> <span class="s1">&#39;scenario_2&#39;</span><span class="p">],</span>
<span class="gp">... </span>        <span class="s1">&#39;aggregation&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Sum&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean&#39;</span><span class="p">,</span> <span class="s1">&#39;Max&#39;</span><span class="p">]</span>
<span class="gp">... </span>    <span class="p">},</span>
<span class="gp">... </span>    <span class="n">kpi_attribute_keys_to_exclude_from_grouping</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;object_name&#39;</span><span class="p">]</span>
<span class="gp">... </span><span class="p">)</span>
</code></pre></div>








              <details class="quote">
                <summary>Source code in <code>submodules/mescal/mescal/visualizations/folium_viz_system/kpi_collection_map_visualizer.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">KPIGroupingManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Manages sophisticated KPI grouping and organization for map visualization.</span>

<span class="sd">    Handles the complex logic of grouping KPIs by their attributes, creating</span>
<span class="sd">    meaningful feature group names, and finding related KPIs for enhanced</span>
<span class="sd">    tooltips. Supports custom sorting orders and category hierarchies.</span>

<span class="sd">    The grouping system is designed to create logical visual organization</span>
<span class="sd">    of energy system KPIs, where related metrics (same flag, different datasets)</span>
<span class="sd">    are grouped together and presented with consistent naming.</span>

<span class="sd">    Args:</span>
<span class="sd">        kpi_attribute_category_orders: Custom ordering for specific attribute values</span>
<span class="sd">        kpi_attribute_keys_to_exclude_from_grouping: Attributes to ignore during grouping</span>
<span class="sd">        kpi_attribute_sort_order: Order of attributes for group sorting</span>

<span class="sd">    Examples:</span>
<span class="sd">        Custom grouping configuration:</span>
<span class="sd">        &gt;&gt;&gt; manager = KPIGroupingManager(</span>
<span class="sd">        ...     kpi_attribute_category_orders={</span>
<span class="sd">        ...         &#39;dataset&#39;: [&#39;reference&#39;, &#39;scenario_1&#39;, &#39;scenario_2&#39;],</span>
<span class="sd">        ...         &#39;aggregation&#39;: [&#39;Sum&#39;, &#39;Mean&#39;, &#39;Max&#39;]</span>
<span class="sd">        ...     },</span>
<span class="sd">        ...     kpi_attribute_keys_to_exclude_from_grouping=[&#39;object_name&#39;]</span>
<span class="sd">        ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DEFAULT_EXCLUDE_FROM_GROUPING</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;object_name&#39;</span><span class="p">,</span> <span class="s1">&#39;column_subset&#39;</span><span class="p">]</span>
    <span class="n">DEFAULT_SORT_ORDER</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;name_prefix&#39;</span><span class="p">,</span> <span class="s1">&#39;model_flag&#39;</span><span class="p">,</span> <span class="s1">&#39;flag&#39;</span><span class="p">,</span> <span class="s1">&#39;model_query&#39;</span><span class="p">,</span> <span class="s1">&#39;aggregation&#39;</span><span class="p">,</span>
        <span class="s1">&#39;reference_dataset&#39;</span><span class="p">,</span> <span class="s1">&#39;variation_dataset&#39;</span><span class="p">,</span> <span class="s1">&#39;dataset&#39;</span><span class="p">,</span>
        <span class="s1">&#39;value_comparison&#39;</span><span class="p">,</span> <span class="s1">&#39;value_operation&#39;</span><span class="p">,</span> <span class="s1">&#39;name_suffix&#39;</span>
    <span class="p">]</span>
    <span class="n">DEFAULT_INCLUDE_ATTRIBUTES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;value_operation&#39;</span><span class="p">,</span> <span class="s1">&#39;aggregation&#39;</span><span class="p">,</span> <span class="s1">&#39;flag&#39;</span><span class="p">,</span> <span class="s1">&#39;dataset&#39;</span><span class="p">,</span> <span class="s1">&#39;unit&#39;</span><span class="p">]</span>
    <span class="n">DEFAULT_EXCLUDE_ATTRIBUTES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;variation_dataset&#39;</span><span class="p">,</span> <span class="s1">&#39;reference_dataset&#39;</span><span class="p">,</span> <span class="s1">&#39;model_flag&#39;</span><span class="p">,</span> <span class="s1">&#39;base_unit&#39;</span><span class="p">,</span> <span class="s1">&#39;dataset_type&#39;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">kpi_attribute_category_orders</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">kpi_attribute_keys_to_exclude_from_grouping</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">kpi_attribute_sort_order</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kpi_attribute_category_orders</span> <span class="o">=</span> <span class="n">kpi_attribute_category_orders</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kpi_attribute_keys_to_exclude_from_grouping</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">kpi_attribute_keys_to_exclude_from_grouping</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_EXCLUDE_FROM_GROUPING</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kpi_attribute_sort_order</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">kpi_attribute_sort_order</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_SORT_ORDER</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_kpi_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kpi_collection</span><span class="p">:</span> <span class="n">KPICollection</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">KPICollection</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Group KPIs by attributes with sophisticated sorting.</span>

<span class="sd">        Creates logical groups of KPIs based on their attributes, excluding</span>
<span class="sd">        specified attributes from grouping and applying custom sort orders.</span>

<span class="sd">        Args:</span>
<span class="sd">            kpi_collection: Collection of KPIs to group</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of KPICollection objects, each representing a logical group</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">mescal.utils.dict_combinations</span><span class="w"> </span><span class="kn">import</span> <span class="n">dict_combination_iterator</span>

        <span class="n">attribute_sets</span> <span class="o">=</span> <span class="n">kpi_collection</span><span class="o">.</span><span class="n">get_all_kpi_attributes_and_value_sets</span><span class="p">(</span><span class="n">primitive_values</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">relevant_attribute_sets</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">attribute_sets</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kpi_attribute_keys_to_exclude_from_grouping</span>
        <span class="p">}</span>

        <span class="n">ordered_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kpi_attribute_sort_order</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">relevant_attribute_sets</span><span class="p">]</span>

        <span class="c1"># Build attribute value rankings</span>
        <span class="n">attribute_value_rank</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">ordered_keys</span><span class="p">:</span>
            <span class="n">existing_values</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">relevant_attribute_sets</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="p">[]))</span>
            <span class="n">manual_order</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kpi_attribute_category_orders</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="p">[])</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">existing_values</span><span class="p">]</span>
            <span class="n">remaining</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">existing_values</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">manual_order</span><span class="p">))</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">remaining</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">remaining</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="n">full_order</span> <span class="o">=</span> <span class="n">manual_order</span> <span class="o">+</span> <span class="n">remaining</span>
            <span class="n">attribute_value_rank</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">val</span><span class="p">:</span> <span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">full_order</span><span class="p">)}</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">sorting_index</span><span class="p">(</span><span class="n">group_kwargs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span>
                <span class="n">attribute_value_rank</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">group_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">ordered_keys</span>
            <span class="p">)</span>

        <span class="c1"># Create and sort groups</span>
        <span class="n">group_kwargs_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dict_combination_iterator</span><span class="p">(</span><span class="n">relevant_attribute_sets</span><span class="p">))</span>
        <span class="n">group_kwargs_list</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">sorting_index</span><span class="p">)</span>

        <span class="n">groups</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">KPICollection</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">group_kwargs</span> <span class="ow">in</span> <span class="n">group_kwargs_list</span><span class="p">:</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">kpi_collection</span><span class="o">.</span><span class="n">get_filtered_kpi_collection_by_attributes</span><span class="p">(</span><span class="o">**</span><span class="n">group_kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="n">groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">groups</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_feature_group_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kpi_group</span><span class="p">:</span> <span class="n">KPICollection</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate meaningful feature group name from KPI group.</span>

<span class="sd">        Creates human-readable names for map feature groups based on</span>
<span class="sd">        common KPI attributes, prioritizing important attributes.</span>

<span class="sd">        Args:</span>
<span class="sd">            kpi_group: KPI group to generate name for</span>

<span class="sd">        Returns:</span>
<span class="sd">            Human-readable feature group name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="n">kpi_group</span><span class="o">.</span><span class="n">get_in_common_kpi_attributes</span><span class="p">(</span><span class="n">primitive_values</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_EXCLUDE_ATTRIBUTES</span><span class="p">:</span>
            <span class="n">attributes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">components</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">include_attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_INCLUDE_ATTRIBUTES</span> <span class="o">+</span> <span class="p">[</span>
            <span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_INCLUDE_ATTRIBUTES</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">include_attrs</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">components</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

        <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">components</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_related_kpi_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kpi</span><span class="p">:</span> <span class="n">KPI</span><span class="p">,</span> <span class="n">study_manager</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">KPICollection</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get related KPIs grouped by relationship type.</span>

<span class="sd">        Finds KPIs related to the given KPI across different dimensions</span>
<span class="sd">        (comparisons, aggregations, datasets) for enhanced tooltip display.</span>

<span class="sd">        Args:</span>
<span class="sd">            kpi: Source KPI to find relatives for</span>
<span class="sd">            study_manager: StudyManager for accessing related KPIs</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict mapping relationship type to KPICollection of related KPIs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">mescal.kpis</span><span class="w"> </span><span class="kn">import</span> <span class="n">ValueComparisonKPI</span><span class="p">,</span> <span class="n">ArithmeticValueOperationKPI</span>

        <span class="n">groups</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Different Comparisons / ValueOperations&#39;</span><span class="p">:</span> <span class="n">KPICollection</span><span class="p">(),</span>
            <span class="s1">&#39;Different Aggregations&#39;</span><span class="p">:</span> <span class="n">KPICollection</span><span class="p">(),</span>
            <span class="s1">&#39;Different Datasets&#39;</span><span class="p">:</span> <span class="n">KPICollection</span><span class="p">(),</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">study_manager</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">groups</span>

        <span class="n">kpi_atts</span> <span class="o">=</span> <span class="n">kpi</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">as_dict</span><span class="p">(</span><span class="n">primitive_values</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">_must_contain</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;flag&#39;</span><span class="p">,</span> <span class="s1">&#39;aggregation&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">kpi_atts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">_must_contain</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">groups</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">pre_filtered</span> <span class="o">=</span> <span class="n">study_manager</span><span class="o">.</span><span class="n">scen_comp</span><span class="o">.</span><span class="n">get_merged_kpi_collection</span><span class="p">()</span>
            <span class="n">pre_filtered</span> <span class="o">=</span> <span class="n">pre_filtered</span><span class="o">.</span><span class="n">get_filtered_kpi_collection_by_attributes</span><span class="p">(</span>
                <span class="n">object_name</span><span class="o">=</span><span class="n">kpi</span><span class="o">.</span><span class="n">get_attributed_object_name</span><span class="p">(),</span>
                <span class="n">flag</span><span class="o">=</span><span class="n">kpi_atts</span><span class="p">[</span><span class="s1">&#39;flag&#39;</span><span class="p">],</span>
                <span class="n">model_flag</span><span class="o">=</span><span class="n">kpi</span><span class="o">.</span><span class="n">get_attributed_model_flag</span><span class="p">(),</span>
            <span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">groups</span>

        <span class="n">_main_kpi_is_value_op</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kpi</span><span class="p">,</span> <span class="p">(</span><span class="n">ValueComparisonKPI</span><span class="p">,</span> <span class="n">ArithmeticValueOperationKPI</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">potential_relative</span> <span class="ow">in</span> <span class="n">pre_filtered</span><span class="p">:</span>
            <span class="n">pratts</span> <span class="o">=</span> <span class="n">potential_relative</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">as_dict</span><span class="p">(</span><span class="n">primitive_values</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pratts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dataset&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">kpi_atts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dataset&#39;</span><span class="p">):</span>  <span class="c1"># same ds</span>
                <span class="k">if</span> <span class="n">pratts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;aggregation&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="n">kpi_atts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;aggregation&#39;</span><span class="p">):</span>  <span class="c1"># same ds, agg</span>
                    <span class="k">if</span> <span class="n">pratts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value_operation&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">!=</span> <span class="n">kpi_atts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value_operation&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                        <span class="n">groups</span><span class="p">[</span><span class="s1">&#39;Different Comparisons / ValueOperations&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_kpi</span><span class="p">(</span><span class="n">potential_relative</span><span class="p">)</span>
                        <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># same ds, diff agg</span>
                    <span class="k">if</span> <span class="n">pratts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value_operation&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">groups</span><span class="p">[</span><span class="s1">&#39;Different Aggregations&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_kpi</span><span class="p">(</span><span class="n">potential_relative</span><span class="p">)</span>
                        <span class="k">continue</span>
                    <span class="k">elif</span> <span class="n">pratts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value_operation&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">kpi_atts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value_operation&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                        <span class="n">groups</span><span class="p">[</span><span class="s1">&#39;Different Aggregations&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_kpi</span><span class="p">(</span><span class="n">potential_relative</span><span class="p">)</span>
                        <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">pratts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;aggregation&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="n">kpi_atts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;aggregation&#39;</span><span class="p">):</span>  <span class="c1"># same agg, diff ds</span>
                <span class="k">if</span> <span class="n">pratts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value_operation&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="n">kpi_atts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value_operation&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="n">groups</span><span class="p">[</span><span class="s1">&#39;Different Datasets&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_kpi</span><span class="p">(</span><span class="n">potential_relative</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">_main_kpi_is_value_op</span><span class="p">:</span>
                    <span class="n">groups</span><span class="p">[</span><span class="s1">&#39;Different Comparisons / ValueOperations&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_kpi</span><span class="p">(</span><span class="n">potential_relative</span><span class="p">)</span>
                    <span class="k">continue</span>

        <span class="k">return</span> <span class="n">groups</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="mescal.visualizations.folium_viz_system.kpi_collection_map_visualizer.KPIGroupingManager.get_kpi_groups" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_kpi_groups</span>


<a href="#mescal.visualizations.folium_viz_system.kpi_collection_map_visualizer.KPIGroupingManager.get_kpi_groups" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_kpi_groups</span><span class="p">(</span><span class="n">kpi_collection</span><span class="p">:</span> <span class="n"><span title="mescal.kpis.KPICollection">KPICollection</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="list">list</span></span><span class="p">[</span><span class="n"><span title="mescal.kpis.KPICollection">KPICollection</span></span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Group KPIs by attributes with sophisticated sorting.</p>
<p>Creates logical groups of KPIs based on their attributes, excluding
specified attributes from grouping and applying custom sort orders.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>kpi_collection</code>
            </td>
            <td>
                  <code><span title="mescal.kpis.KPICollection">KPICollection</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Collection of KPIs to group</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="mescal.kpis.KPICollection">KPICollection</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of KPICollection objects, each representing a logical group</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>submodules/mescal/mescal/visualizations/folium_viz_system/kpi_collection_map_visualizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_kpi_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kpi_collection</span><span class="p">:</span> <span class="n">KPICollection</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">KPICollection</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Group KPIs by attributes with sophisticated sorting.</span>

<span class="sd">    Creates logical groups of KPIs based on their attributes, excluding</span>
<span class="sd">    specified attributes from grouping and applying custom sort orders.</span>

<span class="sd">    Args:</span>
<span class="sd">        kpi_collection: Collection of KPIs to group</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of KPICollection objects, each representing a logical group</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">mescal.utils.dict_combinations</span><span class="w"> </span><span class="kn">import</span> <span class="n">dict_combination_iterator</span>

    <span class="n">attribute_sets</span> <span class="o">=</span> <span class="n">kpi_collection</span><span class="o">.</span><span class="n">get_all_kpi_attributes_and_value_sets</span><span class="p">(</span><span class="n">primitive_values</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">relevant_attribute_sets</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">attribute_sets</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kpi_attribute_keys_to_exclude_from_grouping</span>
    <span class="p">}</span>

    <span class="n">ordered_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kpi_attribute_sort_order</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">relevant_attribute_sets</span><span class="p">]</span>

    <span class="c1"># Build attribute value rankings</span>
    <span class="n">attribute_value_rank</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">ordered_keys</span><span class="p">:</span>
        <span class="n">existing_values</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">relevant_attribute_sets</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="p">[]))</span>
        <span class="n">manual_order</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kpi_attribute_category_orders</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="p">[])</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">existing_values</span><span class="p">]</span>
        <span class="n">remaining</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">existing_values</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">manual_order</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">remaining</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">remaining</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">full_order</span> <span class="o">=</span> <span class="n">manual_order</span> <span class="o">+</span> <span class="n">remaining</span>
        <span class="n">attribute_value_rank</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">val</span><span class="p">:</span> <span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">full_order</span><span class="p">)}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sorting_index</span><span class="p">(</span><span class="n">group_kwargs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span>
            <span class="n">attribute_value_rank</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">group_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">ordered_keys</span>
        <span class="p">)</span>

    <span class="c1"># Create and sort groups</span>
    <span class="n">group_kwargs_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dict_combination_iterator</span><span class="p">(</span><span class="n">relevant_attribute_sets</span><span class="p">))</span>
    <span class="n">group_kwargs_list</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">sorting_index</span><span class="p">)</span>

    <span class="n">groups</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">KPICollection</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">group_kwargs</span> <span class="ow">in</span> <span class="n">group_kwargs_list</span><span class="p">:</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">kpi_collection</span><span class="o">.</span><span class="n">get_filtered_kpi_collection_by_attributes</span><span class="p">(</span><span class="o">**</span><span class="n">group_kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">groups</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="mescal.visualizations.folium_viz_system.kpi_collection_map_visualizer.KPIGroupingManager.get_feature_group_name" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_feature_group_name</span>


<a href="#mescal.visualizations.folium_viz_system.kpi_collection_map_visualizer.KPIGroupingManager.get_feature_group_name" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_feature_group_name</span><span class="p">(</span><span class="n">kpi_group</span><span class="p">:</span> <span class="n"><span title="mescal.kpis.KPICollection">KPICollection</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="str">str</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Generate meaningful feature group name from KPI group.</p>
<p>Creates human-readable names for map feature groups based on
common KPI attributes, prioritizing important attributes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>kpi_group</code>
            </td>
            <td>
                  <code><span title="mescal.kpis.KPICollection">KPICollection</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>KPI group to generate name for</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Human-readable feature group name</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>submodules/mescal/mescal/visualizations/folium_viz_system/kpi_collection_map_visualizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_feature_group_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kpi_group</span><span class="p">:</span> <span class="n">KPICollection</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate meaningful feature group name from KPI group.</span>

<span class="sd">    Creates human-readable names for map feature groups based on</span>
<span class="sd">    common KPI attributes, prioritizing important attributes.</span>

<span class="sd">    Args:</span>
<span class="sd">        kpi_group: KPI group to generate name for</span>

<span class="sd">    Returns:</span>
<span class="sd">        Human-readable feature group name</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">attributes</span> <span class="o">=</span> <span class="n">kpi_group</span><span class="o">.</span><span class="n">get_in_common_kpi_attributes</span><span class="p">(</span><span class="n">primitive_values</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_EXCLUDE_ATTRIBUTES</span><span class="p">:</span>
        <span class="n">attributes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="n">components</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">include_attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_INCLUDE_ATTRIBUTES</span> <span class="o">+</span> <span class="p">[</span>
        <span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_INCLUDE_ATTRIBUTES</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">include_attrs</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">components</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

    <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">components</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="mescal.visualizations.folium_viz_system.kpi_collection_map_visualizer.KPIGroupingManager.get_related_kpi_groups" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_related_kpi_groups</span>


<a href="#mescal.visualizations.folium_viz_system.kpi_collection_map_visualizer.KPIGroupingManager.get_related_kpi_groups" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_related_kpi_groups</span><span class="p">(</span><span class="n">kpi</span><span class="p">:</span> <span class="n"><span title="mescal.kpis.KPI">KPI</span></span><span class="p">,</span> <span class="n">study_manager</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="dict">dict</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n"><span title="mescal.kpis.KPICollection">KPICollection</span></span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get related KPIs grouped by relationship type.</p>
<p>Finds KPIs related to the given KPI across different dimensions
(comparisons, aggregations, datasets) for enhanced tooltip display.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>kpi</code>
            </td>
            <td>
                  <code><span title="mescal.kpis.KPI">KPI</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Source KPI to find relatives for</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>study_manager</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>StudyManager for accessing related KPIs</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="mescal.kpis.KPICollection">KPICollection</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict mapping relationship type to KPICollection of related KPIs</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>submodules/mescal/mescal/visualizations/folium_viz_system/kpi_collection_map_visualizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_related_kpi_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kpi</span><span class="p">:</span> <span class="n">KPI</span><span class="p">,</span> <span class="n">study_manager</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">KPICollection</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get related KPIs grouped by relationship type.</span>

<span class="sd">    Finds KPIs related to the given KPI across different dimensions</span>
<span class="sd">    (comparisons, aggregations, datasets) for enhanced tooltip display.</span>

<span class="sd">    Args:</span>
<span class="sd">        kpi: Source KPI to find relatives for</span>
<span class="sd">        study_manager: StudyManager for accessing related KPIs</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dict mapping relationship type to KPICollection of related KPIs</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">mescal.kpis</span><span class="w"> </span><span class="kn">import</span> <span class="n">ValueComparisonKPI</span><span class="p">,</span> <span class="n">ArithmeticValueOperationKPI</span>

    <span class="n">groups</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Different Comparisons / ValueOperations&#39;</span><span class="p">:</span> <span class="n">KPICollection</span><span class="p">(),</span>
        <span class="s1">&#39;Different Aggregations&#39;</span><span class="p">:</span> <span class="n">KPICollection</span><span class="p">(),</span>
        <span class="s1">&#39;Different Datasets&#39;</span><span class="p">:</span> <span class="n">KPICollection</span><span class="p">(),</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">study_manager</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">groups</span>

    <span class="n">kpi_atts</span> <span class="o">=</span> <span class="n">kpi</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">as_dict</span><span class="p">(</span><span class="n">primitive_values</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">_must_contain</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;flag&#39;</span><span class="p">,</span> <span class="s1">&#39;aggregation&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">kpi_atts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">_must_contain</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">groups</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">pre_filtered</span> <span class="o">=</span> <span class="n">study_manager</span><span class="o">.</span><span class="n">scen_comp</span><span class="o">.</span><span class="n">get_merged_kpi_collection</span><span class="p">()</span>
        <span class="n">pre_filtered</span> <span class="o">=</span> <span class="n">pre_filtered</span><span class="o">.</span><span class="n">get_filtered_kpi_collection_by_attributes</span><span class="p">(</span>
            <span class="n">object_name</span><span class="o">=</span><span class="n">kpi</span><span class="o">.</span><span class="n">get_attributed_object_name</span><span class="p">(),</span>
            <span class="n">flag</span><span class="o">=</span><span class="n">kpi_atts</span><span class="p">[</span><span class="s1">&#39;flag&#39;</span><span class="p">],</span>
            <span class="n">model_flag</span><span class="o">=</span><span class="n">kpi</span><span class="o">.</span><span class="n">get_attributed_model_flag</span><span class="p">(),</span>
        <span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">groups</span>

    <span class="n">_main_kpi_is_value_op</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kpi</span><span class="p">,</span> <span class="p">(</span><span class="n">ValueComparisonKPI</span><span class="p">,</span> <span class="n">ArithmeticValueOperationKPI</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">potential_relative</span> <span class="ow">in</span> <span class="n">pre_filtered</span><span class="p">:</span>
        <span class="n">pratts</span> <span class="o">=</span> <span class="n">potential_relative</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">as_dict</span><span class="p">(</span><span class="n">primitive_values</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pratts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dataset&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">kpi_atts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dataset&#39;</span><span class="p">):</span>  <span class="c1"># same ds</span>
            <span class="k">if</span> <span class="n">pratts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;aggregation&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="n">kpi_atts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;aggregation&#39;</span><span class="p">):</span>  <span class="c1"># same ds, agg</span>
                <span class="k">if</span> <span class="n">pratts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value_operation&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">!=</span> <span class="n">kpi_atts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value_operation&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="n">groups</span><span class="p">[</span><span class="s1">&#39;Different Comparisons / ValueOperations&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_kpi</span><span class="p">(</span><span class="n">potential_relative</span><span class="p">)</span>
                    <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># same ds, diff agg</span>
                <span class="k">if</span> <span class="n">pratts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value_operation&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">groups</span><span class="p">[</span><span class="s1">&#39;Different Aggregations&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_kpi</span><span class="p">(</span><span class="n">potential_relative</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="n">pratts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value_operation&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">kpi_atts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value_operation&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="n">groups</span><span class="p">[</span><span class="s1">&#39;Different Aggregations&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_kpi</span><span class="p">(</span><span class="n">potential_relative</span><span class="p">)</span>
                    <span class="k">continue</span>
        <span class="k">elif</span> <span class="n">pratts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;aggregation&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="n">kpi_atts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;aggregation&#39;</span><span class="p">):</span>  <span class="c1"># same agg, diff ds</span>
            <span class="k">if</span> <span class="n">pratts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value_operation&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="n">kpi_atts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value_operation&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">groups</span><span class="p">[</span><span class="s1">&#39;Different Datasets&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_kpi</span><span class="p">(</span><span class="n">potential_relative</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_main_kpi_is_value_op</span><span class="p">:</span>
                <span class="n">groups</span><span class="p">[</span><span class="s1">&#39;Different Comparisons / ValueOperations&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_kpi</span><span class="p">(</span><span class="n">potential_relative</span><span class="p">)</span>
                <span class="k">continue</span>

    <span class="k">return</span> <span class="n">groups</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../../..", "features": ["navigation.tabs", "content.tabs.link", "navigation.sections"], "search": "../../../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>