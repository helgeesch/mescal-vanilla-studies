
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://docs.mesqual.io/mescal-package-documentation/api_reference/energy_data_handling/area_accounting/border_variables/">
      
      
        <link rel="prev" href="../area_variables/">
      
      
        <link rel="next" href="../../model_handling/">
      
      
      <link rel="icon" href="../../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.19">
    
    
      
        <title>Border Variables - MESCAL Suite Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="amber">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#areaborder-variable-accounting" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../.." title="MESCAL Suite Documentation" class="md-header__button md-logo" aria-label="MESCAL Suite Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            MESCAL Suite Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Border Variables
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/helgeesch/mescal-vanilla-studies/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../../study_manager/" class="md-tabs__link">
          
  
  
  MESCAL API Reference

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../../mescal-study-01/notebooks/mescal_101_study_manager_and_basic_fetching/" class="md-tabs__link">
          
  
  
  Studies & Examples

        </a>
      </li>
    
  

    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="MESCAL Suite Documentation" class="md-nav__button md-logo" aria-label="MESCAL Suite Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    MESCAL Suite Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/helgeesch/mescal-vanilla-studies/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    MESCAL API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            MESCAL API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Core
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Core
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../study_manager/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    StudyManager
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../datasets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Datasets
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_3" >
        
          
          <label class="md-nav__link" for="__nav_2_1_3" id="__nav_2_1_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Flag System
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_3">
            <span class="md-nav__icon md-icon"></span>
            Flag System
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../flag/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Flag
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../flag_index/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FlagIndex
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../units/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Units
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../validation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../visualization/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Visualization Modules
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_2" id="__nav_2_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Visualization Modules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../visualization/time_series_dashboard/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    TimeSeriesDashboard
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../visualization/folium_viz_system/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Folium Viz System
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_2_2" id="__nav_2_2_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_2">
            <span class="md-nav__icon md-icon"></span>
            Folium Viz System
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../visualization/folium_viz_system/areas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Areas
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../visualization/folium_viz_system/circle_marker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Circle Marker
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../visualization/folium_viz_system/text_overlay/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Text Overlay
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../visualization/folium_viz_system/lines/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lines
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../visualization/folium_viz_system/line_text_overlay/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Line Text Overlay
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../visualization/folium_viz_system/arrow_icon/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Arrow Icon
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_2_7" >
        
          
          <label class="md-nav__link" for="__nav_2_2_2_7" id="__nav_2_2_2_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Base
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_2_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_2_7">
            <span class="md-nav__icon md-icon"></span>
            Base
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../visualization/folium_viz_system/system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Abstract System
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../visualization/folium_viz_system/data_item/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Data Item
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../visualization/folium_viz_system/kpi_collection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    KPI Collection Visualizer
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../visualization/folium_legend_system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Folium Legend System
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../visualization/html_table/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    HTML Table
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../visualization/html_dashboard/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    HTML Dashboard
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Energy Data Handling
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_3" id="__nav_2_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Energy Data Handling
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_1" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Area Accounting
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_3_1" id="__nav_2_3_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_3_1">
            <span class="md-nav__icon md-icon"></span>
            Area Accounting
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../model_gen/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Area / Border Model Generators
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../area_variables/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Area Variables
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Border Variables
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Border Variables
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#mescal.energy_data_handling.area_accounting.border_variable_base.AreaBorderVariableCalculatorBase" class="md-nav__link">
    <span class="md-ellipsis">
      AreaBorderVariableCalculatorBase
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AreaBorderVariableCalculatorBase">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mescal.energy_data_handling.area_accounting.border_variable_base.AreaBorderVariableCalculatorBase.variable_name" class="md-nav__link">
    <span class="md-ellipsis">
      variable_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mescal.energy_data_handling.area_accounting.border_variable_base.AreaBorderVariableCalculatorBase.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mescal.energy_data_handling.area_accounting.border_variable_base.AreaBorderVariableCalculatorBase.get_border_lines_in_topological_up_and_down_direction" class="md-nav__link">
    <span class="md-ellipsis">
      get_border_lines_in_topological_up_and_down_direction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mescal.energy_data_handling.area_accounting.border_variable_base.AreaBorderVariableCalculatorBase.calculate" class="md-nav__link">
    <span class="md-ellipsis">
      calculate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mescal.energy_data_handling.area_accounting.border_variable_capacity_calculator.BorderCapacityCalculator" class="md-nav__link">
    <span class="md-ellipsis">
      BorderCapacityCalculator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BorderCapacityCalculator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mescal.energy_data_handling.area_accounting.border_variable_capacity_calculator.BorderCapacityCalculator.calculate" class="md-nav__link">
    <span class="md-ellipsis">
      calculate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mescal.energy_data_handling.area_accounting.border_variable_flow_calculator.BorderFlowCalculator" class="md-nav__link">
    <span class="md-ellipsis">
      BorderFlowCalculator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BorderFlowCalculator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mescal.energy_data_handling.area_accounting.border_variable_flow_calculator.BorderFlowCalculator.calculate" class="md-nav__link">
    <span class="md-ellipsis">
      calculate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mescal.energy_data_handling.area_accounting.border_variable_price_spread_calculator.BorderPriceSpreadCalculator" class="md-nav__link">
    <span class="md-ellipsis">
      BorderPriceSpreadCalculator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BorderPriceSpreadCalculator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mescal.energy_data_handling.area_accounting.border_variable_price_spread_calculator.BorderPriceSpreadCalculator.calculate" class="md-nav__link">
    <span class="md-ellipsis">
      calculate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mescal.energy_data_handling.area_accounting.border_variable_price_spread_calculator.BorderPriceSpreadCalculator.calculate_all_spread_types" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_all_spread_types
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../model_handling/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Model Membership Handling
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_3_2" id="__nav_2_3_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_2">
            <span class="md-nav__icon md-icon"></span>
            Model Membership Handling
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../model_handling/property_enricher/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Property Enricher
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../model_handling/pairs_appender/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pairs Appender
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../variable_utils/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Variable Utils
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_3_3" id="__nav_2_3_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_3">
            <span class="md-nav__icon md-icon"></span>
            Variable Utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../variable_utils/in_common_aggs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    In-common Aggregations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../variable_utils/direction_aggs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Up-/Down Directional Aggregations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../variable_utils/congestion_rent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Congestion Rent
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../variable_utils/regional_trade_balance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Regional Trade Balance
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../granularity_modules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Granularity Modules
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../network_lines_data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Network Lines Data
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../time_series_gap_handling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Time Series Gap Handling
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Utils
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../utils/pandas_utils/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    pandas_utils
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_4_1" id="__nav_2_4_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4_1">
            <span class="md-nav__icon md-icon"></span>
            pandas_utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../utils/pandas_utils/flatten_df/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Flatten DF
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../utils/pandas_utils/pend_props/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pend Properties
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../utils/pandas_utils/filter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Filter by Model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../utils/pandas_utils/xs_df/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    xs DF
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../utils/pandas_utils/sort_multiindex/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sort MultiIndex
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../utils/pandas_utils/merge_multi_index_levels/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Merge MultiIndex Levels
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../utils/pandas_utils/set_new_column/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Set New Column in MultiIndex
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../utils/pandas_utils/combine_dfs.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Combine DFs
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../utils/plotly_utils/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    plotly_utils
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_4_2" id="__nav_2_4_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4_2">
            <span class="md-nav__icon md-icon"></span>
            plotly_utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../utils/plotly_utils/plotly_theme/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PlotlyTheme
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../utils/plotly_utils/figure_utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    figure_utils
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../utils/plotly_utils/px_category_utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    px_category_utils
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Studies & Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Studies & Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Intro to MESCAL
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            Intro to MESCAL
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../mescal-study-01/notebooks/mescal_101_study_manager_and_basic_fetching/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MESCAL 101: StudyManager and Dataset Fundamentals
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../mescal-study-01/notebooks/mescal_102_mastering_data_fetching/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MESCAL 102: Advanced Data Fetching Techniques
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../mescal-study-01/notebooks/mescal_103_scenario_attributes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MESCAL 103: Scenario Attributes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../mescal-study-01/notebooks/mescal_301_time_series_dashboard/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MESCAL 301: Time Series Dashboard
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../mescal-study-01/notebooks/mescal_302_segmented_colormap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MESCAL 302: Segmented Colormap
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../mescal-study-01/notebooks/mescal_303_folium_model_df_map/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MESCAL 401: Folium Model Data Visualization - Areas, Points, and Lines
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../mescal-study-01/notebooks/mescal_304_folium_area_kpi_map/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MESCAL 402: Folium KPI Visualization System
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../mescal-study-01/notebooks/mescal_304_simple_area_kpi_map/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MESCAL 303: Interactive Geospatial with Folium
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../mescal-study-01/notebooks/mescal_307_country_plotter_util/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MESCAL 307: Country Plotter Utility Module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../mescal-study-01/notebooks/mescal_308_html_dashboards/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MESCAL 305: HTML Dashboard Utility
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#mescal.energy_data_handling.area_accounting.border_variable_base.AreaBorderVariableCalculatorBase" class="md-nav__link">
    <span class="md-ellipsis">
      AreaBorderVariableCalculatorBase
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AreaBorderVariableCalculatorBase">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mescal.energy_data_handling.area_accounting.border_variable_base.AreaBorderVariableCalculatorBase.variable_name" class="md-nav__link">
    <span class="md-ellipsis">
      variable_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mescal.energy_data_handling.area_accounting.border_variable_base.AreaBorderVariableCalculatorBase.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mescal.energy_data_handling.area_accounting.border_variable_base.AreaBorderVariableCalculatorBase.get_border_lines_in_topological_up_and_down_direction" class="md-nav__link">
    <span class="md-ellipsis">
      get_border_lines_in_topological_up_and_down_direction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mescal.energy_data_handling.area_accounting.border_variable_base.AreaBorderVariableCalculatorBase.calculate" class="md-nav__link">
    <span class="md-ellipsis">
      calculate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mescal.energy_data_handling.area_accounting.border_variable_capacity_calculator.BorderCapacityCalculator" class="md-nav__link">
    <span class="md-ellipsis">
      BorderCapacityCalculator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BorderCapacityCalculator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mescal.energy_data_handling.area_accounting.border_variable_capacity_calculator.BorderCapacityCalculator.calculate" class="md-nav__link">
    <span class="md-ellipsis">
      calculate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mescal.energy_data_handling.area_accounting.border_variable_flow_calculator.BorderFlowCalculator" class="md-nav__link">
    <span class="md-ellipsis">
      BorderFlowCalculator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BorderFlowCalculator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mescal.energy_data_handling.area_accounting.border_variable_flow_calculator.BorderFlowCalculator.calculate" class="md-nav__link">
    <span class="md-ellipsis">
      calculate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mescal.energy_data_handling.area_accounting.border_variable_price_spread_calculator.BorderPriceSpreadCalculator" class="md-nav__link">
    <span class="md-ellipsis">
      BorderPriceSpreadCalculator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BorderPriceSpreadCalculator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mescal.energy_data_handling.area_accounting.border_variable_price_spread_calculator.BorderPriceSpreadCalculator.calculate" class="md-nav__link">
    <span class="md-ellipsis">
      calculate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mescal.energy_data_handling.area_accounting.border_variable_price_spread_calculator.BorderPriceSpreadCalculator.calculate_all_spread_types" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_all_spread_types
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="areaborder-variable-accounting">AreaBorder Variable Accounting<a class="headerlink" href="#areaborder-variable-accounting" title="Permanent link">&para;</a></h1>


<div class="doc doc-object doc-module">




    <div class="doc doc-contents first">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="mescal.energy_data_handling.area_accounting.border_variable_base.AreaBorderVariableCalculatorBase" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">AreaBorderVariableCalculatorBase</span>


<a href="#mescal.energy_data_handling.area_accounting.border_variable_base.AreaBorderVariableCalculatorBase" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code>, <code><a class="autorefs autorefs-internal" title="            AreaBorderNamingConventions (mescal.energy_data_handling.area_accounting.border_model_generator.AreaBorderNamingConventions)" href="../model_gen/#mescal.energy_data_handling.area_accounting.border_model_generator.AreaBorderNamingConventions">AreaBorderNamingConventions</a></code></p>


        <p>Abstract base class for calculating energy variables at area border level.</p>
<p>This base class provides functionality for aggregating line-level energy data 
(flows, capacities, price spreads) to area border level. An area border represents
the interface between two areas (countries, bidding zones, etc.).</p>
<p>The class handles the complex mapping from transmission lines to area borders,
including proper handling of line directionality. Lines are classified as either
"up" or "down" relative to the border direction based on their node endpoints.</p>
<p>Border directionality:
- "Up" direction: From area_from to area_to (as defined in border naming)
- "Down" direction: From area_to to area_from
- Line direction is determined by comparing line endpoints to border areas</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>area_border_model_df</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame containing area border definitions.
Index should be border identifiers (e.g., 'DE-FR', 'FR-BE').</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>line_model_df</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame containing transmission line information.
Must include node_from_col and node_to_col columns.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>node_model_df</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame containing node information with area assignments.
Must include area_column for mapping nodes to areas.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>area_column</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Column name in node_model_df containing area assignments.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>node_from_col</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Column name in line_model_df for line starting node.</p>
              </div>
            </td>
            <td>
                  <code>&#39;node_from&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>node_to_col</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Column name in line_model_df for line ending node.</p>
              </div>
            </td>
            <td>
                  <code>&#39;node_to&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="mescal.energy_data_handling.area_accounting.border_variable_base.AreaBorderVariableCalculatorBase.area_border_model_df">area_border_model_df</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Border model DataFrame</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mescal.energy_data_handling.area_accounting.border_variable_base.AreaBorderVariableCalculatorBase.line_model_df">line_model_df</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Line model DataFrame  </p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mescal.energy_data_handling.area_accounting.border_variable_base.AreaBorderVariableCalculatorBase.node_model_df">node_model_df</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Node model DataFrame</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mescal.energy_data_handling.area_accounting.border_variable_base.AreaBorderVariableCalculatorBase.area_column">area_column</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of area assignment column</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mescal.energy_data_handling.area_accounting.border_variable_base.AreaBorderVariableCalculatorBase.node_from_col">node_from_col</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of line from-node column</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mescal.energy_data_handling.area_accounting.border_variable_base.AreaBorderVariableCalculatorBase.node_to_col">node_to_col</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of line to-node column</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mescal.energy_data_handling.area_accounting.border_variable_base.AreaBorderVariableCalculatorBase.node_to_area_map">node_to_area_map</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary mapping node IDs to area names</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If required columns are missing from input DataFrames</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Example:</p>
<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; import pandas as pd
&gt;&gt;&gt; # Define borders between areas
&gt;&gt;&gt; border_model = pd.DataFrame(index=[&#39;DE-FR&#39;, &#39;FR-BE&#39;])
&gt;&gt;&gt; 
&gt;&gt;&gt; # Define transmission lines  
&gt;&gt;&gt; line_model = pd.DataFrame({
...     &#39;node_from&#39;: [&#39;DE1&#39;, &#39;FR1&#39;],
...     &#39;node_to&#39;: [&#39;FR1&#39;, &#39;BE1&#39;],
...     &#39;capacity&#39;: [1000, 800]
... }, index=[&#39;Line1&#39;, &#39;Line2&#39;])
&gt;&gt;&gt; 
&gt;&gt;&gt; # Node-to-area mapping
&gt;&gt;&gt; node_model = pd.DataFrame({
...     &#39;country&#39;: [&#39;DE&#39;, &#39;FR&#39;, &#39;BE&#39;]
... }, index=[&#39;DE1&#39;, &#39;FR1&#39;, &#39;BE1&#39;])
&gt;&gt;&gt; 
&gt;&gt;&gt; # Subclass for specific calculation
&gt;&gt;&gt; class MyBorderCalculator(AreaBorderVariableCalculatorBase):
...     @property
...     def variable_name(self):
...         return &quot;my_variable&quot;
...     def calculate(self, **kwargs):
...         return pd.DataFrame()
&gt;&gt;&gt; 
&gt;&gt;&gt; calculator = MyBorderCalculator(
...     border_model, line_model, node_model, &#39;country&#39;
... )
</code></pre></div>








              <details class="quote">
                <summary>Source code in <code>submodules/mescal/mescal/energy_data_handling/area_accounting/border_variable_base.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AreaBorderVariableCalculatorBase</span><span class="p">(</span><span class="n">ABC</span><span class="p">,</span> <span class="n">AreaBorderNamingConventions</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Abstract base class for calculating energy variables at area border level.</span>

<span class="sd">    This base class provides functionality for aggregating line-level energy data </span>
<span class="sd">    (flows, capacities, price spreads) to area border level. An area border represents</span>
<span class="sd">    the interface between two areas (countries, bidding zones, etc.).</span>

<span class="sd">    The class handles the complex mapping from transmission lines to area borders,</span>
<span class="sd">    including proper handling of line directionality. Lines are classified as either</span>
<span class="sd">    &quot;up&quot; or &quot;down&quot; relative to the border direction based on their node endpoints.</span>

<span class="sd">    Border directionality:</span>
<span class="sd">    - &quot;Up&quot; direction: From area_from to area_to (as defined in border naming)</span>
<span class="sd">    - &quot;Down&quot; direction: From area_to to area_from</span>
<span class="sd">    - Line direction is determined by comparing line endpoints to border areas</span>

<span class="sd">    Args:</span>
<span class="sd">        area_border_model_df: DataFrame containing area border definitions.</span>
<span class="sd">            Index should be border identifiers (e.g., &#39;DE-FR&#39;, &#39;FR-BE&#39;).</span>
<span class="sd">        line_model_df: DataFrame containing transmission line information.</span>
<span class="sd">            Must include node_from_col and node_to_col columns.</span>
<span class="sd">        node_model_df: DataFrame containing node information with area assignments.</span>
<span class="sd">            Must include area_column for mapping nodes to areas.</span>
<span class="sd">        area_column: Column name in node_model_df containing area assignments.</span>
<span class="sd">        node_from_col: Column name in line_model_df for line starting node.</span>
<span class="sd">        node_to_col: Column name in line_model_df for line ending node.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        area_border_model_df: Border model DataFrame</span>
<span class="sd">        line_model_df: Line model DataFrame  </span>
<span class="sd">        node_model_df: Node model DataFrame</span>
<span class="sd">        area_column: Name of area assignment column</span>
<span class="sd">        node_from_col: Name of line from-node column</span>
<span class="sd">        node_to_col: Name of line to-node column</span>
<span class="sd">        node_to_area_map: Dictionary mapping node IDs to area names</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If required columns are missing from input DataFrames</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">        &gt;&gt;&gt; # Define borders between areas</span>
<span class="sd">        &gt;&gt;&gt; border_model = pd.DataFrame(index=[&#39;DE-FR&#39;, &#39;FR-BE&#39;])</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # Define transmission lines  </span>
<span class="sd">        &gt;&gt;&gt; line_model = pd.DataFrame({</span>
<span class="sd">        ...     &#39;node_from&#39;: [&#39;DE1&#39;, &#39;FR1&#39;],</span>
<span class="sd">        ...     &#39;node_to&#39;: [&#39;FR1&#39;, &#39;BE1&#39;],</span>
<span class="sd">        ...     &#39;capacity&#39;: [1000, 800]</span>
<span class="sd">        ... }, index=[&#39;Line1&#39;, &#39;Line2&#39;])</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # Node-to-area mapping</span>
<span class="sd">        &gt;&gt;&gt; node_model = pd.DataFrame({</span>
<span class="sd">        ...     &#39;country&#39;: [&#39;DE&#39;, &#39;FR&#39;, &#39;BE&#39;]</span>
<span class="sd">        ... }, index=[&#39;DE1&#39;, &#39;FR1&#39;, &#39;BE1&#39;])</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # Subclass for specific calculation</span>
<span class="sd">        &gt;&gt;&gt; class MyBorderCalculator(AreaBorderVariableCalculatorBase):</span>
<span class="sd">        ...     @property</span>
<span class="sd">        ...     def variable_name(self):</span>
<span class="sd">        ...         return &quot;my_variable&quot;</span>
<span class="sd">        ...     def calculate(self, **kwargs):</span>
<span class="sd">        ...         return pd.DataFrame()</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; calculator = MyBorderCalculator(</span>
<span class="sd">        ...     border_model, line_model, node_model, &#39;country&#39;</span>
<span class="sd">        ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">area_border_model_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">line_model_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">node_model_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">area_column</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">node_from_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;node_from&#39;</span><span class="p">,</span>
        <span class="n">node_to_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;node_to&#39;</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the area border variable calculator.</span>

<span class="sd">        Args:</span>
<span class="sd">            area_border_model_df: DataFrame with border definitions</span>
<span class="sd">            line_model_df: DataFrame with line information including endpoints</span>
<span class="sd">            node_model_df: DataFrame with node-to-area mapping</span>
<span class="sd">            area_column: Column name for area assignments in node_model_df</span>
<span class="sd">            node_from_col: Column name for line starting node in line_model_df</span>
<span class="sd">            node_to_col: Column name for line ending node in line_model_df</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If required columns are missing from DataFrames</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">area_column</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">area_border_model_df</span> <span class="o">=</span> <span class="n">area_border_model_df</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_model_df</span> <span class="o">=</span> <span class="n">line_model_df</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_model_df</span> <span class="o">=</span> <span class="n">node_model_df</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">area_column</span> <span class="o">=</span> <span class="n">area_column</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_from_col</span> <span class="o">=</span> <span class="n">node_from_col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_to_col</span> <span class="o">=</span> <span class="n">node_to_col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_to_area_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_node_to_area_map</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_inputs</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate input parameters during initialization.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If required columns are missing from DataFrames</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_model_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Column &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">area_column</span><span class="si">}</span><span class="s2">&#39; not found in node_model_df&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_from_col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_model_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Column &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">node_from_col</span><span class="si">}</span><span class="s2">&#39; not found in line_model_df&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_to_col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_model_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Column &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">node_to_col</span><span class="si">}</span><span class="s2">&#39; not found in line_model_df&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_create_node_to_area_map</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Hashable</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a mapping dictionary from node IDs to area names.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dictionary with node IDs as keys and area names as values.</span>
<span class="sd">            Nodes with NaN area assignments will have NaN values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_model_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">area_column</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_border_lines_in_topological_up_and_down_direction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">border_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">Hashable</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="n">Hashable</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get transmission lines for a border classified by topological direction.</span>

<span class="sd">        This method identifies which transmission lines connect the two areas of a border</span>
<span class="sd">        and classifies them based on their topological direction relative to the border.</span>

<span class="sd">        Border directionality logic:</span>
<span class="sd">        - &quot;Up&quot; direction: Lines where node_from is in area_from and node_to is in area_to</span>
<span class="sd">        - &quot;Down&quot; direction: Lines where node_from is in area_to and node_to is in area_from</span>

<span class="sd">        This classification is essential for correctly aggregating directional quantities</span>
<span class="sd">        like power flows, where the sign and direction matter for market analysis.</span>

<span class="sd">        Args:</span>
<span class="sd">            border_id: Border identifier (e.g., &#39;DE-FR&#39;) that will be decomposed</span>
<span class="sd">                into area_from and area_to using the naming convention.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple containing two lists:</span>
<span class="sd">            - lines_up: Line IDs for lines in the &quot;up&quot; direction</span>
<span class="sd">            - lines_down: Line IDs for lines in the &quot;down&quot; direction</span>

<span class="sd">        Example:</span>

<span class="sd">            &gt;&gt;&gt; # For border &#39;DE-FR&#39;</span>
<span class="sd">            &gt;&gt;&gt; lines_up, lines_down = calculator.get_border_lines_in_topological_up_and_down_direction(&#39;DE-FR&#39;)</span>
<span class="sd">            &gt;&gt;&gt; # lines_up: Lines from German nodes to French nodes  </span>
<span class="sd">            &gt;&gt;&gt; # lines_down: Lines from French nodes to German nodes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">area_from</span><span class="p">,</span> <span class="n">area_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decompose_area_border_name_to_areas</span><span class="p">(</span><span class="n">border_id</span><span class="p">)</span>
        <span class="n">nodes_in_area_from</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_model_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">node_model_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">area_column</span><span class="p">]</span> <span class="o">==</span> <span class="n">area_from</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="n">nodes_in_area_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_model_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">node_model_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">area_column</span><span class="p">]</span> <span class="o">==</span> <span class="n">area_to</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="n">lines_up</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_model_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">line_model_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">node_from_col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">nodes_in_area_from</span><span class="p">)</span>
                <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_model_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">node_to_col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">nodes_in_area_to</span><span class="p">)</span>
            <span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="n">lines_down</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_model_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">line_model_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">node_from_col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">nodes_in_area_to</span><span class="p">)</span>
                <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_model_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">node_to_col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">nodes_in_area_from</span><span class="p">)</span>
            <span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">lines_up</span><span class="p">,</span> <span class="n">lines_down</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">calculate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the border variable. Must be implemented by subclasses.</span>

<span class="sd">        This method should contain the specific logic for aggregating line-level</span>
<span class="sd">        data to border level for the particular variable type. The implementation</span>
<span class="sd">        will vary based on the variable (flows, capacities, prices, etc.) and</span>
<span class="sd">        should handle directional aggregation appropriately.</span>

<span class="sd">        Args:</span>
<span class="sd">            **kwargs: Variable-specific parameters for the calculation</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataFrame with border-level aggregated data. Index should be datetime</span>
<span class="sd">            for time series data, columns should be border identifiers.</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError: This is an abstract method</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">variable_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Name of the variable being calculated.</span>

<span class="sd">        This property should return a descriptive name for the variable being</span>
<span class="sd">        calculated by this calculator. Used for naming output columns and logging.</span>

<span class="sd">        Returns:</span>
<span class="sd">            String name of the variable (e.g., &#39;border_flow&#39;, &#39;border_capacity&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_time_series_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">data_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate that time series data has appropriate datetime index.</span>

<span class="sd">        Logs warnings if the data doesn&#39;t have a DatetimeIndex, which may indicate</span>
<span class="sd">        data formatting issues or non-time-series data being used inappropriately.</span>

<span class="sd">        Args:</span>
<span class="sd">            df: DataFrame to validate</span>
<span class="sd">            data_name: Descriptive name of the data for logging purposes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_name</span><span class="si">}</span><span class="s2"> does not have DatetimeIndex&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="mescal.energy_data_handling.area_accounting.border_variable_base.AreaBorderVariableCalculatorBase.variable_name" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">variable_name</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#mescal.energy_data_handling.area_accounting.border_variable_base.AreaBorderVariableCalculatorBase.variable_name" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">variable_name</span><span class="p">:</span> <span class="n"><span title="str">str</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Name of the variable being calculated.</p>
<p>This property should return a descriptive name for the variable being
calculated by this calculator. Used for naming output columns and logging.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>String name of the variable (e.g., 'border_flow', 'border_capacity')</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>




<div class="doc doc-object doc-function">


<h3 id="mescal.energy_data_handling.area_accounting.border_variable_base.AreaBorderVariableCalculatorBase.__init__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__init__</span>


<a href="#mescal.energy_data_handling.area_accounting.border_variable_base.AreaBorderVariableCalculatorBase.__init__" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__init__</span><span class="p">(</span><span class="n">area_border_model_df</span><span class="p">:</span> <span class="n"><span title="pandas.DataFrame">DataFrame</span></span><span class="p">,</span> <span class="n">line_model_df</span><span class="p">:</span> <span class="n"><span title="pandas.DataFrame">DataFrame</span></span><span class="p">,</span> <span class="n">node_model_df</span><span class="p">:</span> <span class="n"><span title="pandas.DataFrame">DataFrame</span></span><span class="p">,</span> <span class="n">area_column</span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n">node_from_col</span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">=</span> <span class="s1">&#39;node_from&#39;</span><span class="p">,</span> <span class="n">node_to_col</span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">=</span> <span class="s1">&#39;node_to&#39;</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Initialize the area border variable calculator.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>area_border_model_df</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame with border definitions</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>line_model_df</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame with line information including endpoints</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>node_model_df</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame with node-to-area mapping</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>area_column</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Column name for area assignments in node_model_df</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>node_from_col</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Column name for line starting node in line_model_df</p>
              </div>
            </td>
            <td>
                  <code>&#39;node_from&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>node_to_col</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Column name for line ending node in line_model_df</p>
              </div>
            </td>
            <td>
                  <code>&#39;node_to&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If required columns are missing from DataFrames</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>submodules/mescal/mescal/energy_data_handling/area_accounting/border_variable_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">area_border_model_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">line_model_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">node_model_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">area_column</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">node_from_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;node_from&#39;</span><span class="p">,</span>
    <span class="n">node_to_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;node_to&#39;</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the area border variable calculator.</span>

<span class="sd">    Args:</span>
<span class="sd">        area_border_model_df: DataFrame with border definitions</span>
<span class="sd">        line_model_df: DataFrame with line information including endpoints</span>
<span class="sd">        node_model_df: DataFrame with node-to-area mapping</span>
<span class="sd">        area_column: Column name for area assignments in node_model_df</span>
<span class="sd">        node_from_col: Column name for line starting node in line_model_df</span>
<span class="sd">        node_to_col: Column name for line ending node in line_model_df</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If required columns are missing from DataFrames</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">area_column</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">area_border_model_df</span> <span class="o">=</span> <span class="n">area_border_model_df</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">line_model_df</span> <span class="o">=</span> <span class="n">line_model_df</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">node_model_df</span> <span class="o">=</span> <span class="n">node_model_df</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">area_column</span> <span class="o">=</span> <span class="n">area_column</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">node_from_col</span> <span class="o">=</span> <span class="n">node_from_col</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">node_to_col</span> <span class="o">=</span> <span class="n">node_to_col</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">node_to_area_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_node_to_area_map</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_validate_inputs</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="mescal.energy_data_handling.area_accounting.border_variable_base.AreaBorderVariableCalculatorBase.get_border_lines_in_topological_up_and_down_direction" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_border_lines_in_topological_up_and_down_direction</span>


<a href="#mescal.energy_data_handling.area_accounting.border_variable_base.AreaBorderVariableCalculatorBase.get_border_lines_in_topological_up_and_down_direction" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_border_lines_in_topological_up_and_down_direction</span><span class="p">(</span><span class="n">border_id</span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="tuple">tuple</span></span><span class="p">[</span><span class="n"><span title="list">list</span></span><span class="p">[</span><span class="n"><span title="typing.Hashable">Hashable</span></span><span class="p">],</span> <span class="n"><span title="list">list</span></span><span class="p">[</span><span class="n"><span title="typing.Hashable">Hashable</span></span><span class="p">]]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get transmission lines for a border classified by topological direction.</p>
<p>This method identifies which transmission lines connect the two areas of a border
and classifies them based on their topological direction relative to the border.</p>
<p>Border directionality logic:
- "Up" direction: Lines where node_from is in area_from and node_to is in area_to
- "Down" direction: Lines where node_from is in area_to and node_to is in area_from</p>
<p>This classification is essential for correctly aggregating directional quantities
like power flows, where the sign and direction matter for market analysis.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>border_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Border identifier (e.g., 'DE-FR') that will be decomposed
into area_from and area_to using the naming convention.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="typing.Hashable">Hashable</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple containing two lists:</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="typing.Hashable">Hashable</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>lines_up: Line IDs for lines in the "up" direction</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<span title="list">list</span>[<span title="typing.Hashable">Hashable</span>], <span title="list">list</span>[<span title="typing.Hashable">Hashable</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>lines_down: Line IDs for lines in the "down" direction</li>
</ul>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Example:</p>
<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; # For border &#39;DE-FR&#39;
&gt;&gt;&gt; lines_up, lines_down = calculator.get_border_lines_in_topological_up_and_down_direction(&#39;DE-FR&#39;)
&gt;&gt;&gt; # lines_up: Lines from German nodes to French nodes  
&gt;&gt;&gt; # lines_down: Lines from French nodes to German nodes
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>submodules/mescal/mescal/energy_data_handling/area_accounting/border_variable_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_border_lines_in_topological_up_and_down_direction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">border_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">Hashable</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="n">Hashable</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get transmission lines for a border classified by topological direction.</span>

<span class="sd">    This method identifies which transmission lines connect the two areas of a border</span>
<span class="sd">    and classifies them based on their topological direction relative to the border.</span>

<span class="sd">    Border directionality logic:</span>
<span class="sd">    - &quot;Up&quot; direction: Lines where node_from is in area_from and node_to is in area_to</span>
<span class="sd">    - &quot;Down&quot; direction: Lines where node_from is in area_to and node_to is in area_from</span>

<span class="sd">    This classification is essential for correctly aggregating directional quantities</span>
<span class="sd">    like power flows, where the sign and direction matter for market analysis.</span>

<span class="sd">    Args:</span>
<span class="sd">        border_id: Border identifier (e.g., &#39;DE-FR&#39;) that will be decomposed</span>
<span class="sd">            into area_from and area_to using the naming convention.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple containing two lists:</span>
<span class="sd">        - lines_up: Line IDs for lines in the &quot;up&quot; direction</span>
<span class="sd">        - lines_down: Line IDs for lines in the &quot;down&quot; direction</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; # For border &#39;DE-FR&#39;</span>
<span class="sd">        &gt;&gt;&gt; lines_up, lines_down = calculator.get_border_lines_in_topological_up_and_down_direction(&#39;DE-FR&#39;)</span>
<span class="sd">        &gt;&gt;&gt; # lines_up: Lines from German nodes to French nodes  </span>
<span class="sd">        &gt;&gt;&gt; # lines_down: Lines from French nodes to German nodes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">area_from</span><span class="p">,</span> <span class="n">area_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decompose_area_border_name_to_areas</span><span class="p">(</span><span class="n">border_id</span><span class="p">)</span>
    <span class="n">nodes_in_area_from</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_model_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">node_model_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">area_column</span><span class="p">]</span> <span class="o">==</span> <span class="n">area_from</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
    <span class="n">nodes_in_area_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_model_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">node_model_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">area_column</span><span class="p">]</span> <span class="o">==</span> <span class="n">area_to</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
    <span class="n">lines_up</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_model_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line_model_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">node_from_col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">nodes_in_area_from</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_model_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">node_to_col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">nodes_in_area_to</span><span class="p">)</span>
        <span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
    <span class="n">lines_down</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_model_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line_model_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">node_from_col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">nodes_in_area_to</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_model_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">node_to_col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">nodes_in_area_from</span><span class="p">)</span>
        <span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">lines_up</span><span class="p">,</span> <span class="n">lines_down</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="mescal.energy_data_handling.area_accounting.border_variable_base.AreaBorderVariableCalculatorBase.calculate" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">calculate</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

<a href="#mescal.energy_data_handling.area_accounting.border_variable_base.AreaBorderVariableCalculatorBase.calculate" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">calculate</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="pandas.DataFrame">DataFrame</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Calculate the border variable. Must be implemented by subclasses.</p>
<p>This method should contain the specific logic for aggregating line-level
data to border level for the particular variable type. The implementation
will vary based on the variable (flows, capacities, prices, etc.) and
should handle directional aggregation appropriately.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Variable-specific parameters for the calculation</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame with border-level aggregated data. Index should be datetime</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>for time series data, columns should be border identifiers.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="NotImplementedError">NotImplementedError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>This is an abstract method</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>submodules/mescal/mescal/energy_data_handling/area_accounting/border_variable_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">calculate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the border variable. Must be implemented by subclasses.</span>

<span class="sd">    This method should contain the specific logic for aggregating line-level</span>
<span class="sd">    data to border level for the particular variable type. The implementation</span>
<span class="sd">    will vary based on the variable (flows, capacities, prices, etc.) and</span>
<span class="sd">    should handle directional aggregation appropriately.</span>

<span class="sd">    Args:</span>
<span class="sd">        **kwargs: Variable-specific parameters for the calculation</span>

<span class="sd">    Returns:</span>
<span class="sd">        DataFrame with border-level aggregated data. Index should be datetime</span>
<span class="sd">        for time series data, columns should be border identifiers.</span>

<span class="sd">    Raises:</span>
<span class="sd">        NotImplementedError: This is an abstract method</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">




    <div class="doc doc-contents first">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="mescal.energy_data_handling.area_accounting.border_variable_capacity_calculator.BorderCapacityCalculator" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">BorderCapacityCalculator</span>


<a href="#mescal.energy_data_handling.area_accounting.border_variable_capacity_calculator.BorderCapacityCalculator" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="            AreaBorderVariableCalculatorBase (mescal.energy_data_handling.area_accounting.border_variable_base.AreaBorderVariableCalculatorBase)" href="#mescal.energy_data_handling.area_accounting.border_variable_base.AreaBorderVariableCalculatorBase">AreaBorderVariableCalculatorBase</a></code></p>


        <p>Calculates aggregated transmission capacities for area borders.</p>
<p>This calculator aggregates line-level transmission capacities to border level,
handling bidirectional capacity data with proper directional aggregation.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; from mescal.energy_data_handling.network_lines_data import NetworkLineCapacitiesData
&gt;&gt;&gt; import pandas as pd
&gt;&gt;&gt; 
&gt;&gt;&gt; # Create capacity data
&gt;&gt;&gt; time_index = pd.date_range(&#39;2024-01-01&#39;, periods=24, freq=&#39;h&#39;)
&gt;&gt;&gt; capacities = NetworkLineCapacitiesData(
...     capacities_up=pd.DataFrame({...}),
...     capacities_down=pd.DataFrame({...})
... )
&gt;&gt;&gt; 
&gt;&gt;&gt; calculator = BorderCapacityCalculator(
...     area_border_model_df, line_model_df, node_model_df, &#39;country&#39;
... )
&gt;&gt;&gt; 
&gt;&gt;&gt; # Calculate capacities for up direction (area_from → area_to)
&gt;&gt;&gt; up_capacities = calculator.calculate(capacities, direction=&#39;up&#39;)
&gt;&gt;&gt; print(up_capacities)
</code></pre></div>








              <details class="quote">
                <summary>Source code in <code>submodules/mescal/mescal/energy_data_handling/area_accounting/border_variable_capacity_calculator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">BorderCapacityCalculator</span><span class="p">(</span><span class="n">AreaBorderVariableCalculatorBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculates aggregated transmission capacities for area borders.</span>

<span class="sd">    This calculator aggregates line-level transmission capacities to border level,</span>
<span class="sd">    handling bidirectional capacity data with proper directional aggregation.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from mescal.energy_data_handling.network_lines_data import NetworkLineCapacitiesData</span>
<span class="sd">        &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # Create capacity data</span>
<span class="sd">        &gt;&gt;&gt; time_index = pd.date_range(&#39;2024-01-01&#39;, periods=24, freq=&#39;h&#39;)</span>
<span class="sd">        &gt;&gt;&gt; capacities = NetworkLineCapacitiesData(</span>
<span class="sd">        ...     capacities_up=pd.DataFrame({...}),</span>
<span class="sd">        ...     capacities_down=pd.DataFrame({...})</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; calculator = BorderCapacityCalculator(</span>
<span class="sd">        ...     area_border_model_df, line_model_df, node_model_df, &#39;country&#39;</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # Calculate capacities for up direction (area_from → area_to)</span>
<span class="sd">        &gt;&gt;&gt; up_capacities = calculator.calculate(capacities, direction=&#39;up&#39;)</span>
<span class="sd">        &gt;&gt;&gt; print(up_capacities)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">variable_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;border_capacity&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">calculate</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">line_capacity_data</span><span class="p">:</span> <span class="n">NetworkLineCapacitiesData</span><span class="p">,</span>
            <span class="n">direction</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="s1">&#39;down&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;up&#39;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Aggregate line-level transmission capacities to border level.</span>

<span class="sd">        Sums transmission capacities of all lines belonging to each border,</span>
<span class="sd">        respecting the specified direction and handling bidirectional capacity data.</span>
<span class="sd">        Lines are aggregated based on their topological relationship to the border.</span>

<span class="sd">        Direction logic:</span>
<span class="sd">        - &#39;up&#39;: Capacities for flows from area_from to area_to</span>
<span class="sd">        - &#39;down&#39;: Capacities for flows from area_to to area_from</span>

<span class="sd">        For each border, the method:</span>
<span class="sd">        1. Identifies lines in &#39;up&#39; and &#39;down&#39; topological directions</span>
<span class="sd">        2. Selects appropriate capacity data based on requested direction</span>
<span class="sd">        3. Sums capacities across all border lines</span>
<span class="sd">        4. Handles missing data by excluding unavailable lines</span>

<span class="sd">        Args:</span>
<span class="sd">            line_capacity_data: NetworkLineCapacitiesData containing bidirectional</span>
<span class="sd">                capacity time series. Must include capacities_up and capacities_down</span>
<span class="sd">                DataFrames with line IDs as columns and timestamps as index.</span>
<span class="sd">            direction: Direction for capacity aggregation:</span>
<span class="sd">                - &#39;up&#39;: Sum capacities for area_from → area_to flows</span>
<span class="sd">                - &#39;down&#39;: Sum capacities for area_to → area_from flows</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataFrame with border-level capacity aggregations. Index matches the </span>
<span class="sd">            input capacity data, columns are border identifiers. Values represent</span>
<span class="sd">            total transmission capacity in MW for each border and timestamp.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If direction is not &#39;up&#39; or &#39;down&#39;</span>

<span class="sd">        Example:</span>

<span class="sd">            &gt;&gt;&gt; # Calculate up-direction capacities (exports from area_from)</span>
<span class="sd">            &gt;&gt;&gt; up_caps = calculator.calculate(capacity_data, direction=&#39;up&#39;)</span>
<span class="sd">            &gt;&gt;&gt; </span>
<span class="sd">            &gt;&gt;&gt; # Calculate down-direction capacities (imports to area_from)  </span>
<span class="sd">            &gt;&gt;&gt; down_caps = calculator.calculate(capacity_data, direction=&#39;down&#39;)</span>
<span class="sd">            &gt;&gt;&gt; </span>
<span class="sd">            &gt;&gt;&gt; print(f&quot;DE→FR capacity: {up_caps.loc[&#39;2024-01-01 12:00&#39;, &#39;DE-FR&#39;]:.0f} MW&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_time_series_data</span><span class="p">(</span><span class="n">line_capacity_data</span><span class="o">.</span><span class="n">capacities_up</span><span class="p">,</span> <span class="s2">&quot;capacities_up&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_time_series_data</span><span class="p">(</span><span class="n">line_capacity_data</span><span class="o">.</span><span class="n">capacities_down</span><span class="p">,</span> <span class="s2">&quot;capacities_down&quot;</span><span class="p">)</span>

        <span class="n">border_capacities</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">border_id</span><span class="p">,</span> <span class="n">border</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_border_model_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">lines_up</span><span class="p">,</span> <span class="n">lines_down</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_border_lines_in_topological_up_and_down_direction</span><span class="p">(</span><span class="n">border_id</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">lines_up</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">lines_down</span><span class="p">:</span>
                <span class="c1"># No lines found for this border - create empty series</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">line_capacity_data</span><span class="o">.</span><span class="n">capacities_up</span><span class="o">.</span><span class="n">index</span>
                <span class="n">border_capacities</span><span class="p">[</span><span class="n">border_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;up&#39;</span><span class="p">:</span>
                <span class="c1"># For &#39;up&#39; direction: use up capacities of lines_up + down capacities of lines_down</span>
                <span class="n">capacity_parts</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="n">lines_up</span><span class="p">:</span>
                    <span class="n">available_lines_up</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines_up</span> <span class="k">if</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_capacity_data</span><span class="o">.</span><span class="n">capacities_up</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">available_lines_up</span><span class="p">:</span>
                        <span class="n">capacity_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line_capacity_data</span><span class="o">.</span><span class="n">capacities_up</span><span class="p">[</span><span class="n">available_lines_up</span><span class="p">])</span>

                <span class="k">if</span> <span class="n">lines_down</span><span class="p">:</span>
                    <span class="n">available_lines_down</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines_down</span> <span class="k">if</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_capacity_data</span><span class="o">.</span><span class="n">capacities_down</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">available_lines_down</span><span class="p">:</span>
                        <span class="n">capacity_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line_capacity_data</span><span class="o">.</span><span class="n">capacities_down</span><span class="p">[</span><span class="n">available_lines_down</span><span class="p">])</span>

            <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;down&#39;</span><span class="p">:</span>
                <span class="c1"># For &#39;down&#39; direction: use down capacities of lines_up + up capacities of lines_down</span>
                <span class="n">capacity_parts</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="n">lines_up</span><span class="p">:</span>
                    <span class="n">available_lines_up</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines_up</span> <span class="k">if</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_capacity_data</span><span class="o">.</span><span class="n">capacities_down</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">available_lines_up</span><span class="p">:</span>
                        <span class="n">capacity_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line_capacity_data</span><span class="o">.</span><span class="n">capacities_down</span><span class="p">[</span><span class="n">available_lines_up</span><span class="p">])</span>

                <span class="k">if</span> <span class="n">lines_down</span><span class="p">:</span>
                    <span class="n">available_lines_down</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines_down</span> <span class="k">if</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_capacity_data</span><span class="o">.</span><span class="n">capacities_up</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">available_lines_down</span><span class="p">:</span>
                        <span class="n">capacity_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line_capacity_data</span><span class="o">.</span><span class="n">capacities_up</span><span class="p">[</span><span class="n">available_lines_down</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown capacity direction: </span><span class="si">{</span><span class="n">direction</span><span class="si">}</span><span class="s2">. Must be &#39;up&#39; or &#39;down&#39;&quot;</span><span class="p">)</span>

            <span class="c1"># Combine and sum capacities</span>
            <span class="k">if</span> <span class="n">capacity_parts</span><span class="p">:</span>
                <span class="n">all_capacities</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">capacity_parts</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">border_capacities</span><span class="p">[</span><span class="n">border_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_capacities</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># No capacity data available for any lines</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">line_capacity_data</span><span class="o">.</span><span class="n">capacities_up</span><span class="o">.</span><span class="n">index</span>
                <span class="n">border_capacities</span><span class="p">[</span><span class="n">border_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">border_capacities</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">border_identifier</span>
        <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="mescal.energy_data_handling.area_accounting.border_variable_capacity_calculator.BorderCapacityCalculator.calculate" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">calculate</span>


<a href="#mescal.energy_data_handling.area_accounting.border_variable_capacity_calculator.BorderCapacityCalculator.calculate" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">calculate</span><span class="p">(</span><span class="n">line_capacity_data</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            NetworkLineCapacitiesData


  
      dataclass
   (mescal.energy_data_handling.network_lines_data.NetworkLineCapacitiesData)" href="../../network_lines_data/#mescal.energy_data_handling.network_lines_data.NetworkLineCapacitiesData">NetworkLineCapacitiesData</a></span><span class="p">,</span> <span class="n">direction</span><span class="p">:</span> <span class="n"><span title="typing.Literal">Literal</span></span><span class="p">[</span><span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="s1">&#39;down&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;up&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="pandas.DataFrame">DataFrame</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Aggregate line-level transmission capacities to border level.</p>
<p>Sums transmission capacities of all lines belonging to each border,
respecting the specified direction and handling bidirectional capacity data.
Lines are aggregated based on their topological relationship to the border.</p>
<p>Direction logic:
- 'up': Capacities for flows from area_from to area_to
- 'down': Capacities for flows from area_to to area_from</p>
<p>For each border, the method:
1. Identifies lines in 'up' and 'down' topological directions
2. Selects appropriate capacity data based on requested direction
3. Sums capacities across all border lines
4. Handles missing data by excluding unavailable lines</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>line_capacity_data</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="            NetworkLineCapacitiesData


  
      dataclass
   (mescal.energy_data_handling.network_lines_data.NetworkLineCapacitiesData)" href="../../network_lines_data/#mescal.energy_data_handling.network_lines_data.NetworkLineCapacitiesData">NetworkLineCapacitiesData</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>NetworkLineCapacitiesData containing bidirectional
capacity time series. Must include capacities_up and capacities_down
DataFrames with line IDs as columns and timestamps as index.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>direction</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;up&#39;, &#39;down&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Direction for capacity aggregation:
- 'up': Sum capacities for area_from → area_to flows
- 'down': Sum capacities for area_to → area_from flows</p>
              </div>
            </td>
            <td>
                  <code>&#39;up&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame with border-level capacity aggregations. Index matches the </p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>input capacity data, columns are border identifiers. Values represent</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>total transmission capacity in MW for each border and timestamp.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If direction is not 'up' or 'down'</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Example:</p>
<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; # Calculate up-direction capacities (exports from area_from)
&gt;&gt;&gt; up_caps = calculator.calculate(capacity_data, direction=&#39;up&#39;)
&gt;&gt;&gt; 
&gt;&gt;&gt; # Calculate down-direction capacities (imports to area_from)  
&gt;&gt;&gt; down_caps = calculator.calculate(capacity_data, direction=&#39;down&#39;)
&gt;&gt;&gt; 
&gt;&gt;&gt; print(f&quot;DE→FR capacity: {up_caps.loc[&#39;2024-01-01 12:00&#39;, &#39;DE-FR&#39;]:.0f} MW&quot;)
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>submodules/mescal/mescal/energy_data_handling/area_accounting/border_variable_capacity_calculator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">line_capacity_data</span><span class="p">:</span> <span class="n">NetworkLineCapacitiesData</span><span class="p">,</span>
        <span class="n">direction</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="s1">&#39;down&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;up&#39;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Aggregate line-level transmission capacities to border level.</span>

<span class="sd">    Sums transmission capacities of all lines belonging to each border,</span>
<span class="sd">    respecting the specified direction and handling bidirectional capacity data.</span>
<span class="sd">    Lines are aggregated based on their topological relationship to the border.</span>

<span class="sd">    Direction logic:</span>
<span class="sd">    - &#39;up&#39;: Capacities for flows from area_from to area_to</span>
<span class="sd">    - &#39;down&#39;: Capacities for flows from area_to to area_from</span>

<span class="sd">    For each border, the method:</span>
<span class="sd">    1. Identifies lines in &#39;up&#39; and &#39;down&#39; topological directions</span>
<span class="sd">    2. Selects appropriate capacity data based on requested direction</span>
<span class="sd">    3. Sums capacities across all border lines</span>
<span class="sd">    4. Handles missing data by excluding unavailable lines</span>

<span class="sd">    Args:</span>
<span class="sd">        line_capacity_data: NetworkLineCapacitiesData containing bidirectional</span>
<span class="sd">            capacity time series. Must include capacities_up and capacities_down</span>
<span class="sd">            DataFrames with line IDs as columns and timestamps as index.</span>
<span class="sd">        direction: Direction for capacity aggregation:</span>
<span class="sd">            - &#39;up&#39;: Sum capacities for area_from → area_to flows</span>
<span class="sd">            - &#39;down&#39;: Sum capacities for area_to → area_from flows</span>

<span class="sd">    Returns:</span>
<span class="sd">        DataFrame with border-level capacity aggregations. Index matches the </span>
<span class="sd">        input capacity data, columns are border identifiers. Values represent</span>
<span class="sd">        total transmission capacity in MW for each border and timestamp.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If direction is not &#39;up&#39; or &#39;down&#39;</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; # Calculate up-direction capacities (exports from area_from)</span>
<span class="sd">        &gt;&gt;&gt; up_caps = calculator.calculate(capacity_data, direction=&#39;up&#39;)</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # Calculate down-direction capacities (imports to area_from)  </span>
<span class="sd">        &gt;&gt;&gt; down_caps = calculator.calculate(capacity_data, direction=&#39;down&#39;)</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; print(f&quot;DE→FR capacity: {up_caps.loc[&#39;2024-01-01 12:00&#39;, &#39;DE-FR&#39;]:.0f} MW&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_validate_time_series_data</span><span class="p">(</span><span class="n">line_capacity_data</span><span class="o">.</span><span class="n">capacities_up</span><span class="p">,</span> <span class="s2">&quot;capacities_up&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_validate_time_series_data</span><span class="p">(</span><span class="n">line_capacity_data</span><span class="o">.</span><span class="n">capacities_down</span><span class="p">,</span> <span class="s2">&quot;capacities_down&quot;</span><span class="p">)</span>

    <span class="n">border_capacities</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">border_id</span><span class="p">,</span> <span class="n">border</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_border_model_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">lines_up</span><span class="p">,</span> <span class="n">lines_down</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_border_lines_in_topological_up_and_down_direction</span><span class="p">(</span><span class="n">border_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">lines_up</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">lines_down</span><span class="p">:</span>
            <span class="c1"># No lines found for this border - create empty series</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">line_capacity_data</span><span class="o">.</span><span class="n">capacities_up</span><span class="o">.</span><span class="n">index</span>
            <span class="n">border_capacities</span><span class="p">[</span><span class="n">border_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;up&#39;</span><span class="p">:</span>
            <span class="c1"># For &#39;up&#39; direction: use up capacities of lines_up + down capacities of lines_down</span>
            <span class="n">capacity_parts</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">lines_up</span><span class="p">:</span>
                <span class="n">available_lines_up</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines_up</span> <span class="k">if</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_capacity_data</span><span class="o">.</span><span class="n">capacities_up</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">available_lines_up</span><span class="p">:</span>
                    <span class="n">capacity_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line_capacity_data</span><span class="o">.</span><span class="n">capacities_up</span><span class="p">[</span><span class="n">available_lines_up</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">lines_down</span><span class="p">:</span>
                <span class="n">available_lines_down</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines_down</span> <span class="k">if</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_capacity_data</span><span class="o">.</span><span class="n">capacities_down</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">available_lines_down</span><span class="p">:</span>
                    <span class="n">capacity_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line_capacity_data</span><span class="o">.</span><span class="n">capacities_down</span><span class="p">[</span><span class="n">available_lines_down</span><span class="p">])</span>

        <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;down&#39;</span><span class="p">:</span>
            <span class="c1"># For &#39;down&#39; direction: use down capacities of lines_up + up capacities of lines_down</span>
            <span class="n">capacity_parts</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">lines_up</span><span class="p">:</span>
                <span class="n">available_lines_up</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines_up</span> <span class="k">if</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_capacity_data</span><span class="o">.</span><span class="n">capacities_down</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">available_lines_up</span><span class="p">:</span>
                    <span class="n">capacity_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line_capacity_data</span><span class="o">.</span><span class="n">capacities_down</span><span class="p">[</span><span class="n">available_lines_up</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">lines_down</span><span class="p">:</span>
                <span class="n">available_lines_down</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines_down</span> <span class="k">if</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_capacity_data</span><span class="o">.</span><span class="n">capacities_up</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">available_lines_down</span><span class="p">:</span>
                    <span class="n">capacity_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line_capacity_data</span><span class="o">.</span><span class="n">capacities_up</span><span class="p">[</span><span class="n">available_lines_down</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown capacity direction: </span><span class="si">{</span><span class="n">direction</span><span class="si">}</span><span class="s2">. Must be &#39;up&#39; or &#39;down&#39;&quot;</span><span class="p">)</span>

        <span class="c1"># Combine and sum capacities</span>
        <span class="k">if</span> <span class="n">capacity_parts</span><span class="p">:</span>
            <span class="n">all_capacities</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">capacity_parts</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">border_capacities</span><span class="p">[</span><span class="n">border_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_capacities</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># No capacity data available for any lines</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">line_capacity_data</span><span class="o">.</span><span class="n">capacities_up</span><span class="o">.</span><span class="n">index</span>
            <span class="n">border_capacities</span><span class="p">[</span><span class="n">border_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">border_capacities</span><span class="p">)</span>
    <span class="n">result</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">border_identifier</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">




    <div class="doc doc-contents first">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="mescal.energy_data_handling.area_accounting.border_variable_flow_calculator.BorderFlowCalculator" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">BorderFlowCalculator</span>


<a href="#mescal.energy_data_handling.area_accounting.border_variable_flow_calculator.BorderFlowCalculator" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="            AreaBorderVariableCalculatorBase (mescal.energy_data_handling.area_accounting.border_variable_base.AreaBorderVariableCalculatorBase)" href="#mescal.energy_data_handling.area_accounting.border_variable_base.AreaBorderVariableCalculatorBase">AreaBorderVariableCalculatorBase</a></code></p>


        <p>Calculates aggregated power flows for area borders.</p>
<p>This calculator aggregates line-level power flows to border level, handling
bidirectional flow data and transmission losses.
The calculator can aggregate both sent and received flows, accounting for
transmission losses that occur between sending and receiving ends. It supports
multiple output formats including directional flows and net flows.</p>
<p>Flow aggregation logic:
- Lines and flows are classified as "up" or "down" based on topological direction
- Flows are aggregated respecting directionality and loss conventions
- Net flows represent the algebraic sum (up_flow - down_flow)</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; from mescal.energy_data_handling.network_lines_data import NetworkLineFlowsData
&gt;&gt;&gt; calculator = BorderFlowCalculator(
...     area_border_model_df, line_model_df, node_model_df, &#39;country&#39;
... )
&gt;&gt;&gt; # Calculate net sent flows (before losses)
&gt;&gt;&gt; net_flows = calculator.calculate(flow_data, flow_type=&#39;sent&#39;, direction=&#39;net&#39;)
&gt;&gt;&gt; print(net_flows)
</code></pre></div>








              <details class="quote">
                <summary>Source code in <code>submodules/mescal/mescal/energy_data_handling/area_accounting/border_variable_flow_calculator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">BorderFlowCalculator</span><span class="p">(</span><span class="n">AreaBorderVariableCalculatorBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculates aggregated power flows for area borders.</span>

<span class="sd">    This calculator aggregates line-level power flows to border level, handling</span>
<span class="sd">    bidirectional flow data and transmission losses.</span>
<span class="sd">    The calculator can aggregate both sent and received flows, accounting for</span>
<span class="sd">    transmission losses that occur between sending and receiving ends. It supports</span>
<span class="sd">    multiple output formats including directional flows and net flows.</span>

<span class="sd">    Flow aggregation logic:</span>
<span class="sd">    - Lines and flows are classified as &quot;up&quot; or &quot;down&quot; based on topological direction</span>
<span class="sd">    - Flows are aggregated respecting directionality and loss conventions</span>
<span class="sd">    - Net flows represent the algebraic sum (up_flow - down_flow)</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; from mescal.energy_data_handling.network_lines_data import NetworkLineFlowsData</span>
<span class="sd">        &gt;&gt;&gt; calculator = BorderFlowCalculator(</span>
<span class="sd">        ...     area_border_model_df, line_model_df, node_model_df, &#39;country&#39;</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; # Calculate net sent flows (before losses)</span>
<span class="sd">        &gt;&gt;&gt; net_flows = calculator.calculate(flow_data, flow_type=&#39;sent&#39;, direction=&#39;net&#39;)</span>
<span class="sd">        &gt;&gt;&gt; print(net_flows)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">variable_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;border_flow&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">calculate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">line_flow_data</span><span class="p">:</span> <span class="n">NetworkLineFlowsData</span><span class="p">,</span>
        <span class="n">flow_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;sent&#39;</span><span class="p">,</span> <span class="s1">&#39;received&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;sent&#39;</span><span class="p">,</span>
        <span class="n">direction</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="s1">&#39;down&#39;</span><span class="p">,</span> <span class="s1">&#39;net&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;net&#39;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Aggregate line-level power flows to border level.</span>

<span class="sd">        Sums power flows of all lines belonging to each border, respecting flow</span>
<span class="sd">        directionality and transmission loss conventions. The aggregation handles</span>
<span class="sd">        both pre-loss (sent) and post-loss (received) flows.</span>

<span class="sd">        Flow type selection:</span>
<span class="sd">        - &#39;sent&#39;: Flows before transmission losses (injected into lines)  </span>
<span class="sd">        - &#39;received&#39;: Flows after transmission losses (withdrawn from lines)</span>

<span class="sd">        Direction options:</span>
<span class="sd">        - &#39;up&#39;: Flows from area_from to area_to only</span>
<span class="sd">        - &#39;down&#39;: Flows from area_to to area_from only</span>
<span class="sd">        - &#39;net&#39;: Net flows (up - down), positive means net export from area_from</span>

<span class="sd">        The method handles missing data by preserving NaN values when all </span>
<span class="sd">        constituent flows are missing for a given timestamp.</span>

<span class="sd">        Args:</span>
<span class="sd">            line_flow_data: NetworkLineFlowsData containing bidirectional flow</span>
<span class="sd">                time series. Must include sent_up, received_up, sent_down, and</span>
<span class="sd">                received_down DataFrames with line IDs as columns.</span>
<span class="sd">            flow_type: Type of flows to aggregate:</span>
<span class="sd">                - &#39;sent&#39;: Pre-loss flows (power injected into transmission)</span>
<span class="sd">                - &#39;received&#39;: Post-loss flows (power withdrawn after losses)</span>
<span class="sd">            direction: Flow direction to calculate:</span>
<span class="sd">                - &#39;up&#39;: Flows from area_from → area_to</span>
<span class="sd">                - &#39;down&#39;: Flows from area_to → area_from  </span>
<span class="sd">                - &#39;net&#39;: Net flows (up - down)</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataFrame with border-level flow aggregations. Index matches input</span>
<span class="sd">            flow data, columns are border identifiers. Values represent power</span>
<span class="sd">            flows in MW. For net flows, positive values indicate net export</span>
<span class="sd">            from area_from to area_to.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If flow_type not in [&#39;sent&#39;, &#39;received&#39;] or direction</span>
<span class="sd">                not in [&#39;up&#39;, &#39;down&#39;, &#39;net&#39;]</span>

<span class="sd">        Example:</span>

<span class="sd">            &gt;&gt;&gt; # Calculate net sent flows (most common use case)</span>
<span class="sd">            &gt;&gt;&gt; net_sent = calculator.calculate(flows, &#39;sent&#39;, &#39;net&#39;)</span>
<span class="sd">            &gt;&gt;&gt; </span>
<span class="sd">            &gt;&gt;&gt; # Calculate received flows in up direction only</span>
<span class="sd">            &gt;&gt;&gt; up_received = calculator.calculate(flows, &#39;received&#39;, &#39;up&#39;)</span>
<span class="sd">            &gt;&gt;&gt; </span>
<span class="sd">            &gt;&gt;&gt; print(f&quot;DE→FR net flow: {net_sent.loc[&#39;2024-01-01 12:00&#39;, &#39;DE-FR&#39;]:.0f} MW&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Validate inputs</span>
        <span class="k">if</span> <span class="n">flow_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;sent&#39;</span><span class="p">,</span> <span class="s1">&#39;received&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown flow_type: </span><span class="si">{</span><span class="n">flow_type</span><span class="si">}</span><span class="s2">. Must be &#39;sent&#39; or &#39;received&#39;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">direction</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="s1">&#39;down&#39;</span><span class="p">,</span> <span class="s1">&#39;net&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown flow direction: </span><span class="si">{</span><span class="n">direction</span><span class="si">}</span><span class="s2">. Must be &#39;up&#39;, &#39;down&#39;, or &#39;net&#39;&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_time_series_data</span><span class="p">(</span><span class="n">line_flow_data</span><span class="o">.</span><span class="n">sent_up</span><span class="p">,</span> <span class="s2">&quot;sent_up&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_time_series_data</span><span class="p">(</span><span class="n">line_flow_data</span><span class="o">.</span><span class="n">received_up</span><span class="p">,</span> <span class="s2">&quot;received_up&quot;</span><span class="p">)</span>

        <span class="n">border_flows</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">border_id</span><span class="p">,</span> <span class="n">border</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_border_model_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">lines_up</span><span class="p">,</span> <span class="n">lines_down</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_border_lines_in_topological_up_and_down_direction</span><span class="p">(</span><span class="n">border_id</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">lines_up</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">lines_down</span><span class="p">:</span>
                <span class="c1"># No lines for this border - create empty series</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">line_flow_data</span><span class="o">.</span><span class="n">sent_up</span><span class="o">.</span><span class="n">index</span>
                <span class="n">border_flows</span><span class="p">[</span><span class="n">border_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="c1"># Select appropriate flow data based on flow_type</span>
            <span class="k">if</span> <span class="n">flow_type</span> <span class="o">==</span> <span class="s1">&#39;sent&#39;</span><span class="p">:</span>
                <span class="n">flow_data_up</span> <span class="o">=</span> <span class="n">line_flow_data</span><span class="o">.</span><span class="n">sent_up</span>
                <span class="n">flow_data_down</span> <span class="o">=</span> <span class="n">line_flow_data</span><span class="o">.</span><span class="n">sent_down</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># flow_type == &#39;received&#39;</span>
                <span class="n">flow_data_up</span> <span class="o">=</span> <span class="n">line_flow_data</span><span class="o">.</span><span class="n">received_up</span>  
                <span class="n">flow_data_down</span> <span class="o">=</span> <span class="n">line_flow_data</span><span class="o">.</span><span class="n">received_down</span>

            <span class="c1"># Aggregate flows by direction relative to border</span>
            <span class="n">flow_parts_up</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">flow_parts_down</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">if</span> <span class="n">lines_up</span><span class="p">:</span>
                <span class="c1"># Lines in topological &quot;up&quot; direction</span>
                <span class="n">available_lines_up</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines_up</span> <span class="k">if</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">flow_data_up</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">available_lines_up</span><span class="p">:</span>
                    <span class="n">flow_parts_up</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">flow_data_up</span><span class="p">[</span><span class="n">available_lines_up</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">lines_down</span><span class="p">:</span>  
                <span class="c1"># Lines in topological &quot;down&quot; direction contribute to opposite border flow</span>
                <span class="n">available_lines_down</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines_down</span> <span class="k">if</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">flow_data_down</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">available_lines_down</span><span class="p">:</span>
                    <span class="n">flow_parts_up</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">flow_data_down</span><span class="p">[</span><span class="n">available_lines_down</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">lines_down</span><span class="p">:</span>
                <span class="c1"># Lines in topological &quot;down&quot; direction  </span>
                <span class="n">available_lines_down</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines_down</span> <span class="k">if</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">flow_data_up</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">available_lines_down</span><span class="p">:</span>
                    <span class="n">flow_parts_down</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">flow_data_up</span><span class="p">[</span><span class="n">available_lines_down</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">lines_up</span><span class="p">:</span>
                <span class="c1"># Lines in topological &quot;up&quot; direction contribute to opposite border flow</span>
                <span class="n">available_lines_up</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines_up</span> <span class="k">if</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">flow_data_down</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">available_lines_up</span><span class="p">:</span>
                    <span class="n">flow_parts_down</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">flow_data_down</span><span class="p">[</span><span class="n">available_lines_up</span><span class="p">])</span>

            <span class="c1"># Sum flows for each direction</span>
            <span class="k">if</span> <span class="n">flow_parts_up</span><span class="p">:</span>
                <span class="n">flows_up_combined</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">flow_parts_up</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">flow_up</span> <span class="o">=</span> <span class="n">flows_up_combined</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">flow_up</span><span class="p">[</span><span class="n">flows_up_combined</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flow_up</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">line_flow_data</span><span class="o">.</span><span class="n">sent_up</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">flow_parts_down</span><span class="p">:</span>
                <span class="n">flows_down_combined</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">flow_parts_down</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  
                <span class="n">flow_down</span> <span class="o">=</span> <span class="n">flows_down_combined</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">flow_down</span><span class="p">[</span><span class="n">flows_down_combined</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flow_down</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">line_flow_data</span><span class="o">.</span><span class="n">sent_up</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

            <span class="c1"># Select final output based on direction parameter</span>
            <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;up&#39;</span><span class="p">:</span>
                <span class="n">border_flows</span><span class="p">[</span><span class="n">border_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">flow_up</span>
            <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;down&#39;</span><span class="p">:</span>
                <span class="n">border_flows</span><span class="p">[</span><span class="n">border_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">flow_down</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># direction == &#39;net&#39;</span>
                <span class="n">flow_net</span> <span class="o">=</span> <span class="n">flow_up</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">flow_down</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="c1"># Preserve NaN when both directions are NaN</span>
                <span class="n">flow_net</span><span class="p">[</span><span class="n">flow_up</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">flow_down</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="n">border_flows</span><span class="p">[</span><span class="n">border_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">flow_net</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">border_flows</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">border_identifier</span>
        <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="mescal.energy_data_handling.area_accounting.border_variable_flow_calculator.BorderFlowCalculator.calculate" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">calculate</span>


<a href="#mescal.energy_data_handling.area_accounting.border_variable_flow_calculator.BorderFlowCalculator.calculate" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">calculate</span><span class="p">(</span><span class="n">line_flow_data</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            NetworkLineFlowsData (mescal.energy_data_handling.network_lines_data.NetworkLineFlowsData)" href="../../network_lines_data/#mescal.energy_data_handling.network_lines_data.NetworkLineFlowsData">NetworkLineFlowsData</a></span><span class="p">,</span> <span class="n">flow_type</span><span class="p">:</span> <span class="n"><span title="typing.Literal">Literal</span></span><span class="p">[</span><span class="s1">&#39;sent&#39;</span><span class="p">,</span> <span class="s1">&#39;received&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;sent&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="p">:</span> <span class="n"><span title="typing.Literal">Literal</span></span><span class="p">[</span><span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="s1">&#39;down&#39;</span><span class="p">,</span> <span class="s1">&#39;net&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;net&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="pandas.DataFrame">DataFrame</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Aggregate line-level power flows to border level.</p>
<p>Sums power flows of all lines belonging to each border, respecting flow
directionality and transmission loss conventions. The aggregation handles
both pre-loss (sent) and post-loss (received) flows.</p>
<p>Flow type selection:
- 'sent': Flows before transmission losses (injected into lines)<br />
- 'received': Flows after transmission losses (withdrawn from lines)</p>
<p>Direction options:
- 'up': Flows from area_from to area_to only
- 'down': Flows from area_to to area_from only
- 'net': Net flows (up - down), positive means net export from area_from</p>
<p>The method handles missing data by preserving NaN values when all 
constituent flows are missing for a given timestamp.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>line_flow_data</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="            NetworkLineFlowsData (mescal.energy_data_handling.network_lines_data.NetworkLineFlowsData)" href="../../network_lines_data/#mescal.energy_data_handling.network_lines_data.NetworkLineFlowsData">NetworkLineFlowsData</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>NetworkLineFlowsData containing bidirectional flow
time series. Must include sent_up, received_up, sent_down, and
received_down DataFrames with line IDs as columns.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>flow_type</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;sent&#39;, &#39;received&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of flows to aggregate:
- 'sent': Pre-loss flows (power injected into transmission)
- 'received': Post-loss flows (power withdrawn after losses)</p>
              </div>
            </td>
            <td>
                  <code>&#39;sent&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>direction</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;up&#39;, &#39;down&#39;, &#39;net&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flow direction to calculate:
- 'up': Flows from area_from → area_to
- 'down': Flows from area_to → area_from<br />
- 'net': Net flows (up - down)</p>
              </div>
            </td>
            <td>
                  <code>&#39;net&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame with border-level flow aggregations. Index matches input</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>flow data, columns are border identifiers. Values represent power</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>flows in MW. For net flows, positive values indicate net export</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>from area_from to area_to.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If flow_type not in ['sent', 'received'] or direction
not in ['up', 'down', 'net']</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Example:</p>
<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; # Calculate net sent flows (most common use case)
&gt;&gt;&gt; net_sent = calculator.calculate(flows, &#39;sent&#39;, &#39;net&#39;)
&gt;&gt;&gt; 
&gt;&gt;&gt; # Calculate received flows in up direction only
&gt;&gt;&gt; up_received = calculator.calculate(flows, &#39;received&#39;, &#39;up&#39;)
&gt;&gt;&gt; 
&gt;&gt;&gt; print(f&quot;DE→FR net flow: {net_sent.loc[&#39;2024-01-01 12:00&#39;, &#39;DE-FR&#39;]:.0f} MW&quot;)
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>submodules/mescal/mescal/energy_data_handling/area_accounting/border_variable_flow_calculator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">line_flow_data</span><span class="p">:</span> <span class="n">NetworkLineFlowsData</span><span class="p">,</span>
    <span class="n">flow_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;sent&#39;</span><span class="p">,</span> <span class="s1">&#39;received&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;sent&#39;</span><span class="p">,</span>
    <span class="n">direction</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="s1">&#39;down&#39;</span><span class="p">,</span> <span class="s1">&#39;net&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;net&#39;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Aggregate line-level power flows to border level.</span>

<span class="sd">    Sums power flows of all lines belonging to each border, respecting flow</span>
<span class="sd">    directionality and transmission loss conventions. The aggregation handles</span>
<span class="sd">    both pre-loss (sent) and post-loss (received) flows.</span>

<span class="sd">    Flow type selection:</span>
<span class="sd">    - &#39;sent&#39;: Flows before transmission losses (injected into lines)  </span>
<span class="sd">    - &#39;received&#39;: Flows after transmission losses (withdrawn from lines)</span>

<span class="sd">    Direction options:</span>
<span class="sd">    - &#39;up&#39;: Flows from area_from to area_to only</span>
<span class="sd">    - &#39;down&#39;: Flows from area_to to area_from only</span>
<span class="sd">    - &#39;net&#39;: Net flows (up - down), positive means net export from area_from</span>

<span class="sd">    The method handles missing data by preserving NaN values when all </span>
<span class="sd">    constituent flows are missing for a given timestamp.</span>

<span class="sd">    Args:</span>
<span class="sd">        line_flow_data: NetworkLineFlowsData containing bidirectional flow</span>
<span class="sd">            time series. Must include sent_up, received_up, sent_down, and</span>
<span class="sd">            received_down DataFrames with line IDs as columns.</span>
<span class="sd">        flow_type: Type of flows to aggregate:</span>
<span class="sd">            - &#39;sent&#39;: Pre-loss flows (power injected into transmission)</span>
<span class="sd">            - &#39;received&#39;: Post-loss flows (power withdrawn after losses)</span>
<span class="sd">        direction: Flow direction to calculate:</span>
<span class="sd">            - &#39;up&#39;: Flows from area_from → area_to</span>
<span class="sd">            - &#39;down&#39;: Flows from area_to → area_from  </span>
<span class="sd">            - &#39;net&#39;: Net flows (up - down)</span>

<span class="sd">    Returns:</span>
<span class="sd">        DataFrame with border-level flow aggregations. Index matches input</span>
<span class="sd">        flow data, columns are border identifiers. Values represent power</span>
<span class="sd">        flows in MW. For net flows, positive values indicate net export</span>
<span class="sd">        from area_from to area_to.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If flow_type not in [&#39;sent&#39;, &#39;received&#39;] or direction</span>
<span class="sd">            not in [&#39;up&#39;, &#39;down&#39;, &#39;net&#39;]</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; # Calculate net sent flows (most common use case)</span>
<span class="sd">        &gt;&gt;&gt; net_sent = calculator.calculate(flows, &#39;sent&#39;, &#39;net&#39;)</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # Calculate received flows in up direction only</span>
<span class="sd">        &gt;&gt;&gt; up_received = calculator.calculate(flows, &#39;received&#39;, &#39;up&#39;)</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; print(f&quot;DE→FR net flow: {net_sent.loc[&#39;2024-01-01 12:00&#39;, &#39;DE-FR&#39;]:.0f} MW&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Validate inputs</span>
    <span class="k">if</span> <span class="n">flow_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;sent&#39;</span><span class="p">,</span> <span class="s1">&#39;received&#39;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown flow_type: </span><span class="si">{</span><span class="n">flow_type</span><span class="si">}</span><span class="s2">. Must be &#39;sent&#39; or &#39;received&#39;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">direction</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="s1">&#39;down&#39;</span><span class="p">,</span> <span class="s1">&#39;net&#39;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown flow direction: </span><span class="si">{</span><span class="n">direction</span><span class="si">}</span><span class="s2">. Must be &#39;up&#39;, &#39;down&#39;, or &#39;net&#39;&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_validate_time_series_data</span><span class="p">(</span><span class="n">line_flow_data</span><span class="o">.</span><span class="n">sent_up</span><span class="p">,</span> <span class="s2">&quot;sent_up&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_validate_time_series_data</span><span class="p">(</span><span class="n">line_flow_data</span><span class="o">.</span><span class="n">received_up</span><span class="p">,</span> <span class="s2">&quot;received_up&quot;</span><span class="p">)</span>

    <span class="n">border_flows</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">border_id</span><span class="p">,</span> <span class="n">border</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_border_model_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">lines_up</span><span class="p">,</span> <span class="n">lines_down</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_border_lines_in_topological_up_and_down_direction</span><span class="p">(</span><span class="n">border_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">lines_up</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">lines_down</span><span class="p">:</span>
            <span class="c1"># No lines for this border - create empty series</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">line_flow_data</span><span class="o">.</span><span class="n">sent_up</span><span class="o">.</span><span class="n">index</span>
            <span class="n">border_flows</span><span class="p">[</span><span class="n">border_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="c1"># Select appropriate flow data based on flow_type</span>
        <span class="k">if</span> <span class="n">flow_type</span> <span class="o">==</span> <span class="s1">&#39;sent&#39;</span><span class="p">:</span>
            <span class="n">flow_data_up</span> <span class="o">=</span> <span class="n">line_flow_data</span><span class="o">.</span><span class="n">sent_up</span>
            <span class="n">flow_data_down</span> <span class="o">=</span> <span class="n">line_flow_data</span><span class="o">.</span><span class="n">sent_down</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># flow_type == &#39;received&#39;</span>
            <span class="n">flow_data_up</span> <span class="o">=</span> <span class="n">line_flow_data</span><span class="o">.</span><span class="n">received_up</span>  
            <span class="n">flow_data_down</span> <span class="o">=</span> <span class="n">line_flow_data</span><span class="o">.</span><span class="n">received_down</span>

        <span class="c1"># Aggregate flows by direction relative to border</span>
        <span class="n">flow_parts_up</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">flow_parts_down</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">lines_up</span><span class="p">:</span>
            <span class="c1"># Lines in topological &quot;up&quot; direction</span>
            <span class="n">available_lines_up</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines_up</span> <span class="k">if</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">flow_data_up</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">available_lines_up</span><span class="p">:</span>
                <span class="n">flow_parts_up</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">flow_data_up</span><span class="p">[</span><span class="n">available_lines_up</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">lines_down</span><span class="p">:</span>  
            <span class="c1"># Lines in topological &quot;down&quot; direction contribute to opposite border flow</span>
            <span class="n">available_lines_down</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines_down</span> <span class="k">if</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">flow_data_down</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">available_lines_down</span><span class="p">:</span>
                <span class="n">flow_parts_up</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">flow_data_down</span><span class="p">[</span><span class="n">available_lines_down</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">lines_down</span><span class="p">:</span>
            <span class="c1"># Lines in topological &quot;down&quot; direction  </span>
            <span class="n">available_lines_down</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines_down</span> <span class="k">if</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">flow_data_up</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">available_lines_down</span><span class="p">:</span>
                <span class="n">flow_parts_down</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">flow_data_up</span><span class="p">[</span><span class="n">available_lines_down</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">lines_up</span><span class="p">:</span>
            <span class="c1"># Lines in topological &quot;up&quot; direction contribute to opposite border flow</span>
            <span class="n">available_lines_up</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines_up</span> <span class="k">if</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">flow_data_down</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">available_lines_up</span><span class="p">:</span>
                <span class="n">flow_parts_down</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">flow_data_down</span><span class="p">[</span><span class="n">available_lines_up</span><span class="p">])</span>

        <span class="c1"># Sum flows for each direction</span>
        <span class="k">if</span> <span class="n">flow_parts_up</span><span class="p">:</span>
            <span class="n">flows_up_combined</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">flow_parts_up</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">flow_up</span> <span class="o">=</span> <span class="n">flows_up_combined</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">flow_up</span><span class="p">[</span><span class="n">flows_up_combined</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flow_up</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">line_flow_data</span><span class="o">.</span><span class="n">sent_up</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">flow_parts_down</span><span class="p">:</span>
            <span class="n">flows_down_combined</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">flow_parts_down</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  
            <span class="n">flow_down</span> <span class="o">=</span> <span class="n">flows_down_combined</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">flow_down</span><span class="p">[</span><span class="n">flows_down_combined</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flow_down</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">line_flow_data</span><span class="o">.</span><span class="n">sent_up</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="c1"># Select final output based on direction parameter</span>
        <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;up&#39;</span><span class="p">:</span>
            <span class="n">border_flows</span><span class="p">[</span><span class="n">border_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">flow_up</span>
        <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;down&#39;</span><span class="p">:</span>
            <span class="n">border_flows</span><span class="p">[</span><span class="n">border_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">flow_down</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># direction == &#39;net&#39;</span>
            <span class="n">flow_net</span> <span class="o">=</span> <span class="n">flow_up</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">flow_down</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="c1"># Preserve NaN when both directions are NaN</span>
            <span class="n">flow_net</span><span class="p">[</span><span class="n">flow_up</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">flow_down</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="n">border_flows</span><span class="p">[</span><span class="n">border_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">flow_net</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">border_flows</span><span class="p">)</span>
    <span class="n">result</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">border_identifier</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">




    <div class="doc doc-contents first">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="mescal.energy_data_handling.area_accounting.border_variable_price_spread_calculator.BorderPriceSpreadCalculator" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">BorderPriceSpreadCalculator</span>


<a href="#mescal.energy_data_handling.area_accounting.border_variable_price_spread_calculator.BorderPriceSpreadCalculator" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="            AreaBorderVariableCalculatorBase (mescal.energy_data_handling.area_accounting.border_variable_base.AreaBorderVariableCalculatorBase)" href="#mescal.energy_data_handling.area_accounting.border_variable_base.AreaBorderVariableCalculatorBase">AreaBorderVariableCalculatorBase</a></code></p>


        <p>Calculates electricity price spreads between areas for each border.</p>
<p>This calculator computes price differences between connected areas.
Price spreads are fundamental indicators in electricity markets for:
- Market integration analysis (zero spreads indicate perfect coupling)
- Congestion identification (non-zero spreads suggest transmission constraints)
- Arbitrage opportunity assessment (price differences drive trading incentives)
- Market efficiency evaluation (persistent spreads may indicate inefficiencies)
- Cross-border flow direction prediction (flows typically follow price gradients)</p>
<p>The calculator supports multiple spread calculation methods (Spread Types):
- 'raw': price_to - price_from (preserves direction and sign)
- 'absolute': |price_to - price_from| (magnitude only)
- 'directional_up': max(price_to - price_from, 0) (only positive spreads)
- 'directional_down': max(price_from - price_to, 0) (only negative spreads as positive)</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="mescal.energy_data_handling.area_accounting.border_variable_price_spread_calculator.BorderPriceSpreadCalculator.variable_name">variable_name</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Returns 'price_spread' for identification</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Example:</p>
<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; import pandas as pd
&gt;&gt;&gt; import numpy as np
&gt;&gt;&gt;
&gt;&gt;&gt; # Create sample area price data
&gt;&gt;&gt; time_index = pd.date_range(&#39;2024-01-01&#39;, periods=24, freq=&#39;h&#39;)
&gt;&gt;&gt; area_prices = pd.DataFrame({
...     &#39;DE&#39;: np.random.uniform(40, 80, 24),  # German prices
...     &#39;FR&#39;: np.random.uniform(35, 75, 24),  # French prices
...     &#39;BE&#39;: np.random.uniform(45, 85, 24)   # Belgian prices
... }, index=time_index)
&gt;&gt;&gt;
&gt;&gt;&gt; # Set up border model and calculator (see base class docs for setup)
&gt;&gt;&gt; calculator = BorderPriceSpreadCalculator(
...     border_model_df, line_model_df, node_model_df, &#39;country&#39;
... )
&gt;&gt;&gt;
&gt;&gt;&gt; # Calculate raw price spreads
&gt;&gt;&gt; raw_spreads = calculator.calculate(area_prices, spread_type=&#39;raw&#39;)
&gt;&gt;&gt; print(f&quot;Average spread DE-FR: {raw_spreads[&#39;DE-FR&#39;].mean():.2f} EUR/MWh&quot;)
&gt;&gt;&gt;
&gt;&gt;&gt; # Calculate all spread types at once
&gt;&gt;&gt; all_spreads = calculator.calculate_all_spread_types(area_prices)
&gt;&gt;&gt; print(all_spreads.head())
</code></pre></div>








              <details class="quote">
                <summary>Source code in <code>submodules/mescal/mescal/energy_data_handling/area_accounting/border_variable_price_spread_calculator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">BorderPriceSpreadCalculator</span><span class="p">(</span><span class="n">AreaBorderVariableCalculatorBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculates electricity price spreads between areas for each border.</span>

<span class="sd">    This calculator computes price differences between connected areas.</span>
<span class="sd">    Price spreads are fundamental indicators in electricity markets for:</span>
<span class="sd">    - Market integration analysis (zero spreads indicate perfect coupling)</span>
<span class="sd">    - Congestion identification (non-zero spreads suggest transmission constraints)</span>
<span class="sd">    - Arbitrage opportunity assessment (price differences drive trading incentives)</span>
<span class="sd">    - Market efficiency evaluation (persistent spreads may indicate inefficiencies)</span>
<span class="sd">    - Cross-border flow direction prediction (flows typically follow price gradients)</span>

<span class="sd">    The calculator supports multiple spread calculation methods (Spread Types):</span>
<span class="sd">    - &#39;raw&#39;: price_to - price_from (preserves direction and sign)</span>
<span class="sd">    - &#39;absolute&#39;: |price_to - price_from| (magnitude only)</span>
<span class="sd">    - &#39;directional_up&#39;: max(price_to - price_from, 0) (only positive spreads)</span>
<span class="sd">    - &#39;directional_down&#39;: max(price_from - price_to, 0) (only negative spreads as positive)</span>

<span class="sd">    Attributes:</span>
<span class="sd">        variable_name (str): Returns &#39;price_spread&#39; for identification</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Create sample area price data</span>
<span class="sd">        &gt;&gt;&gt; time_index = pd.date_range(&#39;2024-01-01&#39;, periods=24, freq=&#39;h&#39;)</span>
<span class="sd">        &gt;&gt;&gt; area_prices = pd.DataFrame({</span>
<span class="sd">        ...     &#39;DE&#39;: np.random.uniform(40, 80, 24),  # German prices</span>
<span class="sd">        ...     &#39;FR&#39;: np.random.uniform(35, 75, 24),  # French prices</span>
<span class="sd">        ...     &#39;BE&#39;: np.random.uniform(45, 85, 24)   # Belgian prices</span>
<span class="sd">        ... }, index=time_index)</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Set up border model and calculator (see base class docs for setup)</span>
<span class="sd">        &gt;&gt;&gt; calculator = BorderPriceSpreadCalculator(</span>
<span class="sd">        ...     border_model_df, line_model_df, node_model_df, &#39;country&#39;</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Calculate raw price spreads</span>
<span class="sd">        &gt;&gt;&gt; raw_spreads = calculator.calculate(area_prices, spread_type=&#39;raw&#39;)</span>
<span class="sd">        &gt;&gt;&gt; print(f&quot;Average spread DE-FR: {raw_spreads[&#39;DE-FR&#39;].mean():.2f} EUR/MWh&quot;)</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Calculate all spread types at once</span>
<span class="sd">        &gt;&gt;&gt; all_spreads = calculator.calculate_all_spread_types(area_prices)</span>
<span class="sd">        &gt;&gt;&gt; print(all_spreads.head())</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">variable_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;price_spread&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">calculate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">area_price_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">spread_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;raw&#39;</span><span class="p">,</span> <span class="s1">&#39;absolute&#39;</span><span class="p">,</span> <span class="s1">&#39;directional_up&#39;</span><span class="p">,</span> <span class="s1">&#39;directional_down&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;raw&#39;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate electricity price spreads between connected market areas.</span>

<span class="sd">        Computes price differences across transmission borders using the specified</span>
<span class="sd">        calculation method. Price spreads are calculated as directional differences</span>
<span class="sd">        based on the border naming convention (area_from → area_to).</span>

<span class="sd">        The calculation handles missing area data gracefully by excluding borders</span>
<span class="sd">        where either area lacks price data. This is common when analyzing subsets</span>
<span class="sd">        of larger energy systems or when dealing with data availability issues.</span>

<span class="sd">        Args:</span>
<span class="sd">            area_price_df (pd.DataFrame): Time series of area-level electricity prices.</span>
<span class="sd">                - Index: DateTime index for time series analysis</span>
<span class="sd">                - Columns: Area identifiers matching border area names</span>
<span class="sd">                - Values: Prices in consistent units (e.g., EUR/MWh, USD/MWh)</span>
<span class="sd">                - Example shape: (8760 hours, N areas) for annual analysis</span>

<span class="sd">            spread_type (Literal): Method for calculating price spreads.</span>
<span class="sd">                - &#39;raw&#39;: Directional price differences (default, preserves sign)</span>
<span class="sd">                - &#39;absolute&#39;: Magnitude of price differences (always non-negative)</span>
<span class="sd">                - &#39;directional_up&#39;: Only spreads where price_to &gt; price_from</span>
<span class="sd">                - &#39;directional_down&#39;: Only spreads where price_from &gt; price_to</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: Border-level price spreads with temporal dimension.</span>
<span class="sd">                - Index: Same as input area_price_df (typically DatetimeIndex)</span>
<span class="sd">                - Columns: Border identifiers (e.g., &#39;DE-FR&#39;, &#39;FR-BE&#39;)</span>
<span class="sd">                - Column name: Set to self.border_identifier for consistency</span>
<span class="sd">                - Values: Price spreads in same units as input prices</span>
<span class="sd">                - Missing data: NaN where area price data is unavailable</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If spread_type is not one of the supported options</span>

<span class="sd">        Example:</span>

<span class="sd">            &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">            &gt;&gt;&gt; import numpy as np</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Create hourly price data for German and French markets</span>
<span class="sd">            &gt;&gt;&gt; time_index = pd.date_range(&#39;2024-01-01&#39;, periods=24, freq=&#39;h&#39;)</span>
<span class="sd">            &gt;&gt;&gt; prices = pd.DataFrame({</span>
<span class="sd">            ...     &#39;DE&#39;: [45.2, 43.1, 41.8, 39.5, 38.2, 42.1, 52.3, 65.4,</span>
<span class="sd">            ...            72.1, 68.9, 64.2, 58.7, 55.1, 53.8, 56.2, 61.4,</span>
<span class="sd">            ...            67.8, 74.2, 69.1, 64.3, 58.9, 52.1, 48.7, 46.3],</span>
<span class="sd">            ...     &#39;FR&#39;: [42.8, 41.2, 39.1, 37.8, 36.4, 40.3, 49.8, 62.1,</span>
<span class="sd">            ...            68.9, 65.2, 61.4, 56.8, 53.2, 51.9, 54.1, 58.7,</span>
<span class="sd">            ...            64.3, 70.8, 66.2, 61.1, 56.3, 49.8, 46.1, 43.9]</span>
<span class="sd">            ... }, index=time_index)</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Calculate raw spreads (FR - DE for DE-FR border)</span>
<span class="sd">            &gt;&gt;&gt; raw_spreads = calculator.calculate(prices, &#39;raw&#39;)</span>
<span class="sd">            &gt;&gt;&gt; print(f&quot;Average DE-FR spread: {raw_spreads[&#39;DE-FR&#39;].mean():.2f} EUR/MWh&quot;)</span>
<span class="sd">            &gt;&gt;&gt; # Output: Average DE-FR spread: -2.15 EUR/MWh (German prices higher)</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Calculate absolute spreads for congestion analysis</span>
<span class="sd">            &gt;&gt;&gt; abs_spreads = calculator.calculate(prices, &#39;absolute&#39;)</span>
<span class="sd">            &gt;&gt;&gt; print(f&quot;Average absolute spread: {abs_spreads[&#39;DE-FR&#39;].mean():.2f} EUR/MWh&quot;)</span>
<span class="sd">            &gt;&gt;&gt; # Output: Average absolute spread: 2.15 EUR/MWh</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Analyze directional spreads for flow prediction</span>
<span class="sd">            &gt;&gt;&gt; up_spreads = calculator.calculate(prices, &#39;directional_up&#39;)</span>
<span class="sd">            &gt;&gt;&gt; down_spreads = calculator.calculate(prices, &#39;directional_down&#39;)</span>
<span class="sd">            &gt;&gt;&gt; print(f&quot;Hours with FR &gt; DE prices: {(up_spreads[&#39;DE-FR&#39;] &gt; 0).sum()}&quot;)</span>
<span class="sd">            &gt;&gt;&gt; print(f&quot;Hours with DE &gt; FR prices: {(down_spreads[&#39;DE-FR&#39;] &gt; 0).sum()}&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_time_series_data</span><span class="p">(</span><span class="n">area_price_df</span><span class="p">,</span> <span class="s1">&#39;area_price_df&#39;</span><span class="p">)</span>

        <span class="n">spreads</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">border_id</span><span class="p">,</span> <span class="n">border</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_border_model_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">area_from</span> <span class="o">=</span> <span class="n">border</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">source_area_identifier</span><span class="p">]</span>
            <span class="n">area_to</span> <span class="o">=</span> <span class="n">border</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_area_identifier</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">area_from</span> <span class="ow">in</span> <span class="n">area_price_df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="n">area_to</span> <span class="ow">in</span> <span class="n">area_price_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">price_from</span> <span class="o">=</span> <span class="n">area_price_df</span><span class="p">[</span><span class="n">area_from</span><span class="p">]</span>
                <span class="n">price_to</span> <span class="o">=</span> <span class="n">area_price_df</span><span class="p">[</span><span class="n">area_to</span><span class="p">]</span>

                <span class="n">raw_spread</span> <span class="o">=</span> <span class="n">price_to</span> <span class="o">-</span> <span class="n">price_from</span>

                <span class="k">if</span> <span class="n">spread_type</span> <span class="o">==</span> <span class="s1">&#39;raw&#39;</span><span class="p">:</span>
                    <span class="n">spreads</span><span class="p">[</span><span class="n">border_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_spread</span>
                <span class="k">elif</span> <span class="n">spread_type</span> <span class="o">==</span> <span class="s1">&#39;absolute&#39;</span><span class="p">:</span>
                    <span class="n">spreads</span><span class="p">[</span><span class="n">border_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_spread</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">spread_type</span> <span class="o">==</span> <span class="s1">&#39;directional_up&#39;</span><span class="p">:</span>
                    <span class="n">spreads</span><span class="p">[</span><span class="n">border_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_spread</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">spread_type</span> <span class="o">==</span> <span class="s1">&#39;directional_down&#39;</span><span class="p">:</span>
                    <span class="n">spreads</span><span class="p">[</span><span class="n">border_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">raw_spread</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown spread_type: </span><span class="si">{</span><span class="n">spread_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">spreads</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">border_identifier</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_all_spread_types</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">area_price_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate all price spread types simultaneously for comprehensive analysis.</span>

<span class="sd">        Returns a MultiIndex DataFrame with all four spread calculation methods</span>
<span class="sd">        (raw, absolute, directional_up, directional_down) in a single DataFrame,</span>
<span class="sd">        providing a complete view of price relationships across all borders.</span>

<span class="sd">        Args:</span>
<span class="sd">            area_price_df (pd.DataFrame): Time series of area-level electricity prices.</span>
<span class="sd">                Same format as required by the calculate() method:</span>
<span class="sd">                - Index: DateTime index for temporal analysis</span>
<span class="sd">                - Columns: Area identifiers matching border definitions</span>
<span class="sd">                - Values: Prices in consistent units (e.g., EUR/MWh, USD/MWh)</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: MultiIndex DataFrame with comprehensive spread analysis.</span>
<span class="sd">                - Index: Same temporal index as input area_price_df</span>
<span class="sd">                - Columns: MultiIndex with two levels:</span>
<span class="sd">                    - Level 0 (&#39;spread_type&#39;): [&#39;raw&#39;, &#39;absolute&#39;, &#39;directional_up&#39;, &#39;directional_down&#39;]</span>
<span class="sd">                    - Level 1 (border_identifier): Border names (e.g., &#39;DE-FR&#39;, &#39;FR-BE&#39;)</span>
<span class="sd">                - Values: Price spreads in same units as input prices</span>
<span class="sd">                - Structure: (time_periods, spread_types × borders)</span>

<span class="sd">        Example:</span>

<span class="sd">            &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">            &gt;&gt;&gt; import numpy as np</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Create sample price data</span>
<span class="sd">            &gt;&gt;&gt; time_index = pd.date_range(&#39;2024-01-01&#39;, periods=24, freq=&#39;h&#39;)</span>
<span class="sd">            &gt;&gt;&gt; prices = pd.DataFrame({</span>
<span class="sd">            ...     &#39;DE&#39;: np.random.uniform(40, 80, 24),</span>
<span class="sd">            ...     &#39;FR&#39;: np.random.uniform(35, 75, 24),</span>
<span class="sd">            ...     &#39;BE&#39;: np.random.uniform(45, 85, 24)</span>
<span class="sd">            ... }, index=time_index)</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Calculate all spread types</span>
<span class="sd">            &gt;&gt;&gt; all_spreads = calculator.calculate_all_spread_types(prices)</span>
<span class="sd">            &gt;&gt;&gt; print(all_spreads.columns.names)</span>
<span class="sd">            &gt;&gt;&gt; # Output: [&#39;spread_type&#39;, &#39;country_border&#39;]</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Access specific spread types</span>
<span class="sd">            &gt;&gt;&gt; raw_spreads = all_spreads[&#39;raw&#39;]</span>
<span class="sd">            &gt;&gt;&gt; absolute_spreads = all_spreads[&#39;absolute&#39;]</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Analyze spread statistics by type</span>
<span class="sd">            &gt;&gt;&gt; spread_stats = all_spreads.groupby(level=&#39;spread_type&#39;, axis=1).mean()</span>
<span class="sd">            &gt;&gt;&gt; print(spread_stats)</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Compare directional flows</span>
<span class="sd">            &gt;&gt;&gt; up_flows = all_spreads[&#39;directional_up&#39;].sum(axis=1)</span>
<span class="sd">            &gt;&gt;&gt; down_flows = all_spreads[&#39;directional_down&#39;].sum(axis=1)</span>
<span class="sd">            &gt;&gt;&gt; net_spread_pressure = up_flows - down_flows</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Identify hours with high price volatility</span>
<span class="sd">            &gt;&gt;&gt; high_volatility_hours = absolute_spreads.mean(axis=1) &gt; 10  # EUR/MWh threshold</span>
<span class="sd">            &gt;&gt;&gt; print(f&quot;Hours with high spread volatility: {high_volatility_hours.sum()}&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">spread_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;raw&#39;</span><span class="p">,</span> <span class="s1">&#39;absolute&#39;</span><span class="p">,</span> <span class="s1">&#39;directional_up&#39;</span><span class="p">,</span> <span class="s1">&#39;directional_down&#39;</span><span class="p">]:</span>
            <span class="n">results</span><span class="p">[</span><span class="n">spread_type</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="n">area_price_df</span><span class="p">,</span> <span class="n">spread_type</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;spread_type&#39;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="mescal.energy_data_handling.area_accounting.border_variable_price_spread_calculator.BorderPriceSpreadCalculator.calculate" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">calculate</span>


<a href="#mescal.energy_data_handling.area_accounting.border_variable_price_spread_calculator.BorderPriceSpreadCalculator.calculate" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">calculate</span><span class="p">(</span><span class="n">area_price_df</span><span class="p">:</span> <span class="n"><span title="pandas.DataFrame">DataFrame</span></span><span class="p">,</span> <span class="n">spread_type</span><span class="p">:</span> <span class="n"><span title="typing.Literal">Literal</span></span><span class="p">[</span><span class="s1">&#39;raw&#39;</span><span class="p">,</span> <span class="s1">&#39;absolute&#39;</span><span class="p">,</span> <span class="s1">&#39;directional_up&#39;</span><span class="p">,</span> <span class="s1">&#39;directional_down&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;raw&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="pandas.DataFrame">DataFrame</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Calculate electricity price spreads between connected market areas.</p>
<p>Computes price differences across transmission borders using the specified
calculation method. Price spreads are calculated as directional differences
based on the border naming convention (area_from → area_to).</p>
<p>The calculation handles missing area data gracefully by excluding borders
where either area lacks price data. This is common when analyzing subsets
of larger energy systems or when dealing with data availability issues.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>area_price_df</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time series of area-level electricity prices.
- Index: DateTime index for time series analysis
- Columns: Area identifiers matching border area names
- Values: Prices in consistent units (e.g., EUR/MWh, USD/MWh)
- Example shape: (8760 hours, N areas) for annual analysis</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>spread_type</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Method for calculating price spreads.
- 'raw': Directional price differences (default, preserves sign)
- 'absolute': Magnitude of price differences (always non-negative)
- 'directional_up': Only spreads where price_to &gt; price_from
- 'directional_down': Only spreads where price_from &gt; price_to</p>
              </div>
            </td>
            <td>
                  <code>&#39;raw&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: Border-level price spreads with temporal dimension.
- Index: Same as input area_price_df (typically DatetimeIndex)
- Columns: Border identifiers (e.g., 'DE-FR', 'FR-BE')
- Column name: Set to self.border_identifier for consistency
- Values: Price spreads in same units as input prices
- Missing data: NaN where area price data is unavailable</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If spread_type is not one of the supported options</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Example:</p>
<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; import pandas as pd
&gt;&gt;&gt; import numpy as np
&gt;&gt;&gt;
&gt;&gt;&gt; # Create hourly price data for German and French markets
&gt;&gt;&gt; time_index = pd.date_range(&#39;2024-01-01&#39;, periods=24, freq=&#39;h&#39;)
&gt;&gt;&gt; prices = pd.DataFrame({
...     &#39;DE&#39;: [45.2, 43.1, 41.8, 39.5, 38.2, 42.1, 52.3, 65.4,
...            72.1, 68.9, 64.2, 58.7, 55.1, 53.8, 56.2, 61.4,
...            67.8, 74.2, 69.1, 64.3, 58.9, 52.1, 48.7, 46.3],
...     &#39;FR&#39;: [42.8, 41.2, 39.1, 37.8, 36.4, 40.3, 49.8, 62.1,
...            68.9, 65.2, 61.4, 56.8, 53.2, 51.9, 54.1, 58.7,
...            64.3, 70.8, 66.2, 61.1, 56.3, 49.8, 46.1, 43.9]
... }, index=time_index)
&gt;&gt;&gt;
&gt;&gt;&gt; # Calculate raw spreads (FR - DE for DE-FR border)
&gt;&gt;&gt; raw_spreads = calculator.calculate(prices, &#39;raw&#39;)
&gt;&gt;&gt; print(f&quot;Average DE-FR spread: {raw_spreads[&#39;DE-FR&#39;].mean():.2f} EUR/MWh&quot;)
&gt;&gt;&gt; # Output: Average DE-FR spread: -2.15 EUR/MWh (German prices higher)
&gt;&gt;&gt;
&gt;&gt;&gt; # Calculate absolute spreads for congestion analysis
&gt;&gt;&gt; abs_spreads = calculator.calculate(prices, &#39;absolute&#39;)
&gt;&gt;&gt; print(f&quot;Average absolute spread: {abs_spreads[&#39;DE-FR&#39;].mean():.2f} EUR/MWh&quot;)
&gt;&gt;&gt; # Output: Average absolute spread: 2.15 EUR/MWh
&gt;&gt;&gt;
&gt;&gt;&gt; # Analyze directional spreads for flow prediction
&gt;&gt;&gt; up_spreads = calculator.calculate(prices, &#39;directional_up&#39;)
&gt;&gt;&gt; down_spreads = calculator.calculate(prices, &#39;directional_down&#39;)
&gt;&gt;&gt; print(f&quot;Hours with FR &gt; DE prices: {(up_spreads[&#39;DE-FR&#39;] &gt; 0).sum()}&quot;)
&gt;&gt;&gt; print(f&quot;Hours with DE &gt; FR prices: {(down_spreads[&#39;DE-FR&#39;] &gt; 0).sum()}&quot;)
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>submodules/mescal/mescal/energy_data_handling/area_accounting/border_variable_price_spread_calculator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">area_price_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">spread_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;raw&#39;</span><span class="p">,</span> <span class="s1">&#39;absolute&#39;</span><span class="p">,</span> <span class="s1">&#39;directional_up&#39;</span><span class="p">,</span> <span class="s1">&#39;directional_down&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;raw&#39;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate electricity price spreads between connected market areas.</span>

<span class="sd">    Computes price differences across transmission borders using the specified</span>
<span class="sd">    calculation method. Price spreads are calculated as directional differences</span>
<span class="sd">    based on the border naming convention (area_from → area_to).</span>

<span class="sd">    The calculation handles missing area data gracefully by excluding borders</span>
<span class="sd">    where either area lacks price data. This is common when analyzing subsets</span>
<span class="sd">    of larger energy systems or when dealing with data availability issues.</span>

<span class="sd">    Args:</span>
<span class="sd">        area_price_df (pd.DataFrame): Time series of area-level electricity prices.</span>
<span class="sd">            - Index: DateTime index for time series analysis</span>
<span class="sd">            - Columns: Area identifiers matching border area names</span>
<span class="sd">            - Values: Prices in consistent units (e.g., EUR/MWh, USD/MWh)</span>
<span class="sd">            - Example shape: (8760 hours, N areas) for annual analysis</span>

<span class="sd">        spread_type (Literal): Method for calculating price spreads.</span>
<span class="sd">            - &#39;raw&#39;: Directional price differences (default, preserves sign)</span>
<span class="sd">            - &#39;absolute&#39;: Magnitude of price differences (always non-negative)</span>
<span class="sd">            - &#39;directional_up&#39;: Only spreads where price_to &gt; price_from</span>
<span class="sd">            - &#39;directional_down&#39;: Only spreads where price_from &gt; price_to</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: Border-level price spreads with temporal dimension.</span>
<span class="sd">            - Index: Same as input area_price_df (typically DatetimeIndex)</span>
<span class="sd">            - Columns: Border identifiers (e.g., &#39;DE-FR&#39;, &#39;FR-BE&#39;)</span>
<span class="sd">            - Column name: Set to self.border_identifier for consistency</span>
<span class="sd">            - Values: Price spreads in same units as input prices</span>
<span class="sd">            - Missing data: NaN where area price data is unavailable</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If spread_type is not one of the supported options</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Create hourly price data for German and French markets</span>
<span class="sd">        &gt;&gt;&gt; time_index = pd.date_range(&#39;2024-01-01&#39;, periods=24, freq=&#39;h&#39;)</span>
<span class="sd">        &gt;&gt;&gt; prices = pd.DataFrame({</span>
<span class="sd">        ...     &#39;DE&#39;: [45.2, 43.1, 41.8, 39.5, 38.2, 42.1, 52.3, 65.4,</span>
<span class="sd">        ...            72.1, 68.9, 64.2, 58.7, 55.1, 53.8, 56.2, 61.4,</span>
<span class="sd">        ...            67.8, 74.2, 69.1, 64.3, 58.9, 52.1, 48.7, 46.3],</span>
<span class="sd">        ...     &#39;FR&#39;: [42.8, 41.2, 39.1, 37.8, 36.4, 40.3, 49.8, 62.1,</span>
<span class="sd">        ...            68.9, 65.2, 61.4, 56.8, 53.2, 51.9, 54.1, 58.7,</span>
<span class="sd">        ...            64.3, 70.8, 66.2, 61.1, 56.3, 49.8, 46.1, 43.9]</span>
<span class="sd">        ... }, index=time_index)</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Calculate raw spreads (FR - DE for DE-FR border)</span>
<span class="sd">        &gt;&gt;&gt; raw_spreads = calculator.calculate(prices, &#39;raw&#39;)</span>
<span class="sd">        &gt;&gt;&gt; print(f&quot;Average DE-FR spread: {raw_spreads[&#39;DE-FR&#39;].mean():.2f} EUR/MWh&quot;)</span>
<span class="sd">        &gt;&gt;&gt; # Output: Average DE-FR spread: -2.15 EUR/MWh (German prices higher)</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Calculate absolute spreads for congestion analysis</span>
<span class="sd">        &gt;&gt;&gt; abs_spreads = calculator.calculate(prices, &#39;absolute&#39;)</span>
<span class="sd">        &gt;&gt;&gt; print(f&quot;Average absolute spread: {abs_spreads[&#39;DE-FR&#39;].mean():.2f} EUR/MWh&quot;)</span>
<span class="sd">        &gt;&gt;&gt; # Output: Average absolute spread: 2.15 EUR/MWh</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Analyze directional spreads for flow prediction</span>
<span class="sd">        &gt;&gt;&gt; up_spreads = calculator.calculate(prices, &#39;directional_up&#39;)</span>
<span class="sd">        &gt;&gt;&gt; down_spreads = calculator.calculate(prices, &#39;directional_down&#39;)</span>
<span class="sd">        &gt;&gt;&gt; print(f&quot;Hours with FR &gt; DE prices: {(up_spreads[&#39;DE-FR&#39;] &gt; 0).sum()}&quot;)</span>
<span class="sd">        &gt;&gt;&gt; print(f&quot;Hours with DE &gt; FR prices: {(down_spreads[&#39;DE-FR&#39;] &gt; 0).sum()}&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_validate_time_series_data</span><span class="p">(</span><span class="n">area_price_df</span><span class="p">,</span> <span class="s1">&#39;area_price_df&#39;</span><span class="p">)</span>

    <span class="n">spreads</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">border_id</span><span class="p">,</span> <span class="n">border</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_border_model_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">area_from</span> <span class="o">=</span> <span class="n">border</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">source_area_identifier</span><span class="p">]</span>
        <span class="n">area_to</span> <span class="o">=</span> <span class="n">border</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_area_identifier</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">area_from</span> <span class="ow">in</span> <span class="n">area_price_df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="n">area_to</span> <span class="ow">in</span> <span class="n">area_price_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">price_from</span> <span class="o">=</span> <span class="n">area_price_df</span><span class="p">[</span><span class="n">area_from</span><span class="p">]</span>
            <span class="n">price_to</span> <span class="o">=</span> <span class="n">area_price_df</span><span class="p">[</span><span class="n">area_to</span><span class="p">]</span>

            <span class="n">raw_spread</span> <span class="o">=</span> <span class="n">price_to</span> <span class="o">-</span> <span class="n">price_from</span>

            <span class="k">if</span> <span class="n">spread_type</span> <span class="o">==</span> <span class="s1">&#39;raw&#39;</span><span class="p">:</span>
                <span class="n">spreads</span><span class="p">[</span><span class="n">border_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_spread</span>
            <span class="k">elif</span> <span class="n">spread_type</span> <span class="o">==</span> <span class="s1">&#39;absolute&#39;</span><span class="p">:</span>
                <span class="n">spreads</span><span class="p">[</span><span class="n">border_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_spread</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">spread_type</span> <span class="o">==</span> <span class="s1">&#39;directional_up&#39;</span><span class="p">:</span>
                <span class="n">spreads</span><span class="p">[</span><span class="n">border_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_spread</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">spread_type</span> <span class="o">==</span> <span class="s1">&#39;directional_down&#39;</span><span class="p">:</span>
                <span class="n">spreads</span><span class="p">[</span><span class="n">border_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">raw_spread</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown spread_type: </span><span class="si">{</span><span class="n">spread_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">spreads</span><span class="p">)</span>
    <span class="n">result</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">border_identifier</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="mescal.energy_data_handling.area_accounting.border_variable_price_spread_calculator.BorderPriceSpreadCalculator.calculate_all_spread_types" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">calculate_all_spread_types</span>


<a href="#mescal.energy_data_handling.area_accounting.border_variable_price_spread_calculator.BorderPriceSpreadCalculator.calculate_all_spread_types" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">calculate_all_spread_types</span><span class="p">(</span><span class="n">area_price_df</span><span class="p">:</span> <span class="n"><span title="pandas.DataFrame">DataFrame</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="pandas.DataFrame">DataFrame</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Calculate all price spread types simultaneously for comprehensive analysis.</p>
<p>Returns a MultiIndex DataFrame with all four spread calculation methods
(raw, absolute, directional_up, directional_down) in a single DataFrame,
providing a complete view of price relationships across all borders.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>area_price_df</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time series of area-level electricity prices.
Same format as required by the calculate() method:
- Index: DateTime index for temporal analysis
- Columns: Area identifiers matching border definitions
- Values: Prices in consistent units (e.g., EUR/MWh, USD/MWh)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: MultiIndex DataFrame with comprehensive spread analysis.
- Index: Same temporal index as input area_price_df
- Columns: MultiIndex with two levels:
    - Level 0 ('spread_type'): ['raw', 'absolute', 'directional_up', 'directional_down']
    - Level 1 (border_identifier): Border names (e.g., 'DE-FR', 'FR-BE')
- Values: Price spreads in same units as input prices
- Structure: (time_periods, spread_types × borders)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Example:</p>
<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; import pandas as pd
&gt;&gt;&gt; import numpy as np
&gt;&gt;&gt;
&gt;&gt;&gt; # Create sample price data
&gt;&gt;&gt; time_index = pd.date_range(&#39;2024-01-01&#39;, periods=24, freq=&#39;h&#39;)
&gt;&gt;&gt; prices = pd.DataFrame({
...     &#39;DE&#39;: np.random.uniform(40, 80, 24),
...     &#39;FR&#39;: np.random.uniform(35, 75, 24),
...     &#39;BE&#39;: np.random.uniform(45, 85, 24)
... }, index=time_index)
&gt;&gt;&gt;
&gt;&gt;&gt; # Calculate all spread types
&gt;&gt;&gt; all_spreads = calculator.calculate_all_spread_types(prices)
&gt;&gt;&gt; print(all_spreads.columns.names)
&gt;&gt;&gt; # Output: [&#39;spread_type&#39;, &#39;country_border&#39;]
&gt;&gt;&gt;
&gt;&gt;&gt; # Access specific spread types
&gt;&gt;&gt; raw_spreads = all_spreads[&#39;raw&#39;]
&gt;&gt;&gt; absolute_spreads = all_spreads[&#39;absolute&#39;]
&gt;&gt;&gt;
&gt;&gt;&gt; # Analyze spread statistics by type
&gt;&gt;&gt; spread_stats = all_spreads.groupby(level=&#39;spread_type&#39;, axis=1).mean()
&gt;&gt;&gt; print(spread_stats)
&gt;&gt;&gt;
&gt;&gt;&gt; # Compare directional flows
&gt;&gt;&gt; up_flows = all_spreads[&#39;directional_up&#39;].sum(axis=1)
&gt;&gt;&gt; down_flows = all_spreads[&#39;directional_down&#39;].sum(axis=1)
&gt;&gt;&gt; net_spread_pressure = up_flows - down_flows
&gt;&gt;&gt;
&gt;&gt;&gt; # Identify hours with high price volatility
&gt;&gt;&gt; high_volatility_hours = absolute_spreads.mean(axis=1) &gt; 10  # EUR/MWh threshold
&gt;&gt;&gt; print(f&quot;Hours with high spread volatility: {high_volatility_hours.sum()}&quot;)
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>submodules/mescal/mescal/energy_data_handling/area_accounting/border_variable_price_spread_calculator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_all_spread_types</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">area_price_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate all price spread types simultaneously for comprehensive analysis.</span>

<span class="sd">    Returns a MultiIndex DataFrame with all four spread calculation methods</span>
<span class="sd">    (raw, absolute, directional_up, directional_down) in a single DataFrame,</span>
<span class="sd">    providing a complete view of price relationships across all borders.</span>

<span class="sd">    Args:</span>
<span class="sd">        area_price_df (pd.DataFrame): Time series of area-level electricity prices.</span>
<span class="sd">            Same format as required by the calculate() method:</span>
<span class="sd">            - Index: DateTime index for temporal analysis</span>
<span class="sd">            - Columns: Area identifiers matching border definitions</span>
<span class="sd">            - Values: Prices in consistent units (e.g., EUR/MWh, USD/MWh)</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: MultiIndex DataFrame with comprehensive spread analysis.</span>
<span class="sd">            - Index: Same temporal index as input area_price_df</span>
<span class="sd">            - Columns: MultiIndex with two levels:</span>
<span class="sd">                - Level 0 (&#39;spread_type&#39;): [&#39;raw&#39;, &#39;absolute&#39;, &#39;directional_up&#39;, &#39;directional_down&#39;]</span>
<span class="sd">                - Level 1 (border_identifier): Border names (e.g., &#39;DE-FR&#39;, &#39;FR-BE&#39;)</span>
<span class="sd">            - Values: Price spreads in same units as input prices</span>
<span class="sd">            - Structure: (time_periods, spread_types × borders)</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Create sample price data</span>
<span class="sd">        &gt;&gt;&gt; time_index = pd.date_range(&#39;2024-01-01&#39;, periods=24, freq=&#39;h&#39;)</span>
<span class="sd">        &gt;&gt;&gt; prices = pd.DataFrame({</span>
<span class="sd">        ...     &#39;DE&#39;: np.random.uniform(40, 80, 24),</span>
<span class="sd">        ...     &#39;FR&#39;: np.random.uniform(35, 75, 24),</span>
<span class="sd">        ...     &#39;BE&#39;: np.random.uniform(45, 85, 24)</span>
<span class="sd">        ... }, index=time_index)</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Calculate all spread types</span>
<span class="sd">        &gt;&gt;&gt; all_spreads = calculator.calculate_all_spread_types(prices)</span>
<span class="sd">        &gt;&gt;&gt; print(all_spreads.columns.names)</span>
<span class="sd">        &gt;&gt;&gt; # Output: [&#39;spread_type&#39;, &#39;country_border&#39;]</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Access specific spread types</span>
<span class="sd">        &gt;&gt;&gt; raw_spreads = all_spreads[&#39;raw&#39;]</span>
<span class="sd">        &gt;&gt;&gt; absolute_spreads = all_spreads[&#39;absolute&#39;]</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Analyze spread statistics by type</span>
<span class="sd">        &gt;&gt;&gt; spread_stats = all_spreads.groupby(level=&#39;spread_type&#39;, axis=1).mean()</span>
<span class="sd">        &gt;&gt;&gt; print(spread_stats)</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Compare directional flows</span>
<span class="sd">        &gt;&gt;&gt; up_flows = all_spreads[&#39;directional_up&#39;].sum(axis=1)</span>
<span class="sd">        &gt;&gt;&gt; down_flows = all_spreads[&#39;directional_down&#39;].sum(axis=1)</span>
<span class="sd">        &gt;&gt;&gt; net_spread_pressure = up_flows - down_flows</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Identify hours with high price volatility</span>
<span class="sd">        &gt;&gt;&gt; high_volatility_hours = absolute_spreads.mean(axis=1) &gt; 10  # EUR/MWh threshold</span>
<span class="sd">        &gt;&gt;&gt; print(f&quot;Hours with high spread volatility: {high_volatility_hours.sum()}&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">spread_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;raw&#39;</span><span class="p">,</span> <span class="s1">&#39;absolute&#39;</span><span class="p">,</span> <span class="s1">&#39;directional_up&#39;</span><span class="p">,</span> <span class="s1">&#39;directional_down&#39;</span><span class="p">]:</span>
        <span class="n">results</span><span class="p">[</span><span class="n">spread_type</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="n">area_price_df</span><span class="p">,</span> <span class="n">spread_type</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;spread_type&#39;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../../..", "features": ["navigation.tabs", "content.tabs.link", "navigation.sections"], "search": "../../../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>