
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://docs.mesqual.io/mescal-package-documentation/api_reference/energy_data_handling/variable_utils/in_common_aggs/">
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../direction_aggs/">
      
      
      <link rel="icon" href="../../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.19">
    
    
      
        <title>In-common Aggregations - MESCAL Suite Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="amber">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#mescal-aggregate-columns-with-part-in-common" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../.." title="MESCAL Suite Documentation" class="md-header__button md-logo" aria-label="MESCAL Suite Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            MESCAL Suite Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              In-common Aggregations
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/helgeesch/mescal-vanilla-studies/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../../study_manager/" class="md-tabs__link">
          
  
  
  MESCAL API Reference

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../../mescal-study-01/notebooks/mescal_101_study_manager_and_basic_fetching/" class="md-tabs__link">
          
  
  
  Studies & Examples

        </a>
      </li>
    
  

    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="MESCAL Suite Documentation" class="md-nav__button md-logo" aria-label="MESCAL Suite Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    MESCAL Suite Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/helgeesch/mescal-vanilla-studies/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    MESCAL API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            MESCAL API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Core
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Core
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../study_manager/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    StudyManager
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../datasets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Datasets
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_3" >
        
          
          <label class="md-nav__link" for="__nav_2_1_3" id="__nav_2_1_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Flag System
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_3">
            <span class="md-nav__icon md-icon"></span>
            Flag System
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../flag/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Flag
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../flag_index/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FlagIndex
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../units/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Units
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../validation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../visualization/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Visualization Modules
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_2" id="__nav_2_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Visualization Modules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../visualization/time_series_dashboard/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    TimeSeriesDashboard
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../visualization/folium_viz_system/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Folium Viz System
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_2_2" id="__nav_2_2_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_2">
            <span class="md-nav__icon md-icon"></span>
            Folium Viz System
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../visualization/folium_viz_system/areas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Areas
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../visualization/folium_viz_system/circle_marker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Circle Marker
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../visualization/folium_viz_system/text_overlay/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Text Overlay
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../visualization/folium_viz_system/lines/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lines
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../visualization/folium_viz_system/line_text_overlay/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Line Text Overlay
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../visualization/folium_viz_system/arrow_icon/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Arrow Icon
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_2_7" >
        
          
          <label class="md-nav__link" for="__nav_2_2_2_7" id="__nav_2_2_2_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Base
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_2_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_2_7">
            <span class="md-nav__icon md-icon"></span>
            Base
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../visualization/folium_viz_system/system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Abstract System
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../visualization/folium_viz_system/data_item/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Data Item
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../visualization/folium_viz_system/kpi_collection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    KPI Collection Visualizer
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../visualization/folium_legend_system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Folium Legend System
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../visualization/html_table/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    HTML Table
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../visualization/html_dashboard/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    HTML Dashboard
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Energy Data Handling
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_3" id="__nav_2_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Energy Data Handling
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../area_accounting/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Area Accounting
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_3_1" id="__nav_2_3_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_1">
            <span class="md-nav__icon md-icon"></span>
            Area Accounting
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../area_accounting/model_gen/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Area / Border Model Generators
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../area_accounting/area_variables/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Area Variables
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../area_accounting/border_variables/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Border Variables
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../model_handling/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Model Membership Handling
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_3_2" id="__nav_2_3_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_2">
            <span class="md-nav__icon md-icon"></span>
            Model Membership Handling
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../model_handling/property_enricher/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Property Enricher
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../model_handling/pairs_appender/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pairs Appender
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_3" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Variable Utils
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_3_3" id="__nav_2_3_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_3_3">
            <span class="md-nav__icon md-icon"></span>
            Variable Utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    In-common Aggregations
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    In-common Aggregations
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#mescal.energy_data_handling.variable_utils.aggregate_cols_with_part_in_common.AggregatedColumnAppender" class="md-nav__link">
    <span class="md-ellipsis">
      AggregatedColumnAppender
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AggregatedColumnAppender">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mescal.energy_data_handling.variable_utils.aggregate_cols_with_part_in_common.AggregatedColumnAppender.add_aggregated_column" class="md-nav__link">
    <span class="md-ellipsis">
      add_aggregated_column
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../direction_aggs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Up-/Down Directional Aggregations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../congestion_rent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Congestion Rent
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../regional_trade_balance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Regional Trade Balance
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../granularity_modules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Granularity Modules
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../network_lines_data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Network Lines Data
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../time_series_gap_handling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Time Series Gap Handling
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Utils
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../utils/pandas_utils/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    pandas_utils
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_4_1" id="__nav_2_4_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4_1">
            <span class="md-nav__icon md-icon"></span>
            pandas_utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../utils/pandas_utils/flatten_df/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Flatten DF
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../utils/pandas_utils/pend_props/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pend Properties
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../utils/pandas_utils/filter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Filter by Model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../utils/pandas_utils/xs_df/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    xs DF
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../utils/pandas_utils/sort_multiindex/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sort MultiIndex
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../utils/pandas_utils/merge_multi_index_levels/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Merge MultiIndex Levels
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../utils/pandas_utils/set_new_column/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Set New Column in MultiIndex
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../utils/pandas_utils/combine_dfs.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Combine DFs
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../utils/plotly_utils/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    plotly_utils
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_4_2" id="__nav_2_4_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4_2">
            <span class="md-nav__icon md-icon"></span>
            plotly_utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../utils/plotly_utils/plotly_theme/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PlotlyTheme
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../utils/plotly_utils/figure_utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    figure_utils
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../utils/plotly_utils/px_category_utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    px_category_utils
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Studies & Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Studies & Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Intro to MESCAL
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            Intro to MESCAL
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../mescal-study-01/notebooks/mescal_101_study_manager_and_basic_fetching/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MESCAL 101: StudyManager and Dataset Fundamentals
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../mescal-study-01/notebooks/mescal_102_mastering_data_fetching/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MESCAL 102: Advanced Data Fetching Techniques
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../mescal-study-01/notebooks/mescal_103_scenario_attributes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MESCAL 103: Scenario Attributes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../mescal-study-01/notebooks/mescal_301_time_series_dashboard/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MESCAL 301: Time Series Dashboard
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../mescal-study-01/notebooks/mescal_302_segmented_colormap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MESCAL 302: Segmented Colormap
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../mescal-study-01/notebooks/mescal_303_folium_model_df_map/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MESCAL 401: Folium Model Data Visualization - Areas, Points, and Lines
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../mescal-study-01/notebooks/mescal_304_folium_area_kpi_map/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MESCAL 402: Folium KPI Visualization System
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../mescal-study-01/notebooks/mescal_304_simple_area_kpi_map/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MESCAL 303: Interactive Geospatial with Folium
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../mescal-study-01/notebooks/mescal_307_country_plotter_util/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MESCAL 307: Country Plotter Utility Module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../mescal-study-01/notebooks/mescal_308_html_dashboards/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MESCAL 305: HTML Dashboard Utility
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#mescal.energy_data_handling.variable_utils.aggregate_cols_with_part_in_common.AggregatedColumnAppender" class="md-nav__link">
    <span class="md-ellipsis">
      AggregatedColumnAppender
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AggregatedColumnAppender">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mescal.energy_data_handling.variable_utils.aggregate_cols_with_part_in_common.AggregatedColumnAppender.add_aggregated_column" class="md-nav__link">
    <span class="md-ellipsis">
      add_aggregated_column
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="mescal-aggregate-columns-with-part-in-common">MESCAL Aggregate Columns with Part in Common<a class="headerlink" href="#mescal-aggregate-columns-with-part-in-common" title="Permanent link">&para;</a></h1>


<div class="doc doc-object doc-class">



<h2 id="mescal.energy_data_handling.variable_utils.aggregate_cols_with_part_in_common.AggregatedColumnAppender" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">AggregatedColumnAppender</span>


<a href="#mescal.energy_data_handling.variable_utils.aggregate_cols_with_part_in_common.AggregatedColumnAppender" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">


        <p>Adds aggregated columns to pandas DataFrames by summing columns that share a common identifier.</p>
<p>This utility is particularly useful in energy systems modeling where multiple variables of the same
type (e.g., different wind generation sources, various demand components, multiple storage units)
need to be aggregated into totals for analysis or visualization.</p>
<p>The class handles both single-level and multi-level DataFrame columns, making it suitable for
MESCAL's energy variable structures that often include hierarchical indexing (time,
regions, technologies, etc.).</p>


<details class="energy-domain-context" open>
  <summary>Energy Domain Context</summary>
  <ul>
<li>Aggregates extensive quantities (volumes, energy, capacities) by summation</li>
<li>Preserves NaN when all quantities in an aggregation are NaNs</li>
<li>Suitable for technology groupings, regional aggregations, and fuel type summations</li>
</ul>
</details>

<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>in_common_part</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The common substring to search for in column names. All columns
containing this substring will be summed together.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>agg_col_name_prefix</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Prefix to add to the aggregated column name.
Defaults to empty string.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>agg_col_name_suffix</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Suffix to add to the aggregated column name.
Defaults to empty string.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Examples:</p>
<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; # Basic energy variable aggregation
&gt;&gt;&gt; data = pd.DataFrame({
...     &#39;wind_onshore_gen&#39;: [100, 200, 300],
...     &#39;wind_offshore_gen&#39;: [50, 70, 100], 
...     &#39;solar_pv_gen&#39;: [30, 40, 50]
... })
&gt;&gt;&gt; appender = AggregatedColumnAppender(&#39;wind&#39;, agg_col_name_suffix=&#39;_total&#39;)
&gt;&gt;&gt; result = appender.add_aggregated_column(data)
&gt;&gt;&gt; # Creates &#39;wind_total&#39; column with sum of wind_onshore_gen and wind_offshore_gen

&gt;&gt;&gt; # Multi-level columns for scenario analysis
&gt;&gt;&gt; columns = pd.MultiIndex.from_tuples([
...     (&#39;wind_onshore&#39;, &#39;scenario_1&#39;), (&#39;wind_onshore&#39;, &#39;scenario_2&#39;),
...     (&#39;wind_offshore&#39;, &#39;scenario_1&#39;), (&#39;wind_offshore&#39;, &#39;scenario_2&#39;)
... ])
&gt;&gt;&gt; data = pd.DataFrame(np.random.rand(24, 4), columns=columns)
&gt;&gt;&gt; appender = AggregatedColumnAppender(&#39;wind&#39;, agg_col_name_prefix=&#39;total_&#39;)
&gt;&gt;&gt; result = appender.add_aggregated_column(data)
&gt;&gt;&gt; # Creates &#39;total_wind&#39; with aggregated values for each scenario
</code></pre></div>








              <details class="quote">
                <summary>Source code in <code>submodules/mescal/mescal/energy_data_handling/variable_utils/aggregate_cols_with_part_in_common.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AggregatedColumnAppender</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds aggregated columns to pandas DataFrames by summing columns that share a common identifier.</span>

<span class="sd">    This utility is particularly useful in energy systems modeling where multiple variables of the same</span>
<span class="sd">    type (e.g., different wind generation sources, various demand components, multiple storage units)</span>
<span class="sd">    need to be aggregated into totals for analysis or visualization.</span>

<span class="sd">    The class handles both single-level and multi-level DataFrame columns, making it suitable for</span>
<span class="sd">    MESCAL&#39;s energy variable structures that often include hierarchical indexing (time,</span>
<span class="sd">    regions, technologies, etc.).</span>

<span class="sd">    Energy Domain Context:</span>
<span class="sd">        - Aggregates extensive quantities (volumes, energy, capacities) by summation</span>
<span class="sd">        - Preserves NaN when all quantities in an aggregation are NaNs</span>
<span class="sd">        - Suitable for technology groupings, regional aggregations, and fuel type summations</span>

<span class="sd">    Args:</span>
<span class="sd">        in_common_part (str): The common substring to search for in column names. All columns</span>
<span class="sd">            containing this substring will be summed together.</span>
<span class="sd">        agg_col_name_prefix (str, optional): Prefix to add to the aggregated column name.</span>
<span class="sd">            Defaults to empty string.</span>
<span class="sd">        agg_col_name_suffix (str, optional): Suffix to add to the aggregated column name.</span>
<span class="sd">            Defaults to empty string.</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; # Basic energy variable aggregation</span>
<span class="sd">        &gt;&gt;&gt; data = pd.DataFrame({</span>
<span class="sd">        ...     &#39;wind_onshore_gen&#39;: [100, 200, 300],</span>
<span class="sd">        ...     &#39;wind_offshore_gen&#39;: [50, 70, 100], </span>
<span class="sd">        ...     &#39;solar_pv_gen&#39;: [30, 40, 50]</span>
<span class="sd">        ... })</span>
<span class="sd">        &gt;&gt;&gt; appender = AggregatedColumnAppender(&#39;wind&#39;, agg_col_name_suffix=&#39;_total&#39;)</span>
<span class="sd">        &gt;&gt;&gt; result = appender.add_aggregated_column(data)</span>
<span class="sd">        &gt;&gt;&gt; # Creates &#39;wind_total&#39; column with sum of wind_onshore_gen and wind_offshore_gen</span>

<span class="sd">        &gt;&gt;&gt; # Multi-level columns for scenario analysis</span>
<span class="sd">        &gt;&gt;&gt; columns = pd.MultiIndex.from_tuples([</span>
<span class="sd">        ...     (&#39;wind_onshore&#39;, &#39;scenario_1&#39;), (&#39;wind_onshore&#39;, &#39;scenario_2&#39;),</span>
<span class="sd">        ...     (&#39;wind_offshore&#39;, &#39;scenario_1&#39;), (&#39;wind_offshore&#39;, &#39;scenario_2&#39;)</span>
<span class="sd">        ... ])</span>
<span class="sd">        &gt;&gt;&gt; data = pd.DataFrame(np.random.rand(24, 4), columns=columns)</span>
<span class="sd">        &gt;&gt;&gt; appender = AggregatedColumnAppender(&#39;wind&#39;, agg_col_name_prefix=&#39;total_&#39;)</span>
<span class="sd">        &gt;&gt;&gt; result = appender.add_aggregated_column(data)</span>
<span class="sd">        &gt;&gt;&gt; # Creates &#39;total_wind&#39; with aggregated values for each scenario</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">in_common_part</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="n">agg_col_name_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">agg_col_name_suffix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_in_common_part</span> <span class="o">=</span> <span class="n">in_common_part</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_agg_col_name_prefix</span> <span class="o">=</span> <span class="n">agg_col_name_prefix</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_agg_col_name_suffix</span> <span class="o">=</span> <span class="n">agg_col_name_suffix</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_aggregated_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add an aggregated column to the DataFrame by summing matching columns.</span>

<span class="sd">        This method identifies all columns containing the specified common part and sums them</span>
<span class="sd">        into a new aggregated column. The aggregation preserves the DataFrame&#39;s structure</span>
<span class="sd">        and handles both single-level and multi-level column indices.</span>

<span class="sd">        For energy data, this is typically used to:</span>
<span class="sd">        - Aggregate different technology types (e.g., all wind sources)</span>
<span class="sd">        - Sum regional contributions (e.g., all demand in a country)</span>
<span class="sd">        - Combine fuel types (e.g., all fossil fuel generators)</span>

<span class="sd">        Args:</span>
<span class="sd">            df (pd.DataFrame): Input DataFrame containing energy variables. Can have single-level</span>
<span class="sd">                or multi-level column structure. For multi-level columns, aggregation is performed</span>
<span class="sd">                at the appropriate level while preserving the hierarchy.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: Original DataFrame with added aggregated column. The new column name</span>
<span class="sd">                follows the pattern: {prefix}{in_common_part}{suffix}</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If no columns contain the specified common part.</span>
<span class="sd">            TypeError: If input is not a pandas DataFrame.</span>

<span class="sd">        Examples:</span>
<span class="sd">            Single-level columns - technology aggregation:</span>
<span class="sd">            &gt;&gt;&gt; gen_data = pd.DataFrame({</span>
<span class="sd">            ...     &#39;wind_onshore_MW&#39;: [120, 150, 180],</span>
<span class="sd">            ...     &#39;wind_offshore_MW&#39;: [80, 90, 100],</span>
<span class="sd">            ...     &#39;solar_pv_MW&#39;: [200, 250, 300],</span>
<span class="sd">            ...     &#39;demand_MW&#39;: [400, 490, 580]</span>
<span class="sd">            ... })</span>
<span class="sd">            &gt;&gt;&gt; appender = AggregatedColumnAppender(&#39;wind&#39;, agg_col_name_suffix=&#39;_total_MW&#39;)</span>
<span class="sd">            &gt;&gt;&gt; result = appender.add_aggregated_column(gen_data)</span>
<span class="sd">            &gt;&gt;&gt; result[&#39;wind_total_MW&#39;]  # [200, 240, 280]</span>

<span class="sd">            Multi-level columns - scenario and regional analysis</span>
<span class="sd">            &gt;&gt;&gt; idx = pd.date_range(&#39;2024-01-01&#39;, periods=3, freq=&#39;h&#39;)</span>
<span class="sd">            &gt;&gt;&gt; cols = pd.MultiIndex.from_tuples([</span>
<span class="sd">            ...     (&#39;storage_battery&#39;, &#39;DE&#39;, &#39;scenario_1&#39;), </span>
<span class="sd">            ...     (&#39;storage_battery&#39;, &#39;FR&#39;, &#39;scenario_1&#39;),</span>
<span class="sd">            ...     (&#39;storage_pumped&#39;, &#39;DE&#39;, &#39;scenario_1&#39;),</span>
<span class="sd">            ...     (&#39;storage_pumped&#39;, &#39;FR&#39;, &#39;scenario_1&#39;)</span>
<span class="sd">            ... ], names=[&#39;technology&#39;, &#39;region&#39;, &#39;scenario&#39;])</span>
<span class="sd">            &gt;&gt;&gt; data = pd.DataFrame(np.random.rand(3, 4), index=idx, columns=cols)</span>
<span class="sd">            &gt;&gt;&gt; appender = AggregatedColumnAppender(&#39;storage&#39;, agg_col_name_prefix=&#39;total_&#39;)</span>
<span class="sd">            &gt;&gt;&gt; result = appender.add_aggregated_column(data)</span>
<span class="sd">            &gt;&gt;&gt; # Creates &#39;total_storage&#39; with sums grouped by (region, scenario)</span>

<span class="sd">            Handling NaN values in energy time series</span>
<span class="sd">            &gt;&gt;&gt; price_data = pd.DataFrame({</span>
<span class="sd">            ...     &#39;price_day_ahead&#39;: [50.0, np.nan, 45.0],</span>
<span class="sd">            ...     &#39;price_intraday&#39;: [np.nan, np.nan, 47.0],  </span>
<span class="sd">            ...     &#39;demand_forecast&#39;: [1000, 1100, 1200]</span>
<span class="sd">            ... })</span>
<span class="sd">            &gt;&gt;&gt; appender = AggregatedColumnAppender(&#39;price&#39;, agg_col_name_suffix=&#39;_avg&#39;)</span>
<span class="sd">            &gt;&gt;&gt; result = appender.add_aggregated_column(price_data)</span>
<span class="sd">            &gt;&gt;&gt; # &#39;price_avg&#39;: [50.0, NaN, 92.0] - preserves NaN when all inputs are NaN</span>

<span class="sd">        Note:</span>
<span class="sd">            For multi-level DataFrames, the aggregation respects the hierarchical structure.</span>
<span class="sd">            If columns have levels beyond the first (technology level), the aggregation</span>
<span class="sd">            groups by those additional levels, creating separate totals for each combination.</span>

<span class="sd">            NaN handling follows pandas summation rules: NaN values are ignored unless all</span>
<span class="sd">            values in a row are NaN, in which case the result is NaN.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="n">cols_with_common_part</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cols</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_in_common_part</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>

        <span class="n">df_in_common</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">cols_with_common_part</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">nlevels</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">dff</span> <span class="o">=</span> <span class="n">df_in_common</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">dff</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_in_common</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_groupby</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">nlevels</span><span class="p">))</span>
            <span class="n">dff</span> <span class="o">=</span> <span class="n">df_in_common</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">_groupby</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
            <span class="n">_all_na</span> <span class="o">=</span> <span class="n">df_in_common</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">_groupby</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
            <span class="k">if</span> <span class="n">_all_na</span><span class="o">.</span><span class="n">any</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">_all_na</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="n">dff</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">_all_na</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

        <span class="n">new_col_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_agg_col_name_prefix</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">_in_common_part</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">_agg_col_name_suffix</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">set_column</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">new_col_name</span><span class="p">,</span> <span class="n">dff</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="mescal.energy_data_handling.variable_utils.aggregate_cols_with_part_in_common.AggregatedColumnAppender.add_aggregated_column" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">add_aggregated_column</span>


<a href="#mescal.energy_data_handling.variable_utils.aggregate_cols_with_part_in_common.AggregatedColumnAppender.add_aggregated_column" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">add_aggregated_column</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n"><span title="pandas.DataFrame">DataFrame</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="pandas.DataFrame">DataFrame</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Add an aggregated column to the DataFrame by summing matching columns.</p>
<p>This method identifies all columns containing the specified common part and sums them
into a new aggregated column. The aggregation preserves the DataFrame's structure
and handles both single-level and multi-level column indices.</p>
<p>For energy data, this is typically used to:
- Aggregate different technology types (e.g., all wind sources)
- Sum regional contributions (e.g., all demand in a country)
- Combine fuel types (e.g., all fossil fuel generators)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>df</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input DataFrame containing energy variables. Can have single-level
or multi-level column structure. For multi-level columns, aggregation is performed
at the appropriate level while preserving the hierarchy.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: Original DataFrame with added aggregated column. The new column name
follows the pattern: {prefix}{in_common_part}{suffix}</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If no columns contain the specified common part.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="TypeError">TypeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If input is not a pandas DataFrame.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <p>Single-level columns - technology aggregation:</p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">gen_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
<span class="gp">... </span>    <span class="s1">&#39;wind_onshore_MW&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">120</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">180</span><span class="p">],</span>
<span class="gp">... </span>    <span class="s1">&#39;wind_offshore_MW&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">80</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
<span class="gp">... </span>    <span class="s1">&#39;solar_pv_MW&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">300</span><span class="p">],</span>
<span class="gp">... </span>    <span class="s1">&#39;demand_MW&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">400</span><span class="p">,</span> <span class="mi">490</span><span class="p">,</span> <span class="mi">580</span><span class="p">]</span>
<span class="gp">... </span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">appender</span> <span class="o">=</span> <span class="n">AggregatedColumnAppender</span><span class="p">(</span><span class="s1">&#39;wind&#39;</span><span class="p">,</span> <span class="n">agg_col_name_suffix</span><span class="o">=</span><span class="s1">&#39;_total_MW&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">appender</span><span class="o">.</span><span class="n">add_aggregated_column</span><span class="p">(</span><span class="n">gen_data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;wind_total_MW&#39;</span><span class="p">]</span>  <span class="c1"># [200, 240, 280]</span>
</code></pre></div>
    <p>Multi-level columns - scenario and regional analysis</p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">idx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;2024-01-01&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cols</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">([</span>
<span class="gp">... </span>    <span class="p">(</span><span class="s1">&#39;storage_battery&#39;</span><span class="p">,</span> <span class="s1">&#39;DE&#39;</span><span class="p">,</span> <span class="s1">&#39;scenario_1&#39;</span><span class="p">),</span> 
<span class="gp">... </span>    <span class="p">(</span><span class="s1">&#39;storage_battery&#39;</span><span class="p">,</span> <span class="s1">&#39;FR&#39;</span><span class="p">,</span> <span class="s1">&#39;scenario_1&#39;</span><span class="p">),</span>
<span class="gp">... </span>    <span class="p">(</span><span class="s1">&#39;storage_pumped&#39;</span><span class="p">,</span> <span class="s1">&#39;DE&#39;</span><span class="p">,</span> <span class="s1">&#39;scenario_1&#39;</span><span class="p">),</span>
<span class="gp">... </span>    <span class="p">(</span><span class="s1">&#39;storage_pumped&#39;</span><span class="p">,</span> <span class="s1">&#39;FR&#39;</span><span class="p">,</span> <span class="s1">&#39;scenario_1&#39;</span><span class="p">)</span>
<span class="gp">... </span><span class="p">],</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;technology&#39;</span><span class="p">,</span> <span class="s1">&#39;region&#39;</span><span class="p">,</span> <span class="s1">&#39;scenario&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">idx</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">appender</span> <span class="o">=</span> <span class="n">AggregatedColumnAppender</span><span class="p">(</span><span class="s1">&#39;storage&#39;</span><span class="p">,</span> <span class="n">agg_col_name_prefix</span><span class="o">=</span><span class="s1">&#39;total_&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">appender</span><span class="o">.</span><span class="n">add_aggregated_column</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Creates &#39;total_storage&#39; with sums grouped by (region, scenario)</span>
</code></pre></div>
    <p>Handling NaN values in energy time series</p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">price_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
<span class="gp">... </span>    <span class="s1">&#39;price_day_ahead&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">50.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">45.0</span><span class="p">],</span>
<span class="gp">... </span>    <span class="s1">&#39;price_intraday&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">47.0</span><span class="p">],</span>  
<span class="gp">... </span>    <span class="s1">&#39;demand_forecast&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1100</span><span class="p">,</span> <span class="mi">1200</span><span class="p">]</span>
<span class="gp">... </span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">appender</span> <span class="o">=</span> <span class="n">AggregatedColumnAppender</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="n">agg_col_name_suffix</span><span class="o">=</span><span class="s1">&#39;_avg&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">appender</span><span class="o">.</span><span class="n">add_aggregated_column</span><span class="p">(</span><span class="n">price_data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># &#39;price_avg&#39;: [50.0, NaN, 92.0] - preserves NaN when all inputs are NaN</span>
</code></pre></div>


<details class="note" open>
  <summary>Note</summary>
  <p>For multi-level DataFrames, the aggregation respects the hierarchical structure.
If columns have levels beyond the first (technology level), the aggregation
groups by those additional levels, creating separate totals for each combination.</p>
<p>NaN handling follows pandas summation rules: NaN values are ignored unless all
values in a row are NaN, in which case the result is NaN.</p>
</details>

            <details class="quote">
              <summary>Source code in <code>submodules/mescal/mescal/energy_data_handling/variable_utils/aggregate_cols_with_part_in_common.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_aggregated_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add an aggregated column to the DataFrame by summing matching columns.</span>

<span class="sd">    This method identifies all columns containing the specified common part and sums them</span>
<span class="sd">    into a new aggregated column. The aggregation preserves the DataFrame&#39;s structure</span>
<span class="sd">    and handles both single-level and multi-level column indices.</span>

<span class="sd">    For energy data, this is typically used to:</span>
<span class="sd">    - Aggregate different technology types (e.g., all wind sources)</span>
<span class="sd">    - Sum regional contributions (e.g., all demand in a country)</span>
<span class="sd">    - Combine fuel types (e.g., all fossil fuel generators)</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pd.DataFrame): Input DataFrame containing energy variables. Can have single-level</span>
<span class="sd">            or multi-level column structure. For multi-level columns, aggregation is performed</span>
<span class="sd">            at the appropriate level while preserving the hierarchy.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: Original DataFrame with added aggregated column. The new column name</span>
<span class="sd">            follows the pattern: {prefix}{in_common_part}{suffix}</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If no columns contain the specified common part.</span>
<span class="sd">        TypeError: If input is not a pandas DataFrame.</span>

<span class="sd">    Examples:</span>
<span class="sd">        Single-level columns - technology aggregation:</span>
<span class="sd">        &gt;&gt;&gt; gen_data = pd.DataFrame({</span>
<span class="sd">        ...     &#39;wind_onshore_MW&#39;: [120, 150, 180],</span>
<span class="sd">        ...     &#39;wind_offshore_MW&#39;: [80, 90, 100],</span>
<span class="sd">        ...     &#39;solar_pv_MW&#39;: [200, 250, 300],</span>
<span class="sd">        ...     &#39;demand_MW&#39;: [400, 490, 580]</span>
<span class="sd">        ... })</span>
<span class="sd">        &gt;&gt;&gt; appender = AggregatedColumnAppender(&#39;wind&#39;, agg_col_name_suffix=&#39;_total_MW&#39;)</span>
<span class="sd">        &gt;&gt;&gt; result = appender.add_aggregated_column(gen_data)</span>
<span class="sd">        &gt;&gt;&gt; result[&#39;wind_total_MW&#39;]  # [200, 240, 280]</span>

<span class="sd">        Multi-level columns - scenario and regional analysis</span>
<span class="sd">        &gt;&gt;&gt; idx = pd.date_range(&#39;2024-01-01&#39;, periods=3, freq=&#39;h&#39;)</span>
<span class="sd">        &gt;&gt;&gt; cols = pd.MultiIndex.from_tuples([</span>
<span class="sd">        ...     (&#39;storage_battery&#39;, &#39;DE&#39;, &#39;scenario_1&#39;), </span>
<span class="sd">        ...     (&#39;storage_battery&#39;, &#39;FR&#39;, &#39;scenario_1&#39;),</span>
<span class="sd">        ...     (&#39;storage_pumped&#39;, &#39;DE&#39;, &#39;scenario_1&#39;),</span>
<span class="sd">        ...     (&#39;storage_pumped&#39;, &#39;FR&#39;, &#39;scenario_1&#39;)</span>
<span class="sd">        ... ], names=[&#39;technology&#39;, &#39;region&#39;, &#39;scenario&#39;])</span>
<span class="sd">        &gt;&gt;&gt; data = pd.DataFrame(np.random.rand(3, 4), index=idx, columns=cols)</span>
<span class="sd">        &gt;&gt;&gt; appender = AggregatedColumnAppender(&#39;storage&#39;, agg_col_name_prefix=&#39;total_&#39;)</span>
<span class="sd">        &gt;&gt;&gt; result = appender.add_aggregated_column(data)</span>
<span class="sd">        &gt;&gt;&gt; # Creates &#39;total_storage&#39; with sums grouped by (region, scenario)</span>

<span class="sd">        Handling NaN values in energy time series</span>
<span class="sd">        &gt;&gt;&gt; price_data = pd.DataFrame({</span>
<span class="sd">        ...     &#39;price_day_ahead&#39;: [50.0, np.nan, 45.0],</span>
<span class="sd">        ...     &#39;price_intraday&#39;: [np.nan, np.nan, 47.0],  </span>
<span class="sd">        ...     &#39;demand_forecast&#39;: [1000, 1100, 1200]</span>
<span class="sd">        ... })</span>
<span class="sd">        &gt;&gt;&gt; appender = AggregatedColumnAppender(&#39;price&#39;, agg_col_name_suffix=&#39;_avg&#39;)</span>
<span class="sd">        &gt;&gt;&gt; result = appender.add_aggregated_column(price_data)</span>
<span class="sd">        &gt;&gt;&gt; # &#39;price_avg&#39;: [50.0, NaN, 92.0] - preserves NaN when all inputs are NaN</span>

<span class="sd">    Note:</span>
<span class="sd">        For multi-level DataFrames, the aggregation respects the hierarchical structure.</span>
<span class="sd">        If columns have levels beyond the first (technology level), the aggregation</span>
<span class="sd">        groups by those additional levels, creating separate totals for each combination.</span>

<span class="sd">        NaN handling follows pandas summation rules: NaN values are ignored unless all</span>
<span class="sd">        values in a row are NaN, in which case the result is NaN.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
    <span class="n">cols_with_common_part</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cols</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_in_common_part</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>

    <span class="n">df_in_common</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">cols_with_common_part</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">nlevels</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">dff</span> <span class="o">=</span> <span class="n">df_in_common</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">dff</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_in_common</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_groupby</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">nlevels</span><span class="p">))</span>
        <span class="n">dff</span> <span class="o">=</span> <span class="n">df_in_common</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">_groupby</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
        <span class="n">_all_na</span> <span class="o">=</span> <span class="n">df_in_common</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">_groupby</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
        <span class="k">if</span> <span class="n">_all_na</span><span class="o">.</span><span class="n">any</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">_all_na</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">dff</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">_all_na</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="n">new_col_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_agg_col_name_prefix</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">_in_common_part</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">_agg_col_name_suffix</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">set_column</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">new_col_name</span><span class="p">,</span> <span class="n">dff</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../../..", "features": ["navigation.tabs", "content.tabs.link", "navigation.sections"], "search": "../../../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>